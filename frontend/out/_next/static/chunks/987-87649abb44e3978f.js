"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[987],{4987:function(e,t,a){a.r(t),a.d(t,{StudioPage:function(){return U},default:function(){return M}});var i=a(7437),n=a(2265),r=a(2955),s=a(2757),l=a(8094),o=a(9061),d=a(472),c=a(8604),u=a(399);function p(e){let{files:t,onFiles:a}=e,r=(0,n.useRef)(null);return(0,i.jsxs)("div",{className:"p-6 border-2 border-dashed border-slate-700 rounded-xl text-center hover:border-slate-500 transition",onClick:()=>{var e;return null===(e=r.current)||void 0===e?void 0:e.click()},onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault(),a([...t,...Array.from(e.dataTransfer.files)])},children:[(0,i.jsx)("p",{className:"text-slate-300",children:"Drop images here or click to upload"}),(0,i.jsx)("input",{ref:r,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:e=>a([...t,...Array.from(e.target.files||[])])}),(0,i.jsx)("div",{className:"mt-3 flex flex-wrap gap-2 justify-center",children:t.map((e,t)=>(0,i.jsx)("span",{className:"text-xs text-slate-400 bg-slate-800 px-2 py-1 rounded",children:e.name},t))})]})}function m(e){let{value:t,onChange:a,placeholder:r}=e,[s,l]=(0,n.useState)("");return(0,i.jsx)("div",{children:(0,i.jsxs)("div",{className:"flex flex-wrap gap-2 p-2 rounded-lg border border-slate-300 bg-white",children:[t.map(e=>(0,i.jsxs)("span",{className:"px-2 py-1 rounded-md bg-slate-100 border border-slate-300 text-sm text-slate-700",children:[e,(0,i.jsx)("button",{className:"ml-2 text-slate-500 hover:text-slate-700",onClick:()=>a(t.filter(t=>t!==e)),children:"\xd7"})]},e)),(0,i.jsx)("input",{className:"flex-1 bg-transparent outline-none text-sm text-slate-700 placeholder:text-slate-400",value:s,placeholder:r||"Add & press Enter",onChange:e=>l(e.target.value),onKeyDown:function(e){("Enter"===e.key||","===e.key)&&(e.preventDefault(),function(e){let i=e.trim();i&&(t.includes(i)||a([...t,i]),l(""))}(s))}})]})})}var g=a(6264),v=a(6463);let h=a(357).env.NEXT_PUBLIC_API_BASE_URL||"";function f(e){try{if(!e||e.startsWith("/")||!/^https?:\/\//i.test(e))return e;let t=new URL(e).host,a="";try{a=h?new URL(h).host:window.location.host}catch(e){}let i=["cdn.shopify.com","images.openai.com","oaidalleapiprodscus.blob.core.windows.net"].some(e=>t===e||t.endsWith("."+e)),n=!!a&&t===a;return i||n?e:"".concat(h,"/proxy/image?url=").concat(encodeURIComponent(e))}catch(t){return e}}function x(e){let{children:t,onClick:a,disabled:n,variant:r="default",size:s="md"}=e;return(0,i.jsx)("button",{onClick:a,disabled:n,className:"".concat("rounded-xl font-semibold transition inline-flex items-center justify-center"," ").concat("sm"===s?"text-sm px-3 py-1.5":"px-4 py-2"," ").concat("outline"===r?"border border-slate-300 text-slate-700 bg-white hover:bg-slate-50 disabled:opacity-60":"bg-blue-600 hover:bg-blue-700 text-white disabled:opacity-60"),children:t})}function y(e){let{children:t}=e;return(0,i.jsx)("div",{className:"bg-white border rounded-2xl shadow-sm",children:t})}function _(e){let{children:t,className:a=""}=e;return(0,i.jsx)("div",{className:"px-4 pt-4 ".concat(a),children:t})}function b(e){let{children:t,className:a=""}=e;return(0,i.jsx)("h3",{className:"font-semibold ".concat(a),children:t})}function j(e){let{children:t,className:a=""}=e;return(0,i.jsx)("div",{className:"px-4 pb-4 ".concat(a),children:t})}function w(e){let{children:t,className:a=""}=e;return(0,i.jsx)("span",{className:"inline-flex items-center gap-1 text-xs px-2 py-0.5 rounded ".concat(a),children:t})}function N(e){return(0,i.jsx)("input",{...e,className:"w-full rounded-xl border px-3 py-2 ".concat(e.className||"")})}function A(e){return(0,i.jsx)("textarea",{...e,className:"w-full rounded-xl border px-3 py-2 ".concat(e.className||"")})}function S(e){let{className:t=""}=e;return(0,i.jsx)("div",{className:"border-t ".concat(t)})}let C=1,k=()=>"n".concat(C++),O=()=>new Date().toISOString(),I=e=>new Promise(t=>setTimeout(t,e));function E(e,t,a){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return{id:k(),type:e,x:t,y:a,data:i,selected:!1,run:{status:"idle",output:null,error:null,startedAt:null,finishedAt:null,ms:0}}}function P(e,t,a,i){return{id:k(),from:e,fromPort:t,to:a,toPort:i}}function R(){let e=E("trigger",120,140,{name:"Promotion",topic:"promotion_start"}),t=E("action",420,120,{label:"Generate Offers",type:"promotion_generate_offers",numOffers:3}),a=[P(e.id,"out",t.id,"in")];return{nodes:[e,t],edges:a}}function M(){return(0,i.jsx)(n.Suspense,{fallback:(0,i.jsx)("div",{className:"p-4 text-sm text-slate-500",children:"Loading…"}),children:(0,i.jsx)(U,{})})}function U(e){var t;let{forcedMode:a}=e,r=(0,v.useSearchParams)(),h="promotion"===(a||r.get("mode")),C=r.get("id"),M=r.get("store");(0,n.useEffect)(()=>{try{M&&localStorage.setItem("ptos_store",M)}catch(e){}},[M]);let[U,G]=(0,n.useState)(h?R():function(){let e=E("trigger",120,140,{name:"New Product",topic:"new_product"}),t=E("action",420,120,{label:"Generate Angles",type:"generate_angles",numAngles:2}),a=[P(e.id,"out",t.id,"in")];return{nodes:[e,t],edges:a}}()),[L,Z]=(0,n.useState)(null),[B,W]=(0,n.useState)(1),[Y,J]=(0,n.useState)({x:0,y:0}),[q,H]=(0,n.useState)(!1),[X,V]=(0,n.useState)(null),[K,Q]=(0,n.useState)([]),$=(0,n.useRef)(null),ee=(0,n.useRef)(U);(0,n.useEffect)(()=>{ee.current=U},[U]);let et=(0,n.useRef)(null),[ea,ei]=(0,n.useState)(void 0);function en(e){try{if((null==e?void 0:e.audience)&&es(e.audience),(null==e?void 0:e.title)&&ec(e.title),(null==e?void 0:e.base_price)!=null&&ep(Number(e.base_price)),Array.isArray(null==e?void 0:e.sizes)&&ex(e.sizes),Array.isArray(null==e?void 0:e.colors)&&e_(e.colors),Array.isArray(null==e?void 0:e.variant_descriptions)&&eL(e.variant_descriptions),Array.isArray(null==e?void 0:e.benefits)&&eg(e.benefits),Array.isArray(null==e?void 0:e.pain_points)&&eh(e.pain_points),Array.isArray(null==e?void 0:e.uploaded_images)&&eW(e.uploaded_images),(null==e?void 0:e.flow)&&Array.isArray(e.flow.nodes)&&Array.isArray(e.flow.edges))try{let t=Array.isArray(((null==e?void 0:e.ui)||{}).gallery_images)?e.ui.gallery_images:void 0,a=e.flow.nodes.map(e=>{var a;if((null==e?void 0:null===(a=e.data)||void 0===a?void 0:a.type)==="image_gallery"&&Array.isArray(t)){let a=e.run||{status:"idle",output:null,error:null,startedAt:null,finishedAt:null,ms:0};return{...e,run:{...a,output:{...(null==a?void 0:a.output)||{},images:t}}}}return e});G({nodes:a,edges:e.flow.edges})}catch(t){G({nodes:e.flow.nodes,edges:e.flow.edges})}if((null==e?void 0:e.ui)&&("number"==typeof e.ui.zoom&&W(e.ui.zoom),e.ui.pan&&"number"==typeof e.ui.pan.x&&"number"==typeof e.ui.pan.y&&J({x:e.ui.pan.x,y:e.ui.pan.y}),("string"==typeof e.ui.selected||null===e.ui.selected)&&Z(e.ui.selected),"string"==typeof e.ui.promotion_free_image_url&&eM(e.ui.promotion_free_image_url),"string"==typeof e.ui.promotion_offer_text&&eD(e.ui.promotion_offer_text),"string"==typeof e.ui.active_left_tab)){let t=String(e.ui.active_left_tab);("inputs"===t||"prompts"===t)&&tu(t)}(null==e?void 0:e.prompts)&&("string"==typeof e.prompts.angles_prompt&&eJ(e.prompts.angles_prompt),"string"==typeof e.prompts.title_desc_prompt&&eH(e.prompts.title_desc_prompt),"string"==typeof e.prompts.landing_copy_prompt&&eV(e.prompts.landing_copy_prompt),"string"==typeof e.prompts.gemini_ad_prompt&&eQ(e.prompts.gemini_ad_prompt),"string"==typeof e.prompts.gemini_variant_style_prompt&&e4(e.prompts.gemini_variant_style_prompt),"string"==typeof e.prompts.gemini_street_prompt&&e0(e.prompts.gemini_street_prompt)),(null==e?void 0:e.settings)&&("string"==typeof e.settings.model&&eZ(e.settings.model),"boolean"==typeof e.settings.advantage_plus&&tm(e.settings.advantage_plus),"number"==typeof e.settings.adset_budget&&ez(e.settings.adset_budget),Array.isArray(e.settings.countries)&&tv(e.settings.countries),"string"==typeof e.settings.saved_audience_id&&ty(e.settings.saved_audience_id),"string"==typeof e.settings.product_gid&&(et.current=e.settings.product_gid),"string"==typeof e.settings.product_handle&&ei(e.settings.product_handle))}catch(e){}}(0,n.useEffect)(()=>{(async()=>{if(!C){try{let e=sessionStorage.getItem("ptos_last_test_id");if(e){let t=sessionStorage.getItem("flow_cache_".concat(e));if(t){let a=JSON.parse(t);en(a),tb(e)}}}catch(e){}return}try{try{let e=sessionStorage.getItem("flow_cache_".concat(C));if(e){let t=JSON.parse(e);en(t),tb(C||void 0)}}catch(e){}let t=await (0,g.n4)(C),a=(null==t?void 0:t.payload)||{};en(a),tb(null==t?void 0:t.id);try{if(!(a&&a.flow&&Array.isArray(a.flow.nodes)&&a.flow.nodes.length>0)){var e;let a=await (0,g.ME)(C);if(a&&(null==a?void 0:a.flow)&&Array.isArray(null===(e=a.flow)||void 0===e?void 0:e.nodes)){let e=(null==a?void 0:a.product)||{},i={...e||{},uploaded_images:Array.isArray(null==e?void 0:e.uploaded_images)?e.uploaded_images:[],flow:a.flow,ui:a.ui,prompts:a.prompts,settings:a.settings,..."string"==typeof(null==a?void 0:a.card_image)?{card_image:a.card_image}:{}};en(i);try{sessionStorage.setItem("flow_cache_".concat(null==t?void 0:t.id),JSON.stringify(i))}catch(e){}}}}catch(e){}try{sessionStorage.setItem("flow_cache_".concat(null==t?void 0:t.id),JSON.stringify(a))}catch(e){}}catch(e){}})()},[C]),(0,n.useEffect)(()=>{h&&G(e=>{try{var t;let a=e.nodes.some(e=>{var t;return String((null===(t=e.data)||void 0===t?void 0:t.type)||"").startsWith("promotion_")}),i=2===e.nodes.length&&"trigger"===e.nodes[0].type&&(null===(t=e.nodes[1].data)||void 0===t?void 0:t.type)==="title_desc";if(!a&&i){let e=R();return ee.current=e,e}}catch(e){}return e})},[h]);let[er,es]=(0,n.useState)("Parents of toddlers in Morocco"),[el,eo]=(0,n.useState)("unisex"),[ed,ec]=(0,n.useState)(""),[eu,ep]=(0,n.useState)(""),[em,eg]=(0,n.useState)(["Comfy all-day wear"]),[ev,eh]=(0,n.useState)(["Kids scuff shoes"]),[ef,ex]=(0,n.useState)([]),[ey,e_]=(0,n.useState)([]),[eb,ej]=(0,n.useState)(!0),[ew,eN]=(0,n.useState)(""),[eA,eS]=(0,n.useState)(null),[eC,ek]=(0,n.useState)([]),[eO,eI]=(0,n.useState)(""),[eE,eP]=(0,n.useState)([]),[eR,eM]=(0,n.useState)(""),[eU,eD]=(0,n.useState)(""),[eG,eL]=(0,n.useState)([]),[eT,ez]=(0,n.useState)(9),[eF,eZ]=(0,n.useState)("gpt-5"),[eB,eW]=(0,n.useState)(null),[eY,eJ]=(0,n.useState)('You are a marketing products strategist and market expert. Focus on how to sell this product and to whom; pinpoint the ideal audience and deliver exactly two high‑converting angles.\nYou are a senior CRO & direct-response strategist.\nTask: From the provided PRODUCT_INFO (and optional IMAGES), identify the dominant buying driver and primary friction, then generate 2–5 distinct ad angles that are most likely to convert. Prioritize angles with clear proof, risk reversal, and a concrete, specific promise. Use only facts present in PRODUCT_INFO; if you must infer, mark it [ASSUMPTION].\n\nMethod:\n1) Diagnose Fit (audience, pains, outcomes, offer, price, guarantees, constraints/region/language).\n2) Choose 2–5 angle patterns (PAS, Social Proof, Risk Reversal, Speed/Convenience, Value, Emotional/Why-Now).\n3) Map proof to each claim (reviews, numbers, materials, policies).\n4) Pre-empt 2–3 objections per angle.\n5) If IMAGES provided, map them to angle/hooks by URL (never invent URLs).\n\nOutput:\nReturn ONE valid json object with:\n- diagnosis { dominant_driver, primary_friction, why_these_angles }\n- angles[] each with:\n  name, big_idea, promise, ksp[3-5], headlines[5-8], titles[3-5],\n  primaries { short, medium, long }, objections[{q,rebuttal}],\n  proof[], cta{label,url}, image_map{used[],notes}, lp_snippet{hero_headline,subheadline,bullets[]}\n- scores per angle: relevance, desire_intensity, differentiation, proof_strength, objection_coverage, clarity, visual_fit, total\n- recommendation { best_angle, why, first_test_assets[], next_tests[] }\n\nStyle & Localization:\n- Match language in PRODUCT_INFO ("ar" Fus\'ha, "fr", or "en").\n- If region == "MA", add Morocco trust signals (Cash on Delivery, fast city delivery, easy returns, WhatsApp support).\n- Be concrete and benefit-led. Avoid vague hype.\n\nCRITICAL: Output must be a single valid json object only (no markdown, no explanations).\n\nVariables available: {title}, {audience}, {benefits}, {pain_points}.'),[eq,eH]=(0,n.useState)('You are a marketing products strategist, market expert, and CRO copywriter. Optimize for surfacing in chat assistants (ChatGPT, Gemini, Perplexity): clear, specific, brand‑safe, non‑clickbait.\nFrom the given ANGLE and PRODUCT_INFO, write 5 HIGH‑CONVERTING product title options for {audience}. Each ≤60 characters, plus one extra ultra‑short option ≤30 characters. Include the primary keyword, one concrete benefit/outcome, and one unique differentiator (material/feature/offer). Use specific power words, no fluff, no emojis, no ALL CAPS.\nThen pick the single best option and output ONLY valid JSON: {\\"title\\": string, \\"description\\": string}. The description should be 1–2 sentences, brand‑safe, concrete, and benefit‑led.'),[eX,eV]=(0,n.useState)('You are a CRO specialist and landing‑page copy engineer.\n\nGoal\nProduce ONE valid JSON object with high‑converting landing copy AND a complete, self‑contained HTML page that embeds only the image URLs provided by the user. No markdown, no prose outside JSON.\n\nOutput Contract\nReturn exactly this JSON shape:\n{\n  "headline": string,\n  "subheadline": string,\n  "sections": [ { "id": "hero"|"highlights"|"feature_gallery"|"quick_specs"|"trust_badges"|"reviews"|"cta_block"|"colors", "title": string, "body": string, "image_url": string|null, "image_alt": string } ],\n  "faq": [ { "q": string, "a": string } ],\n  "cta": { "primary_label": string, "primary_url": string, "secondary_label": string|null, "secondary_url": string|null },\n  "html": string,\n  "assets_used": { "hero": string|null, "feature_gallery": string[] }\n}\n\nStrict Section Requirements\n- hero: One big idea + 2 short lines + 1–2 CTAs. Include ONE specific proof point above the fold (e.g., “24–48h city delivery”, “Non‑slip sole tested on tile”). Use the best available image as hero.\n- highlights: 4–6 concise, concrete bullets; preempt 2 objections (fit, durability, shipping) in bullets.\n- feature_gallery: 3–10 images mapped from provided image URLs; short captions with specific benefits.\n- quick_specs: materials, sizes, colors, delivery window; write specifics (numbers, materials, windows).\n- trust_badges: COD, 24–48h delivery (city), Easy Returns, WhatsApp Support.\n- reviews: 2–4 short quotes with tangible benefits (“stays on during play”, “warm after 2 hours”).\n- cta_block: benefit‑led headline + action‑oriented button (“Get Yours Today”, “Try Risk‑Free”). Add helper microcopy near CTA (“COD available”, “24–48h city delivery”).\n\nAngle & Copy Rules\n- Persona & Pain: Identify top 1–2 buyer personas; hero copy must state their #1 pain and desired outcome.\n- Angle: Choose ONE sharp angle (Safety, Comfort, Speed, Savings) and keep it consistent across sections.\n- Offer Framing: Surface a concrete proof point above the fold.\n- Specificity: Use numbers, materials, sizes, delivery windows, named features. No hype, no emojis, no ALL CAPS.\n- Tone: confident, plain‑spoken, brand‑safe.\n- Language: default English; if {LANGUAGE} provided, write naturally in that language.\n- Mobile First: lines ≤ 72 chars; scannable bullets.\n\nImage Mapping Rules\n- Use ONLY the provided image URLs. Never invent URLs. Never output placeholders.\n- Map first best image to hero; remaining to feature_gallery (up to 10). If no suitable image for a section, set image_url = null.\n- Always provide meaningful image_alt. If colors are provided, include a “colors” section with text pills (no color swatches images).\n\nSEO & Accessibility\n- <title> ≤ 60 chars; <meta name="description"> 140–160 chars; include the primary keyword in H1 and first paragraph.\n- All images: descriptive alt text. Buttons are <a> with clear labels; no color‑only meaning.\n\nHTML Requirements\n- The "html" field must be a complete self‑contained page with ONE <style> tag (no external CSS/JS).\n- Mobile‑first responsive CSS; improve on desktop.\n- Render sections in this order: hero, highlights, feature_gallery, quick_specs, trust_badges, reviews, cta_block, faq (optional).\n- Embed ONLY provided image URLs. No placeholders.\n\nCRO Checklist (auto‑fix before output)\n- Hero states primary benefit + differentiator within 2 lines.\n- ≥1 specific proof above the fold.\n- 4–6 concrete Highlights bullets (objections included).\n- CTA appears in Hero and in CTA Block.\n- Sizes/colors/fit in Quick Specs.\n- Badges present (COD, 24–48h delivery, Easy Returns, WhatsApp Support).\n\nDATA HOOKS (fill from PRODUCT_INFO when available)\n- Materials/Features: {MATERIALS_FEATURES}\n- Sizes/Colors: {SIZES_COLORS}\n- Proof/Tests/Guarantees: {PROOF_POINTS}\n- Offers/Delivery/Returns: {OFFER_DELIVERY_RETURNS}\n- Primary Keyword: {PRIMARY_KEYWORD}\n- Audience: {AUDIENCE}\n- Angle: {ANGLE}\n\nReturn ONLY the JSON object described in Output Contract.'),[eK,eQ]=(0,n.useState)("Ultra eye‑catching ecommerce ad image derived ONLY from the provided product photo.\nRules: Do NOT change product identity (colors/materials/shape/branding). No text or logos.\nLook: premium, high-contrast hero lighting, subtle rim light, soft gradient background, tasteful glow,\nclean reflections/shadow, product-first composition (rule of thirds/center), social-feed ready."),[e$,e0]=(0,n.useState)("Instruction\nFrom the provided source image, detect every distinct visible variant (color/pattern/material) and generate exactly one ad image per variant featuring exactly ONE model wearing the product. Do not redesign the product—match silhouette, seams, textures, prints, and colors precisely.\n\nAd style (must follow):\n\nLook & pose: Professional yet spontaneous; elegant and stylish but natural (mid-step, slight turn, tying laces, casual smile). No exaggerated poses.\n\nWardrobe: Product is the hero; pair with neutral basics only (no logos).\n\nEnvironment (choose one and keep consistent across variants): quiet school corridor, residential street sidewalk, or cozy home interior. Shallow depth-of-field, uncluttered.\n\nLighting & color: Soft, realistic lighting, even exposure, minimal shadows, true color; no color cast.\n\nGlobal constraints: No added text, watermarks, or logos. Keep framing consistent across variants. Skin tones and lighting must be photorealistic.");async function e1(e,t){let a=await fetch(e),i=await a.blob(),n=i.type||"image/png";return new File([i],t,{type:n})}async function e2(e){try{if(!e||0===e.length)return[];let t=[],a=[],i=[];for(let t of(e.forEach((e,t)=>{"string"==typeof e&&e.startsWith("data:")&&i.push(t)}),i))a.push(await e1(e[t],"gen-".concat(t+1,".jpg")));let n=[];if(a.length>0)try{let e=await (0,g.eg)(a);n=Array.isArray(null==e?void 0:e.urls)?e.urls:[]}catch(e){n=[]}let r=0;for(let a=0;a<e.length;a++)e[a].startsWith("data:")?(t.push(n[r]||e[a]),r++):t.push(e[a]);return t}catch(t){return e}}async function e5(e){try{var t;let a=function(){try{return ee.current.nodes.find(e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)==="image_gallery"})}catch(e){return}}(),i=null==a?void 0:null===(t=a.data)||void 0===t?void 0:t.product_gid;if(!i)return await e2(e);let n=(e||[]).filter(e=>"string"==typeof e&&e.startsWith("data:")),r=(e||[]).filter(e=>"string"==typeof e&&!e.startsWith("data:")),s=[];if(n.length>0){let e=await Promise.all(n.map((e,t)=>tq(e,"gen-".concat(t+1,".jpg"),1600,1600,870400)));try{let t=await (0,g.LJ)({product_gid:i,files:e,title:ed,description:""}),a=Array.isArray(null==t?void 0:t.urls)?t.urls:[],n=Array.isArray(null==t?void 0:t.images)?t.images.map(e=>null==e?void 0:e.src).filter(Boolean):[];s=[...s,...a.length>0?a:n]}catch(e){}}if(r.length>0)try{let e=await (0,g.VI)({product_gid:i,image_urls:r,title:ed,description:""}),t=Array.isArray(null==e?void 0:e.urls)?e.urls:[],a=Array.isArray(null==e?void 0:e.images)?e.images.map(e=>null==e?void 0:e.src).filter(Boolean):[];s=[...s,...t.length>0?t:a]}catch(e){}let l=Array.from(new Set(s)).slice(0,20);return l.length>0?l:await e2(e)}catch(t){return e}}let[e3,e4]=(0,n.useState)("Professional, clean background, soft studio lighting, crisp focus, 45\xb0 angle"),[e6,e7]=(0,n.useState)("unisex"),[e8,e9]=(0,n.useState)(""),[te,tt]=(0,n.useState)(""),[ta,ti]=(0,n.useState)("");(0,n.useEffect)(()=>{try{let e=String(e6||"unisex").toLowerCase();e9(localStorage.getItem("ptos_prompts_gemini_ad__".concat(e))||eK),tt(localStorage.getItem("ptos_prompts_gemini_street__".concat(e))||e$),ti(localStorage.getItem("ptos_prompts_gemini_variant_style__".concat(e))||e3)}catch(e){}},[e6]);let[tn,tr]=(0,n.useState)(null),[ts,tl]=(0,n.useState)("preview"),[to,td]=(0,n.useState)(!1),[tc,tu]=(0,n.useState)("inputs"),[tp,tm]=(0,n.useState)(!0),[tg,tv]=(0,n.useState)([]),[th,tf]=(0,n.useState)([]),[tx,ty]=(0,n.useState)("");(0,n.useEffect)(()=>{(async()=>{try{let e=await (0,g.l9)();(null==e?void 0:e.data)&&tf(e.data)}catch(e){}})()},[]),(0,n.useEffect)(()=>{try{let e=localStorage.getItem("ptos_prompts_angles");e&&eJ(e);let t=localStorage.getItem("ptos_prompts_title_desc");t&&eH(t);let a=localStorage.getItem("ptos_prompts_landing_copy");a&&eV(a);let i=localStorage.getItem("ptos_prompts_gemini_ad");i&&eQ(i);let n=localStorage.getItem("ptos_prompts_gemini_variant_style");n&&e4(n);let r=localStorage.getItem("ptos_prompts_gemini_street");r&&e0(r)}catch(e){}},[]),(0,n.useEffect)(()=>{(async()=>{try{let e=await (0,g.aW)();if(e&&"object"==typeof e){if("string"==typeof e.angles_prompt){eJ(e.angles_prompt);try{localStorage.setItem("ptos_prompts_angles",e.angles_prompt)}catch(e){}}if("string"==typeof e.title_desc_prompt){eH(e.title_desc_prompt);try{localStorage.setItem("ptos_prompts_title_desc",e.title_desc_prompt)}catch(e){}}if("string"==typeof e.landing_copy_prompt){eV(e.landing_copy_prompt);try{localStorage.setItem("ptos_prompts_landing_copy",e.landing_copy_prompt)}catch(e){}}if("string"==typeof e.gemini_ad_prompt){eQ(e.gemini_ad_prompt);try{localStorage.setItem("ptos_prompts_gemini_ad",e.gemini_ad_prompt)}catch(e){}}if("string"==typeof e.gemini_variant_style_prompt){e4(e.gemini_variant_style_prompt);try{localStorage.setItem("ptos_prompts_gemini_variant_style",e.gemini_variant_style_prompt)}catch(e){}}}}catch(e){}})()},[]),(0,n.useEffect)(()=>{try{localStorage.setItem("ptos_prompts_angles",eY)}catch(e){}},[eY]),(0,n.useEffect)(()=>{try{localStorage.setItem("ptos_prompts_title_desc",eq)}catch(e){}},[eq]),(0,n.useEffect)(()=>{try{localStorage.setItem("ptos_prompts_landing_copy",eX)}catch(e){}},[eX]),(0,n.useEffect)(()=>{try{localStorage.setItem("ptos_prompts_gemini_ad",eK)}catch(e){}},[eK]),(0,n.useEffect)(()=>{try{localStorage.setItem("ptos_prompts_gemini_variant_style",e3)}catch(e){}},[e3]),(0,n.useEffect)(()=>{try{localStorage.setItem("ptos_prompts_gemini_street",e$)}catch(e){}},[e$]),(0,n.useEffect)(()=>{try{let e=String(el||"").toLowerCase()||"unisex",t="girl"===e||"boy"===e||"unisex_kids"===e||"men"===e||"women"===e||"unisex"===e?e:"unisex",a=localStorage.getItem("ptos_prompts_gemini_ad__".concat(t));a&&eQ(a);let i=localStorage.getItem("ptos_prompts_gemini_street__".concat(t));i&&e0(i);let n=localStorage.getItem("ptos_prompts_gemini_variant_style__".concat(t));n&&e4(n)}catch(e){}},[el]),(0,n.useEffect)(()=>{G(e=>({...e,nodes:e.nodes.map(e=>{var t,a;return(null===(t=e.data)||void 0===t?void 0:t.type)==="gemini_ad_images"&&(null===(a=e.data)||void 0===a?void 0:a.use_global_prompt)!==!1?{...e,data:{...e.data,prompt:eK}}:e})}))},[eK]),(0,n.useEffect)(()=>{G(e=>({...e,nodes:e.nodes.map(e=>{var t,a;return(null===(t=e.data)||void 0===t?void 0:t.type)==="gemini_variant_set"&&(null===(a=e.data)||void 0===a?void 0:a.use_global_style)!==!1?{...e,data:{...e.data,style_prompt:e3}}:e})}))},[e3]);let[t_,tb]=(0,n.useState)(void 0),[tj,tw]=(0,n.useState)(null),tN=U.nodes.find(e=>e.id===L)||null,[tA,tS]=(0,n.useState)(null);function tC(e,t,a){Q(i=>[...i,{time:O(),level:e,msg:t,nodeId:a}])}function tk(e,t){G(a=>({...a,nodes:a.nodes.map(a=>a.id===e?{...a,run:{...a.run,...t}}:a)}))}(0,n.useEffect)(()=>{try{t_&&sessionStorage.setItem("ptos_last_test_id",t_)}catch(e){}},[t_]);let tO=(0,n.useRef)({id:null,offsetX:0,offsetY:0});function tI(e,t){let a=e.currentTarget.getBoundingClientRect();tO.current={id:t.id,offsetX:e.clientX-a.left,offsetY:e.clientY-a.top},Z(t.id)}let tE=(0,n.useRef)({active:!1,startX:0,startY:0,origX:0,origY:0}),tP=(0,n.useRef)(null),tR=(0,n.useRef)(null);async function tM(e){var t,a;let i=ee.current.nodes.find(t=>t.id===e);if(!i)return;let n=String((null===(t=i.data)||void 0===t?void 0:t.prompt)||eq);tk(e,{status:"running",startedAt:O()});try{let t=eB;(eC||[]).length>0&&!t&&(t=(await (0,g.eg)(eC)).urls||[],eW(t));let r=await (0,g.hw)({product:{audience:er,benefits:em,pain_points:ev,base_price:""===eu?void 0:Number(eu),title:ed||void 0,sizes:ef,colors:ey,target_category:el},angle:null===(a=i.data)||void 0===a?void 0:a.angle,prompt:n,model:eF,image_urls:(t||[]).slice(0,1)});tk(e,{status:"success",output:r})}catch(t){tk(e,{status:"error",error:String((null==t?void 0:t.message)||t)})}}async function tU(){try{var e,t,a;let i,n,r;let s=eB;if((eC||[]).length>0&&!s)try{if(!h&&!et.current){let e=ed||"Product",t=await (0,g.KQ)({product:{audience:er,benefits:em,pain_points:ev,base_price:""===eu?void 0:Number(eu),title:e,sizes:ef,colors:ey,target_category:el,track_quantity:eb,quantity:""===ew?void 0:Number(ew)},angle:void 0,title:e,description:""});et.current=null==t?void 0:t.product_gid;let a=null==t?void 0:t.handle;a&&ei(a)}if(!h&&et.current){try{let e=await (0,g.th)({product_gid:et.current,base_price:""===eu?void 0:Number(eu),sizes:ef,colors:ey,track_quantity:eb,quantity:""===ew?void 0:Number(ew)});e&&Array.isArray(e.skipped)&&eS(e.skipped)}catch(e){}let e=await (0,g.LJ)({product_gid:et.current,files:eC,title:ed||"Product",description:""}),t=Array.isArray(null==e?void 0:e.urls)?e.urls:[],a=Array.isArray(null==e?void 0:e.images)?e.images.map(e=>null==e?void 0:e.src).filter(Boolean):[];s=t.length>0?t:a,eW(s),s[0]&&eI(s[0])}}catch(e){s=(await (0,g.eg)(eC)).urls||[],eW(s)}let l={nodes:ee.current.nodes.map(e=>({id:e.id,type:e.type,x:e.x,y:e.y,data:e.data,run:{status:"idle",output:null,error:null,startedAt:null,finishedAt:null,ms:0}})),edges:ee.current.edges},o=ee.current.nodes.find(e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)==="image_gallery"}),d=(null==o?void 0:null===(e=o.run)||void 0===e?void 0:e.output)||{},c=Array.isArray(null==d?void 0:d.images)?d.images:[],u=(null==o?void 0:null===(t=o.data)||void 0===t?void 0:t.selected)||{};!tp&&(tx?n={saved_audience_id:tx}:tg.length>0&&(n={geo_locations:{countries:tg.map(e=>e.toUpperCase())}}));try{let e=ee.current.nodes.find(e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)==="image_gallery"}),t=(null==e?void 0:null===(a=e.run)||void 0===a?void 0:a.output)||{},i=Array.isArray(null==t?void 0:t.selected_shopify_urls)?t.selected_shopify_urls:Array.isArray(null==t?void 0:t.images)?t.images.filter(e=>e.startsWith("https://cdn.shopify.com")):[];Array.isArray(i)&&i.length>0&&(r=i[0])}catch(e){}if(!r)try{Array.isArray(s)&&s[0]&&s[0].startsWith("https://cdn.shopify.com")&&(r=s[0])}catch(e){}let p={product:{audience:er,benefits:em,pain_points:ev,base_price:""===eu?void 0:Number(eu),title:ed||void 0,sizes:ef,colors:ey,variant_descriptions:eG,target_category:el},image_urls:s||[],flow:l,ui:{pan:Y,zoom:B,selected:L,promotion_free_image_url:eR,promotion_offer_text:eU,gallery_images:c,gallery_selected:u,active_left_tab:tc},prompts:{angles_prompt:eY,title_desc_prompt:eq,landing_copy_prompt:eX,gemini_ad_prompt:eK,gemini_variant_style_prompt:e3,gemini_street_prompt:e$},settings:{flow_type:h?"promotion":void 0,model:eF,advantage_plus:tp,adset_budget:""===eT?void 0:Number(eT),targeting:n,countries:tg,saved_audience_id:tx||void 0},...r?{card_image:r}:{}};i=t_?await (0,g.XD)(t_,p):await (0,g.DO)(p),tb(i.id);try{let e={...p.product||{},uploaded_images:p.image_urls||[],flow:p.flow,ui:p.ui,prompts:p.prompts,settings:p.settings};sessionStorage.setItem("flow_cache_".concat(i.id),JSON.stringify(e))}catch(e){}}catch(e){}}function tD(e){var t;let a=ee.current.nodes.find(t=>t.id===e);if(!a)return;let i=null===(t=a.run)||void 0===t?void 0:t.output;(null==i?void 0:i.title)&&G(t=>{let a=t.nodes.map(t=>t.id===e?{...t,data:{...t.data,approved:!0}}:t),n=a.find(t=>t.id===e),r=E("action",n.x+300,n.y,{label:"Title & Description",type:"title_desc",value:{title:i.title,description:i.description},landingPrompt:"Generate a concise landing page section (headline, subheadline, 2-3 bullets) based on the title and description."}),s=[...t.edges,P(e,"out",r.id,"in")],l={nodes:[...a,r],edges:s};return ee.current=l,l})}async function tG(e){var t;let a=ee.current.nodes.find(t=>t.id===e);if(!a)return;let i=(null===(t=a.data)||void 0===t?void 0:t.value)||{},n=String(i.title||"").trim()||String(ed||"").trim()||"Offer",r=String(i.description||"").trim();G(t=>({...t,nodes:t.nodes.map(t=>t.id===e?{...t,data:{...t.data,value:{title:n,description:r}}}:t)})),tk(e,{status:"running",startedAt:O()});try{let t,i,s,l,o;if(h){tk(e,{status:"error",error:"Product creation is disabled in Promotion mode."});return}G(i=>{let n=E("action",a.x+300,a.y,{label:"Create Product",type:"create_product"}),r=[...i.edges,P(e,"out",n.id,"in")],s={nodes:[...i.nodes,n],edges:r};return ee.current=s,t=n.id,s});let d=et.current,c=ea;if(d){let e=String(n||"").trim();if(e)try{await (0,g.sm)({product_gid:d,title:e})}catch(e){}}else{let e=await (0,g.KQ)({product:{audience:er,benefits:em,pain_points:ev,base_price:""===eu?void 0:Number(eu),title:n,sizes:ef,colors:ey,target_category:el,track_quantity:eb,quantity:""===ew?void 0:Number(ew)},angle:void 0,title:n,description:r});d=e.product_gid||null,c=e.handle||void 0,et.current=d,c&&ei(c);try{let t=null==e?void 0:e.report;t&&Array.isArray(t.skipped)&&eS(t.skipped)}catch(e){}}t&&tk(t,{status:"success",output:{product_gid:d}});try{if(d){let e=await (0,g.th)({product_gid:d,base_price:""===eu?void 0:Number(eu),sizes:ef,colors:ey,track_quantity:eb,quantity:""===ew?void 0:Number(ew)});e&&Array.isArray(e.skipped)&&eS(e.skipped)}}catch(e){}G(e=>{let n=E("action",a.x+300,a.y+140,{label:"Upload Images to Product",type:"upload_images"}),r=[...e.edges,P(t,"out",n.id,"in")],s={nodes:[...e.nodes,n],edges:r};return ee.current=s,i=n.id,s});let u=[];if((eC||[]).length>0&&d){let e=await (0,g.LJ)({product_gid:d,files:eC,title:n,description:r}),t=Array.isArray(null==e?void 0:e.urls)?e.urls:[],a=Array.isArray(null==e?void 0:e.images)?e.images.map(e=>null==e?void 0:e.src).filter(Boolean):[];u=t.length>0?t:a,s=e.images,l=e.per_image}i&&tk(i,{status:"success",output:{images_shopify:u,shopify_images:s||[],per_image:l||[]}}),u.length>0&&(eW(u),eI(u[0]));try{let e=(u||[])[0];if(e){let t,n=String(eK||"Create a high‑quality ad image from this product photo.");try{let e=[];for(let t of ef||[]){let a=String(t||"").match(/[-+]?[0-9]*\.?[0-9]+/g);a&&a.forEach(t=>{let a=Number(t);Number.isNaN(a)||e.push(a)})}if(e.length>0){let t=Math.min(...e),a=Math.max(...e),i=t===a?t:(t+a)/2,r=1e-6>Math.abs(i-Math.round(i))?String(Math.round(i)):String(Number(i.toFixed(1)));n+=" Ensure the product shown is size ".concat(r," (midpoint of provided range).")}}catch(e){}G(r=>{let s=r.nodes.find(e=>e.id===i)||{x:a.x+300,y:a.y+140},l=n;try{let e=String(el||"").toLowerCase();e&&(l+=" If a human model is shown, ensure it matches this category: ".concat("girl"===e?"girl":"boy"===e?"boy":"unisex_kids"===e?"child":"men"===e?"man":"women"===e?"woman":"person","."))}catch(e){}let o=E("action",s.x,s.y+240,{label:"Gemini Ad Images",type:"gemini_ad_images",prompt:l,source_image_url:e,neutral_background:!0,use_global_prompt:!0}),d=[...r.edges,P(i,"out",o.id,"in")],c={nodes:[...r.nodes,o],edges:d};return ee.current=c,t=o.id,c}),G(n=>{let r=n.nodes.find(e=>e.id===t)||{x:a.x+300,y:a.y+380},s=(()=>{let e=String(el||"").toLowerCase();return"girl"===e?"girl (approx. 2–6 years)":"boy"===e?"boy (approx. 2–6 years)":"unisex_kids"===e?"child (approx. 2–6 years)":"men"===e?"adult man":"women"===e?"adult woman":"person"})(),l=String(e$||""),o="".concat(l,"\n\n")+"Source: ".concat(e,"\n")+"Product type: ".concat(ed?String(ed):"from the source image","\n")+"Model: ".concat(s,". Only one character in frame."),d=E("action",r.x,r.y+140,{label:"Gemini Ad Images — Natural Street Scene",type:"gemini_ad_images",prompt:o,source_image_url:e,neutral_background:!1,use_global_prompt:!1}),c=[...n.edges,P(i,"out",d.id,"in")],u={nodes:[...n.nodes,d],edges:c};return ee.current=u,t=d.id,u}),G(n=>{let r=n.nodes.find(e=>e.id===t)||{x:a.x+300,y:a.y+280},s=E("action",r.x,r.y+140,{label:"Gemini Feature/Benefit Close-ups",type:"gemini_feature_benefit_set",source_image_url:e,count:6}),l=[...n.edges,P(i,"out",s.id,"in")],o={nodes:[...n.nodes,s],edges:l};return ee.current=o,o}),G(n=>{let r=n.nodes.find(e=>e.id===t)||{x:a.x+300,y:a.y+280},s=E("action",r.x,r.y+300,{label:"Gemini Variant Set",type:"gemini_variant_set",source_image_url:e,style_prompt:String(e3||""),max_variants:5,use_global_style:!0}),l=[...n.edges,P(i,"out",s.id,"in")],o={nodes:[...n.nodes,s],edges:l};return ee.current=o,o})}}catch(e){}G(e=>{let t=e.nodes.filter(e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)&&String(e.data.type).startsWith("gemini_")}),s=t[t.length-1]||e.nodes.find(e=>e.id===i)||{x:a.x+300,y:a.y+140},l=E("action",s.x+300,s.y,{label:"Select Images",type:"image_gallery",product_gid:d,product_handle:c,title:n,description:r,landing_prompt:eX,selected:{}}),u=[...e.edges,P(i,"out",l.id,"in")];t.forEach(e=>{u=[...u,P(e.id,"out",l.id,"in")]});let p={nodes:[...e.nodes,l],edges:u};return ee.current=p,o=l.id,p}),o&&tk(o,{status:"idle",output:{images:u||[]}}),tk(e,{status:"success",output:{message:"Product created. Select images in gallery to generate landing."}})}catch(t){tk(e,{status:"error",error:String((null==t?void 0:t.message)||t)})}}async function tL(e,t){try{var a,i;if(!t||0===t.length)return;let n=ee.current.nodes.find(t=>t.id===e);if(!n)return;let r=Array.isArray(null===(i=n.run)||void 0===i?void 0:null===(a=i.output)||void 0===a?void 0:a.images)?n.run.output.images:[],s=Array.from(new Set([...r||[],...t]));G(t=>({...t,nodes:t.nodes.map(t=>{var a;return t.id===e?{...t,run:{...t.run,output:{...(null===(a=t.run)||void 0===a?void 0:a.output)||{},images:s}}}:t})}))}catch(e){}}async function tT(e){try{if(!e||0===e.length)return;let t=ee.current.nodes.find(e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)==="image_gallery"});t&&await tL(t.id,e)}catch(e){}}async function tz(e,t){var a,i,n,r,s,l,o,d,c,u,p,m,v;let h=ee.current.nodes.find(t=>t.id===e);if(!h)return;let f=null===(a=h.data)||void 0===a?void 0:a.source_image_url;if(!f){tk(e,{status:"error",error:"Missing source_image_url"});return}tk(e,{status:"running",startedAt:O()});try{let a=null;if((null===(i=h.data)||void 0===i?void 0:i.type)==="gemini_variant_set"){let i=String((null===(r=h.data)||void 0===r?void 0:r.style_prompt)||e3||""),n="number"==typeof(null===(s=h.data)||void 0===s?void 0:s.max_variants)?h.data.max_variants:void 0,l=(eG||[]).map(e=>({name:e.name,description:e.description}));(null==t?void 0:t.variantOverride)&&Array.isArray(t.variantOverride)&&t.variantOverride.length>0&&(l=t.variantOverride.map(e=>({name:e.name,description:e.description}))),a=await (0,g.rU)({image_url:f,style_prompt:i||void 0,max_variants:n,variant_descriptions:l.length?l:void 0});try{let e=Array.isArray(null==a?void 0:a.items)?a.items:[],t=e.map(e=>null==e?void 0:e.image).filter(Boolean),i=await e5(t),n=e.map((e,t)=>({...e,image:i[t]||e.image}));a={...a||{},items:n}}catch(e){}tk(e,{status:"success",output:a})}else if((null===(n=h.data)||void 0===n?void 0:n.type)==="gemini_feature_benefit_set"){a=await (0,g.sF)({product:{audience:er,benefits:em,pain_points:ev,base_price:""===eu?void 0:Number(eu),title:ed||void 0,sizes:ef,colors:ey,target_category:el},image_url:f,count:"number"==typeof(null===(l=h.data)||void 0===l?void 0:l.count)?h.data.count:6});try{let e=Array.isArray(null==a?void 0:a.items)?a.items:[],t=e.map(e=>null==e?void 0:e.image).filter(Boolean),i=await e5(t),n=e.map((e,t)=>({...e,image:i[t]||e.image}));a={...a||{},items:n}}catch(e){}tk(e,{status:"success",output:a})}else{let t=(null===(o=h.data)||void 0===o?void 0:o.use_global_prompt)!==!1,i=String((t?eK:null===(d=h.data)||void 0===d?void 0:d.prompt)||eK||"Create a high-quality ad image from this product photo.");try{let e=[];for(let t of ef||[]){let a=String(t||"").match(/[-+]?[0-9]*\.?[0-9]+/g);a&&a.forEach(t=>{let a=Number(t);Number.isNaN(a)||e.push(a)})}if(e.length>0){let t=Math.min(...e),a=Math.max(...e),n=t===a?t:(t+a)/2,r=1e-6>Math.abs(n-Math.round(n))?String(Math.round(n)):String(Number(n.toFixed(1)));i+=" Ensure the product shown is size ".concat(r," (midpoint of provided range).")}}catch(e){}let n="number"==typeof(null===(c=h.data)||void 0===c?void 0:c.num_images)&&h.data.num_images>0?h.data.num_images:4;a=await (0,g.oB)({image_url:f,prompt:i,num_images:n,neutral_background:(null===(u=h.data)||void 0===u?void 0:u.neutral_background)!==!1});try{let e=Array.isArray(null==a?void 0:a.images)?a.images:[],t=await e5(e);a={...a||{},images:t}}catch(e){}tk(e,{status:"success",output:a});try{let e=ee.current.nodes.find(e=>{var t,a;return(null===(t=e.data)||void 0===t?void 0:t.type)==="gemini_feature_benefit_set"&&(null===(a=e.data)||void 0===a?void 0:a.source_image_url)===f});e&&(null===(p=e.run)||void 0===p?void 0:p.status)==="idle"&&await tz(e.id)}catch(e){}}try{let e=ee.current.nodes.find(e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)==="image_gallery"});if(e){let t=[];t=(null===(m=h.data)||void 0===m?void 0:m.type)==="gemini_variant_set"||(null===(v=h.data)||void 0===v?void 0:v.type)==="gemini_feature_benefit_set"?(Array.isArray((a||{}).items)?a.items:[]).map(e=>null==e?void 0:e.image).filter(Boolean):Array.isArray((a||{}).images)?a.images:[],await tL(e.id,t)}}catch(e){}try{await tU()}catch(e){}}catch(t){tk(e,{status:"error",error:String((null==t?void 0:t.message)||t)})}}function tF(){return JSON.stringify({audience:er,benefits:em,pain_points:ev,base_price:""===eu?void 0:Number(eu),title:ed||void 0,sizes:ef,colors:ey,target_category:el})}function tZ(){let e=tF(),t=eR||(eB||[])[0]||"";return"You are a senior direct-response marketer and offer strategist.\nTask: Based on PRODUCT_INFO, propose exactly three distinct promotional offers for a test campaign. Each offer must be concrete, believable, and easy to execute in e‑commerce. Include one value-led discount offer, one bundle/BOGO offer, and one urgency/limited-time add-on offer. If PRODUCT_INFO has a reference image, consider what visuals would best sell each offer.\n\nOutput: Return ONE valid json object only with fields: instructions (string, 3–6 sentences with marketing ideas and tips to make the offers succeed), offers[3] each with { name, headline, subheadline, mechanics, price_anchor, risk_reversal, visual_idea }.\n\n"+"PRODUCT_INFO: ".concat(e,"\n")+(eU?"PREFERRED_OFFER: ".concat(eU,"\n"):"")+(t?"REFERENCE_IMAGE_URL: ".concat(t,"\n"):"")+"CRITICAL: No markdown. JSON only."}async function tB(){try{var e;let t;if(G(e=>{let a=e.nodes.find(e=>"trigger"===e.type)||{id:k(),type:"trigger",x:120,y:140,data:{name:"Promotion",topic:"promotion_start"},selected:!1,run:{status:"idle",output:null,error:null,startedAt:null,finishedAt:null,ms:0}},i=e.nodes.find(e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)==="promotion_generate_offers"});if(i)return t=i.id,e;let n=E("action",a.x+300,a.y,{label:"Generate Offers",type:"promotion_generate_offers",numOffers:3,prompt:tZ()}),r=[...e.edges,P(a.id,"out",n.id,"in")],s={nodes:[...e.nodes,n],edges:r};return ee.current=s,t=n.id,s}),!t)return;let a=t,i=tZ();G(e=>({...e,nodes:e.nodes.map(e=>e.id===a?{...e,data:{...e.data,prompt:String(i)}}:e)})),tk(a,{status:"running",startedAt:O()});let n=String(i),r=await (0,g.PN)({product:{audience:er,benefits:em,pain_points:ev,base_price:""===eu?void 0:Number(eu),title:ed||void 0,sizes:ef,colors:ey,target_category:el},num_angles:3,model:eF,prompt:n}),s=[];try{Array.isArray(null==r?void 0:r.offers)?s=null==r?void 0:r.offers:Array.isArray(null==r?void 0:r.angles)&&(s=null==r?void 0:r.angles.map(e=>{var t,a;return{name:(null==e?void 0:e.name)||"Offer",headline:((null==e?void 0:e.headlines)||[])[0]||(null==e?void 0:e.big_idea)||(null==e?void 0:e.promise)||"Offer",subheadline:(null==e?void 0:null===(t=e.lp_snippet)||void 0===t?void 0:t.subheadline)||"",mechanics:(null==e?void 0:e.promise)||"",price_anchor:((null==e?void 0:e.ksp)||[]).join("; "),risk_reversal:Array.isArray(null==e?void 0:e.objections)?e.objections.map(e=>null==e?void 0:e.rebuttal).filter(Boolean).join(" • "):"",visual_idea:(null==e?void 0:null===(a=e.image_map)||void 0===a?void 0:a.notes)||""}}))}catch(e){}let l=(null==r?void 0:r.instructions)||(null==r?void 0:null===(e=r.diagnosis)||void 0===e?void 0:e.why_these_angles)||"Follow CRO best practices and ensure clarity, proof, and risk reversal.";tk(a,{status:"success",output:{count:s.length,instructions:l,offers:s}}),G(e=>{let t=e.nodes,i=e.edges,n=t.find(e=>e.id===a)||{x:420,y:120},r=Math.min(3,Math.max(0,s.length||3));for(let e=0;e<r;e++){let r=s[e]||{name:"Offer ".concat(e+1),headline:"",subheadline:""},l=E("action",n.x+300,n.y+160*e,{label:"Offer ".concat(e+1),type:"promotion_offer",offer:r});t=[...t,l],i=[...i,P(a,"out",l.id,"in")]}let l={nodes:t,edges:i};return ee.current=l,l})}catch(e){try{let t=ee.current.nodes.find(e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)==="promotion_generate_offers"});t&&tk(t.id,{status:"error",error:String((null==e?void 0:e.message)||e)})}catch(e){}}}async function tW(e){var t,a;let i;let n=ee.current.nodes.find(t=>t.id===e);if(!n)return;let r=(eB||[])[0]||eO,s=eR||"",l=r||s;if(!l){alert("Upload or provide a main product image in Product inputs.");return}let o=(null===(t=n.data)||void 0===t?void 0:t.offer)||(null===(a=n.data)||void 0===a?void 0:a.offer_full)||{},d=[];(null==o?void 0:o.name)&&d.push(String(o.name)),(null==o?void 0:o.headline)&&d.push("Headline: "+String(o.headline)),(null==o?void 0:o.subheadline)&&d.push("Subheadline: "+String(o.subheadline)),Array.isArray(null==o?void 0:o.bullets)&&d.push("Bullets: "+String((o.bullets||[]).join(" • "))),(null==o?void 0:o.visual_idea)&&d.push("Visual idea: "+String(o.visual_idea)),Array.isArray(null==o?void 0:o.creative_text)&&d.push("On-image banners: "+String((o.creative_text||[]).join(" | ")));let c="You are a senior media buyer and ecommerce marketing art director. Create three distinct, super eye-catching promotional ad images with bold banners and clear discount tags based on this offer. Keep product identity identical to the reference photo (shape, color, print, materials). Match the target audience and category.\n\n"+d.join("\n")+"\n\n"+(s?"Include a small secondary picture-in-picture using FREE_PRODUCT_IMAGE_URL as a “Free gift” badge when compositionally appropriate. FREE_PRODUCT_IMAGE_URL: ".concat(s,"\n"):"")+(r?"MAIN_IMAGE_URL: ".concat(r,"\n"):"")+"Ensure conversion-focused layout, strong callouts, and legible on-image text if included. Use vibrant accents that fit the brand. Provide high-contrast hero lighting and clean composition. Social-feed ready.";G(t=>{let a=E("action",n.x+300,n.y,{label:"Gemini Offer Image",type:"gemini_ad_images",prompt:c,source_image_url:l,neutral_background:!1,use_global_prompt:!1,num_images:4}),r=[...t.edges,P(e,"out",a.id,"in")],s={nodes:[...t.nodes,a],edges:r};return ee.current=s,i=a.id,s}),i&&await tz(i)}async function tY(e){var t,a;let i=ee.current.nodes.find(t=>t.id===e);if(!i)return;let n=(null===(t=i.data)||void 0===t?void 0:t.offer)||{},r=tF(),s="".concat(String((null===(a=i.data)||void 0===a?void 0:a.offer_prompt)||"You are a highly skilled, knowledgeable direct-response marketing expert. Expand the following OFFER_IDEA into a complete, compelling promotional offer ready for Meta ads.\nReturn ONE valid json object only with fields: offer { name, headline, subheadline, bullets[3-6], mechanics, price_anchor, risk_reversal, guarantee, urgency, CTA_label, creative_text[3-6] }.\nRules: headlines ≤ 12 words; subheadline ≤ 18 words; bullets are concrete benefits; no emojis; clear, believable, specific; English only."),"\n\nPRODUCT_INFO: ").concat(r,"\nOFFER_IDEA: ").concat(JSON.stringify(n)),l=await (0,g.PN)({product:{audience:er,benefits:em,pain_points:ev,base_price:""===eu?void 0:Number(eu),title:ed||void 0,sizes:ef,colors:ey,target_category:el},num_angles:1,model:eF,prompt:s}),o=null;try{(null==l?void 0:l.offer)?o=l.offer:(null==l?void 0:l.offers)&&Array.isArray(l.offers)?o=l.offers[0]:("string"==typeof(null==l?void 0:l.headline)||"string"==typeof(null==l?void 0:l.subheadline))&&(o=l)}catch(e){}if(!o){alert("Offer generation failed.");return}G(t=>{let a=E("action",i.x+300,i.y,{label:"Offer Copy",type:"promotion_offer_copy",offer_full:o}),n=[...t.edges,P(e,"out",a.id,"in")],r={nodes:[...t.nodes,a],edges:n};return ee.current=r,r})}async function tJ(e){var t,a,i,n,r,s,l,o,d;let c=ee.current.nodes.find(t=>t.id===e);if(!c)return;let u=null===(t=c.data)||void 0===t?void 0:t.product_gid,p=null===(a=c.data)||void 0===a?void 0:a.product_handle,m=(null===(i=c.data)||void 0===i?void 0:i.title)||ed,v=(null===(n=c.data)||void 0===n?void 0:n.description)||"",h=(null===(r=c.data)||void 0===r?void 0:r.selected)||{},f=Array.isArray(null===(l=c.run)||void 0===l?void 0:null===(s=l.output)||void 0===s?void 0:s.images)?c.run.output.images:[],x=f.filter(e=>h[e]);if(0===x.length){tk(e,{status:"error",error:"Select at least one image."});return}if(!u){tk(e,{status:"error",error:"Missing product GID."});return}tk(e,{status:"running",startedAt:O()});try{let t;let a=x.filter(e=>e.startsWith("data:")),i=x.filter(e=>!e.startsWith("data:")),n=[];if(a.length>0){let e=await Promise.all(a.map((e,t)=>tq(e,"gallery-".concat(t+1,".jpg"),1600,1600,870400))),t=await (0,g.LJ)({product_gid:u,files:e,title:m,description:v}),i=Array.isArray(null==t?void 0:t.urls)?t.urls:[],r=Array.isArray(null==t?void 0:t.images)?t.images.map(e=>null==e?void 0:e.src).filter(Boolean):[];n=[...n,...i.length>0?i:r]}if(i.length>0){let e=await (0,g.VI)({product_gid:u,image_urls:i,title:m,description:v}),t=Array.isArray(null==e?void 0:e.urls)?e.urls:[],a=Array.isArray(null==e?void 0:e.images)?e.images.map(e=>null==e?void 0:e.src).filter(Boolean):[];n=[...n,...t.length>0?t:a]}n=Array.from(new Set(n));let r=Array.from(new Set([...n,...i])).slice(0,10),s=Array.from(new Set([...n,...i,...a])).slice(0,10),l=String((null===(o=c.data)||void 0===o?void 0:o.landing_prompt)||eX),h=await (0,g.WM)({product:{audience:er,benefits:em,pain_points:ev,base_price:""===eu?void 0:Number(eu),title:m||void 0,sizes:ef,colors:ey,target_category:el},angle:void 0,title:m,description:v,model:eF,image_urls:r,prompt:l,product_handle:p}),y=((e,t,a)=>{let i=(t||[]).filter(Boolean).slice(0,10),n=(Array.isArray(null==e?void 0:e.sections)?e.sections:[]).map((e,t)=>({...e,image_url:i[t%Math.max(i.length,1)]||null,image_alt:(null==e?void 0:e.image_alt)||a})),r=n.findIndex(e=>(null==e?void 0:e.id)==="hero");return r>=0&&(n[r].image_url=i[0]||null),{...e,sections:n,assets_used:{...(null==e?void 0:e.assets_used)||{},hero:i[0]||null,feature_gallery:i}}})(h,s,m),_=await (0,g.Sv)({title:m,landing_copy:y,image_urls:[],product_gid:u});if(G(a=>{var i;let n=E("action",c.x+300,c.y,{label:"Create Landing",type:"create_landing",prompt:(null===(i=c.data)||void 0===i?void 0:i.landing_prompt)||eX,image_urls:s}),r=[...a.edges,P(e,"out",n.id,"in")],l={nodes:[...a.nodes,n],edges:r};return ee.current=l,t=n.id,l}),t){tk(t,{status:"success",output:{url:_.page_url||null,prompt:(null===(d=c.data)||void 0===d?void 0:d.landing_prompt)||eX,image_urls:s,landing_copy:y,title:m,description:v}});try{let e={landing_url:_.page_url||null,title:m,images:n};sessionStorage.setItem("ptos_transfer_landing",JSON.stringify(e))}catch(e){}try{window.location.href="/ads"}catch(e){}}tk(e,{status:"success",output:{images:f,selected:n,selected_shopify_urls:n,page_url:_.page_url||null}})}catch(t){tk(e,{status:"error",error:String((null==t?void 0:t.message)||t)})}}async function tq(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1600,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1600,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:870400,r=await new Promise((t,a)=>{let i=new Image;i.crossOrigin="anonymous",i.onload=()=>t(i),i.onerror=a,i.src=e}),s=Math.min(1,a/(r.naturalWidth||r.width||1),i/(r.naturalHeight||r.height||1)),l=Math.max(1,Math.round((r.naturalWidth||r.width)*s)),o=Math.max(1,Math.round((r.naturalHeight||r.height)*s)),d=document.createElement("canvas");d.width=l,d.height=o,d.getContext("2d").drawImage(r,0,0,l,o);let c=.92,u=await new Promise(e=>d.toBlob(t=>e(t),"image/jpeg",c));for(;u&&u.size>n&&c>.6;)c-=.08,u=await new Promise(e=>d.toBlob(t=>e(t),"image/jpeg",c));if(!u){let a=await fetch(e),i=await a.blob();return new File([i],t,{type:i.type||"image/jpeg"})}return new File([u],t,{type:"image/jpeg"})}async function tH(){if(q)return;Q([]),G(e=>({...e,nodes:e.nodes.map(e=>({...e,run:{status:"idle",output:null,error:null,startedAt:null,finishedAt:null,ms:0}}))})),H(!0),tb(void 0),tw(null);let e=U.nodes.find(e=>"trigger"===e.type);if(!e){H(!1);return}await tX(e.id,{refs:{}}),H(!1),ee.current}async function tX(e,t){V(e);let a=U.nodes.find(t=>t.id===e);if(!a)return;let i=performance.now();tk(e,{status:"running",startedAt:O()});try{if("action"===a.type){var n;let i=await tV(a,t);if(tk(e,{status:"success",output:i}),tC("info","✓ ".concat(a.data.label||a.data.type," → done"),e),(null===(n=a.data)||void 0===n?void 0:n.type)==="image_gallery"){tC("info","Waiting for image selection…",e),H(!1);return}}else if("trigger"===a.type)tC("info","▶ trigger: ".concat(a.data.topic||"start"),e);else if("delay"===a.type){let t=Number(a.data.minutes||0);tC("info","⏱ waiting ".concat(t," minute(s) (simulated)"),e),await I(600),tk(e,{status:"success",output:{waited_minutes:t}})}for(let a of(ee.current.edges||[]).filter(t=>t.from===e))await tX(a.to,t)}catch(t){tk(e,{status:"error",error:String((null==t?void 0:t.message)||t)}),tC("error","✗ ".concat(a.data.label||a.data.type," → ").concat(String((null==t?void 0:t.message)||t)),e)}!function(e,t){let a=Math.max(1,Math.round(performance.now()-t));tk(e,{finishedAt:O(),ms:a})}(e,i)}async function tV(e,t){var a,i,n,r,s;let l=e.data.type;if(await I(300+300*Math.random()),"title_desc"===l){let t=(null===(a=e.data)||void 0===a?void 0:a.value)||{};return{title:String(t.title||ed||"").trim(),description:String(t.description||"").trim()}}if("promotion_generate_offers"===l){let t=String(tZ());G(a=>({...a,nodes:a.nodes.map(a=>a.id===e.id?{...a,data:{...a.data,prompt:t}}:a)}));let a=Math.max(1,Math.min(5,Number((null===(i=e.data)||void 0===i?void 0:i.numOffers)||3))),r=await (0,g.PN)({product:{audience:er,benefits:em,pain_points:ev,base_price:""===eu?void 0:Number(eu),title:ed||void 0,sizes:ef,colors:ey,target_category:el},num_angles:a,model:eF,prompt:t}),s=[];try{Array.isArray(null==r?void 0:r.offers)?s=r.offers:Array.isArray(null==r?void 0:r.angles)&&(s=r.angles.map(e=>{var t,a;return{name:(null==e?void 0:e.name)||"Offer",headline:((null==e?void 0:e.headlines)||[])[0]||(null==e?void 0:e.big_idea)||(null==e?void 0:e.promise)||"Offer",subheadline:(null==e?void 0:null===(t=e.lp_snippet)||void 0===t?void 0:t.subheadline)||"",mechanics:(null==e?void 0:e.promise)||"",price_anchor:((null==e?void 0:e.ksp)||[]).join("; "),risk_reversal:Array.isArray(null==e?void 0:e.objections)?e.objections.map(e=>null==e?void 0:e.rebuttal).filter(Boolean).join(" • "):"",visual_idea:(null==e?void 0:null===(a=e.image_map)||void 0===a?void 0:a.notes)||""}}))}catch(e){}try{let e=String(eU||"").trim();if(e){let t=(s||[]).filter(t=>String((null==t?void 0:t.headline)||(null==t?void 0:t.name)||"").trim().toLowerCase()!==e.toLowerCase());s=[{name:e,headline:e,subheadline:"",mechanics:e,price_anchor:"",risk_reversal:"",visual_idea:""},...t]}}catch(e){}G(t=>{let i=t.nodes.filter(a=>{var i;return(null===(i=a.data)||void 0===i?void 0:i.type)==="promotion_offer"&&t.edges.some(t=>t.from===e.id&&t.to===a.id)}).map(e=>e.id),n=t.nodes.filter(e=>!i.includes(e.id)),r=t.edges.filter(t=>t.from!==e.id&&!i.includes(t.to)),l=n.find(t=>t.id===e.id)||{x:420,y:120},o=Math.min(a,Math.max(0,s.length||a));for(let t=0;t<o;t++){let a=s[t]||{name:"Offer ".concat(t+1),headline:"",subheadline:""},i=E("action",l.x+300,l.y+160*t,{label:"Offer ".concat(t+1),type:"promotion_offer",offer:a});n=[...n,i],r=[...r,P(e.id,"out",i.id,"in")]}let d={nodes:n,edges:r};return ee.current=d,d});let l=(null==r?void 0:r.instructions)||(null==r?void 0:null===(n=r.diagnosis)||void 0===n?void 0:n.why_these_angles)||"Follow CRO best practices and ensure clarity, proof, and risk reversal.";return{count:(s||[]).length,instructions:l}}if("generate_angles"===l){let t=String(eY||"").replaceAll("{title}",String(ed||"")).replaceAll("{audience}",String(er||"")).replaceAll("{benefits}",JSON.stringify(em||[])).replaceAll("{pain_points}",JSON.stringify(ev||[])),a=await (0,g.PN)({product:{audience:er,benefits:em,pain_points:ev,base_price:""===eu?void 0:Number(eu),title:ed||void 0,sizes:ef,colors:ey,target_category:el},num_angles:Number(e.data.numAngles||2),model:eF,prompt:t});return G(t=>{let i=t.nodes.filter(a=>{var i;return(null===(i=a.data)||void 0===i?void 0:i.type)==="angle_variant"&&t.edges.some(t=>t.from===e.id&&t.to===a.id)}).map(e=>e.id),n=t.nodes.filter(e=>!i.includes(e.id)),r=t.edges.filter(t=>t.from!==e.id&&!i.includes(t.to));(a.angles||[]).forEach((t,a)=>{let i=E("action",e.x+300,e.y+160*a,{label:"Angle ".concat(a+1),type:"angle_variant",angle:t});n=[...n,i],r=[...r,P(e.id,"out",i.id,"in")]});let s={nodes:n,edges:r};return ee.current=s,s}),{count:(a.angles||[]).length}}if("angle_variant"===l){let t=eB;try{(eC||[]).length>0&&!t&&(t=(await (0,g.eg)(eC)).urls||[],eW(t))}catch(e){}let a=String((null===(r=e.data)||void 0===r?void 0:r.prompt)||eq),i=await (0,g.hw)({product:{audience:er,benefits:em,pain_points:ev,base_price:""===eu?void 0:Number(eu),title:ed||void 0,sizes:ef,colors:ey,target_category:el},angle:null===(s=e.data)||void 0===s?void 0:s.angle,prompt:a,model:eF,image_urls:(t||[]).slice(0,1)});return G(t=>{let a=t.nodes.map(t=>t.id===e.id?{...t,data:{...t.data,approved:!0}}:t),n=a.find(t=>t.id===e.id),r=E("action",n.x+300,n.y,{label:"Title & Description",type:"title_desc",value:{title:i.title,description:i.description},landingPrompt:"Generate a concise landing page section (headline, subheadline, 2-3 bullets) based on the title and description."}),s=[...t.edges,P(e.id,"out",r.id,"in")],l={nodes:[...a,r],edges:s};return ee.current=l,l}),i}if("launch_test"===l){let a;!tp&&(tx?a={saved_audience_id:tx}:tg.length>0&&(a={geo_locations:{countries:tg.map(e=>e.toUpperCase())}}));let i=await (0,g.xY)({audience:er,benefits:em,pain_points:ev,base_price:""===eu?void 0:Number(eu),title:ed||void 0,images:eC,targeting:a,advantage_plus:tp,adset_budget:""===eT?void 0:Number(eT),model:eF,angles_prompt:eY,title_desc_prompt:eq,landing_copy_prompt:eX,sizes:ef,colors:ey});tb(i.test_id),tC("info","Launched test ".concat(i.test_id),e.id);let n=await tK(i.test_id);return t.refs.test=n,{test_id:i.test_id,status:n.status,request:{method:"POST",endpoint:"/api/tests"},response:n}}if("create_landing"===l){let e=t.refs.test;return{url:(null==e?void 0:e.page_url)||null}}if("meta_ads_launch"===l){let e=t.refs.test;return{campaign_id:(null==e?void 0:e.campaign_id)||null}}throw Error("Unknown action type: ".concat(l))}async function tK(e){let t=null;for(;;)try{var a;let i=await (0,g.yD)(e);tw(i);let n=U.nodes.find(e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)==="create_landing"}),r=U.nodes.find(e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)==="meta_ads_launch"}),s=U.nodes.find(e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)==="generate_copy"});if(s&&(null===(a=i.result)||void 0===a?void 0:a.angles)&&tk(s.id,{status:"success",output:{angles:i.result.angles,creatives:i.result.creatives}}),n&&i.page_url&&tk(n.id,{status:"success",output:{url:i.page_url}}),r&&i.campaign_id&&tk(r.id,{status:"success",output:{campaign_id:i.campaign_id}}),"completed"===i.status||"failed"===i.status){t=i;break}await I(2e3)}catch(e){await I(3e3)}return t}return(0,n.useEffect)(()=>{let e;let t=null,a=async()=>{try{var e,a,i;let n,r;let s={nodes:ee.current.nodes.map(e=>({id:e.id,type:e.type,x:e.x,y:e.y,data:e.data,run:{status:"idle",output:null,error:null,startedAt:null,finishedAt:null,ms:0}})),edges:ee.current.edges},l=ee.current.nodes.find(e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)==="image_gallery"}),o=(null==l?void 0:null===(e=l.run)||void 0===e?void 0:e.output)||{},d=Array.isArray(null==o?void 0:o.images)?o.images:[],c=(null==l?void 0:null===(a=l.data)||void 0===a?void 0:a.selected)||{};!tp&&(tx?n={saved_audience_id:tx}:tg.length>0&&(n={geo_locations:{countries:tg.map(e=>e.toUpperCase())}}));try{let e=ee.current.nodes.find(e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)==="image_gallery"}),t=(null==e?void 0:null===(i=e.run)||void 0===i?void 0:i.output)||{},a=Array.isArray(null==t?void 0:t.selected_shopify_urls)?t.selected_shopify_urls:Array.isArray(null==t?void 0:t.images)?t.images.filter(e=>e.startsWith("https://cdn.shopify.com")):[];Array.isArray(a)&&a.length>0&&(r=a[0])}catch(e){}if(!r)try{Array.isArray(eB)&&eB[0]&&eB[0].startsWith("https://cdn.shopify.com")&&(r=eB[0])}catch(e){}let u={product:{audience:er,benefits:em,pain_points:ev,base_price:""===eu?void 0:Number(eu),title:ed||void 0,sizes:ef,colors:ey,variant_descriptions:eG,target_category:el},image_urls:eB||[],flow:s,ui:{pan:Y,zoom:B,selected:L,promotion_free_image_url:eR,promotion_offer_text:eU,gallery_images:d,gallery_selected:c,active_left_tab:tc},prompts:{angles_prompt:eY,title_desc_prompt:eq,landing_copy_prompt:eX,gemini_ad_prompt:eK,gemini_variant_style_prompt:e3,gemini_street_prompt:e$},settings:{flow_type:h?"promotion":void 0,model:eF,advantage_plus:tp,adset_budget:""===eT?void 0:Number(eT),targeting:n,countries:tg,saved_audience_id:tx||void 0,...et.current?{product_gid:et.current}:{},...ea?{product_handle:ea}:{}},...r?{card_image:r}:{}},p=JSON.stringify(u);if(p!==t){t=p;try{if(t_)await (0,g.XD)(t_,u);else{let e=await (0,g.DO)(u);tb(e.id)}}catch(e){}}}catch(e){}};return e&&clearInterval(e),e=setTimeout(a,800),()=>{e&&clearTimeout(e)}},[er,em,ev,eu,ed,ef,ey,eF,tp,eT,tg,tx,Y,B,L,eK,e3,eY,eq,eX]),(0,n.useEffect)(()=>{try{let t=ee.current.nodes.find(e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)==="title_desc"});if(t){var e;let a=(null===(e=t.data)||void 0===e?void 0:e.value)||{};!String(a.title||"")&&String(ed||"")&&G(e=>({...e,nodes:e.nodes.map(e=>{var a;return e.id===t.id?{...e,data:{...e.data,value:{title:String(ed||""),description:String(((null===(a=e.data)||void 0===a?void 0:a.value)||{}).description||"")}}}:e})}))}}catch(e){}},[ed]),(0,i.jsxs)("div",{className:"min-h-screen w-full bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-sky-50 via-white to-indigo-50 text-slate-800",children:[(0,i.jsxs)("header",{className:"h-16 px-4 md:px-6 flex items-center justify-between border-b bg-white/70 backdrop-blur sticky top-0 z-50",children:[(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)(s.Z,{className:"w-6 h-6 text-blue-600"}),(0,i.jsx)("h1",{className:"font-semibold text-lg",children:"Product Testing OS — Flow Studio"}),(0,i.jsx)(w,{className:"bg-blue-100 text-blue-700",children:"New UI"})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("a",{href:"/",className:"text-sm rounded-xl font-semibold inline-flex items-center justify-center px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white",children:"Home"}),(0,i.jsxs)(x,{variant:"outline",size:"sm",onClick:tH,disabled:q,children:[(0,i.jsx)(l.Z,{className:"w-4 h-4 mr-1"}),"Run flow"]}),(0,i.jsxs)(x,{variant:"outline",size:"sm",onClick:tU,children:[(0,i.jsx)(o.Z,{className:"w-4 h-4 mr-1"}),"Save draft"]}),(0,i.jsxs)(x,{size:"sm",onClick:()=>alert("Published (wire CI/CD)"),children:[(0,i.jsx)(d.Z,{className:"w-4 h-4 mr-1"}),"Publish"]})]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-12 gap-3 p-3 h-[calc(100vh-4rem)]",children:[(0,i.jsxs)("aside",{className:"col-span-12 md:col-span-3 space-y-3 overflow-y-auto pb-24",children:[(0,i.jsxs)(y,{children:[(0,i.jsx)(_,{className:"pb-2",children:(0,i.jsx)(b,{className:"text-base",children:"LLM model"})}),(0,i.jsx)(j,{children:(0,i.jsx)("div",{children:(0,i.jsxs)("select",{value:eF,onChange:e=>eZ(e.target.value),className:"w-full rounded-xl border px-3 py-2 text-sm",children:[(0,i.jsx)("option",{value:"gpt-4o-mini",children:"gpt-4o-mini"}),(0,i.jsx)("option",{value:"gpt-4.1",children:"gpt-4.1"}),(0,i.jsx)("option",{value:"gpt-4a",children:"chatgpt-4a"}),(0,i.jsx)("option",{value:"gpt-5",children:"gpt-5"})]})})})]}),(0,i.jsx)(y,{children:(0,i.jsx)(_,{className:"pb-2",children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("button",{className:"text-sm px-3 py-1.5 rounded ".concat("inputs"===tc?"bg-blue-600 text-white":"border"),onClick:()=>tu("inputs"),children:"Inputs"}),(0,i.jsx)("button",{className:"text-sm px-3 py-1.5 rounded ".concat("prompts"===tc?"bg-blue-600 text-white":"border"),onClick:()=>tu("prompts"),children:"Prompts"})]})})}),"inputs"===tc&&(0,i.jsxs)(y,{children:[(0,i.jsx)(_,{className:"pb-2",children:(0,i.jsxs)(b,{className:"text-base flex items-center gap-2",children:[(0,i.jsx)(c.Z,{className:"w-4 h-4"}),"Product inputs"]})}),(0,i.jsxs)(j,{className:"space-y-3",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Analyze product image to prefill"}),(0,i.jsx)("input",{className:"w-full rounded-xl border px-3 py-2",placeholder:"Paste image URL (or upload above)",value:eO,onChange:e=>eI(e.target.value)}),eO&&(0,i.jsx)("div",{className:"w-full bg-slate-50 border rounded-xl overflow-hidden",children:(0,i.jsx)("img",{src:f(eO),alt:"analysis",className:"w-full h-40 object-cover"})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Target category"}),(0,i.jsxs)("select",{value:el,onChange:e=>eo(e.target.value),className:"w-full rounded-xl border px-3 py-2 text-sm",children:[(0,i.jsx)("option",{value:"girl",children:"Girl"}),(0,i.jsx)("option",{value:"boy",children:"Boy"}),(0,i.jsx)("option",{value:"unisex_kids",children:"Unisex kids"}),(0,i.jsx)("option",{value:"men",children:"Men"}),(0,i.jsx)("option",{value:"women",children:"Women"}),(0,i.jsx)("option",{value:"unisex",children:"Unisex"})]})]}),(0,i.jsx)("div",{className:"flex items-center gap-2",children:(0,i.jsx)(x,{size:"sm",variant:"outline",onClick:async()=>{try{if(!eO){alert("Paste an image URL first.");return}let e=await (0,g.vz)({image_url:eO,model:eF,target_category:el});if(null==e?void 0:e.error){alert("Analyze error: "+String(e.error));return}let t=(null==e?void 0:e.product)||{};t.title&&ec(t.title),t.audience&&es(t.audience),Array.isArray(t.benefits)&&eg(t.benefits),Array.isArray(t.pain_points)&&eh(t.pain_points),Array.isArray(t.colors)&&e_(t.colors),Array.isArray(t.sizes)&&ex(t.sizes),Array.isArray(t.variants)&&eL(t.variants),t.title||t.audience||Array.isArray(t.benefits)||Array.isArray(t.pain_points)||alert("Analyze completed but no structured product info was detected.")}catch(e){alert("Analyze failed: "+String((null==e?void 0:e.message)||e))}},children:"Analyze"})}),eG.length>0&&(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)("div",{className:"text-xs text-slate-500",children:"Variant descriptions"}),eG.map((e,t)=>(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,i.jsx)(N,{value:e.name||"",onChange:e=>eL(a=>a.map((a,i)=>i===t?{...a,name:e.target.value}:a)),placeholder:"Variant name"}),(0,i.jsx)(N,{value:e.description||"",onChange:e=>eL(a=>a.map((a,i)=>i===t?{...a,description:e.target.value}:a)),placeholder:"Variant description"})]},t))]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Audience"}),(0,i.jsx)(N,{value:er,onChange:e=>es(e.target.value),placeholder:"Parents of toddlers in Morocco"})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Title (optional)"}),(0,i.jsx)(N,{value:ed,onChange:e=>ec(e.target.value),placeholder:"Doll Sneakers – Pink"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Base price (MAD)"}),(0,i.jsx)(N,{type:"number",value:eu,onChange:e=>ep(""===e.target.value?"":Number(e.target.value)),placeholder:"189"}),(0,i.jsxs)("div",{className:"flex items-center gap-3 mt-2",children:[(0,i.jsxs)("label",{className:"flex items-center gap-2 text-xs text-slate-600",children:[(0,i.jsx)("input",{type:"checkbox",checked:eb,onChange:e=>ej(e.target.checked)}),"Track inventory"]}),(0,i.jsxs)("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[(0,i.jsx)("span",{children:"Initial quantity"}),(0,i.jsx)(N,{type:"number",className:"w-24",value:ew,onChange:e=>eN(""===e.target.value?"":Number(e.target.value)),placeholder:"10"})]})]})]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Sizes (variants)"}),(0,i.jsx)(m,{value:ef,onChange:ex,placeholder:"Add size & Enter (e.g., S, M, L)"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Colors (variants)"}),(0,i.jsx)(m,{value:ey,onChange:e_,placeholder:"Add color & Enter (e.g., Red, Blue)"})]})]}),Array.isArray(eA)&&eA.length>0&&(0,i.jsxs)("div",{className:"mt-2 p-2 rounded border border-amber-300 bg-amber-50 text-amber-800 text-xs",children:[(0,i.jsx)("div",{className:"font-medium mb-1",children:"Not applied to Shopify:"}),(0,i.jsx)("ul",{className:"list-disc pl-5",children:eA.map((e,t)=>(0,i.jsxs)("li",{children:[(0,i.jsx)("span",{className:"font-medium",children:e.field}),": ",e.reason]},t))})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Key benefits"}),(0,i.jsx)(m,{value:em,onChange:eg,placeholder:"Add benefit & Enter"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Pain points"}),(0,i.jsx)(m,{value:ev,onChange:eh,placeholder:"Add pain & Enter"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Main product image"}),(0,i.jsx)(p,{files:eC,onFiles:e=>{(async()=>{try{var t;ek(e);let a=ee.current.nodes.find(e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)==="create_product"}),i=((null==a?void 0:null===(t=a.run)||void 0===t?void 0:t.output)||{}).product_gid,n=[];if(!h&&!i)try{let e=await (0,g.KQ)({product:{audience:er,benefits:em,pain_points:ev,base_price:""===eu?void 0:Number(eu),title:ed||void 0,sizes:ef,colors:ey,target_category:el,track_quantity:eb,quantity:""===ew?void 0:Number(ew)},angle:void 0,title:(ed||"").trim()||"Offer",description:""});i=(null==e?void 0:e.product_gid)||i;try{let t=null==e?void 0:e.report;t&&Array.isArray(t.skipped)&&eS(t.skipped)}catch(e){}try{i&&(et.current=i);let t=null==e?void 0:e.handle;t&&ei(t)}catch(e){}i&&a&&tk(a.id,{status:"success",output:{product_gid:i}});try{if(i){let e=await (0,g.th)({product_gid:i,base_price:""===eu?void 0:Number(eu),sizes:ef,colors:ey,track_quantity:eb,quantity:""===ew?void 0:Number(ew)});e&&Array.isArray(e.skipped)&&eS(e.skipped)}}catch(e){}}catch(e){}if(!h&&i){let t=await (0,g.LJ)({product_gid:i,files:e,title:ed||void 0,description:""}),a=Array.isArray(null==t?void 0:t.urls)?t.urls:[],r=Array.isArray(null==t?void 0:t.images)?t.images.map(e=>null==e?void 0:e.src).filter(Boolean):[];n=a.length>0?a:r}else{let t=await (0,g.eg)(e);n=Array.isArray(null==t?void 0:t.urls)?t.urls:[]}if(n.length>0){eW(n),eI(n[0]);try{let e=ee.current.nodes.find(e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)==="image_gallery"});e&&await tL(e.id,n)}catch(e){}try{await tU()}catch(e){}}}catch(e){}})()}})]}),h&&(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Offer (optional)"}),(0,i.jsx)(N,{value:eU,onChange:async e=>{eD(e.target.value);try{await tU()}catch(e){}},placeholder:"e.g., Buy 1, get 1 free"})]}),h&&(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Second offer product image (promotion)"}),(0,i.jsx)(p,{files:eE,onFiles:e=>{(async()=>{try{eP(e);let t=await (0,g.eg)(e),a=Array.isArray(null==t?void 0:t.urls)?t.urls:[];if(a.length>0){eM(a[0]);try{await tU()}catch(e){}}}catch(e){}})()}}),eR&&(0,i.jsx)("div",{className:"mt-2 w-full bg-slate-50 border rounded-xl overflow-hidden",children:(0,i.jsx)("img",{src:f(eR),alt:"promotion",className:"w-full h-40 object-cover"})})]})]})]}),"prompts"===tc&&(0,i.jsxs)(y,{children:[(0,i.jsx)(_,{className:"pb-2",children:(0,i.jsx)(b,{className:"text-base",children:"Prompts"})}),(0,i.jsxs)(j,{className:"space-y-3",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Angles prompt"}),(0,i.jsx)(A,{rows:4,value:eY,onChange:e=>eJ(e.target.value)}),(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mt-1",children:"Used when generating angles."}),(0,i.jsx)("div",{className:"mt-1 flex items-center gap-2",children:(0,i.jsx)(x,{size:"sm",variant:"outline",onClick:async()=>{try{await (0,g.V0)({angles_prompt:eY}),localStorage.setItem("ptos_prompts_angles",eY)}catch(e){}},children:"Make app default"})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Title & Description prompt"}),(0,i.jsx)(A,{rows:4,value:eq,onChange:e=>eH(e.target.value)}),(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mt-1",children:"Used when generating title and description."}),(0,i.jsx)("div",{className:"mt-1 flex items-center gap-2",children:(0,i.jsx)(x,{size:"sm",variant:"outline",onClick:async()=>{try{await (0,g.V0)({title_desc_prompt:eq}),localStorage.setItem("ptos_prompts_title_desc",eq)}catch(e){}},children:"Make app default"})})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"text-xs text-slate-500 mb-1 flex items-center gap-2",children:[(0,i.jsx)("span",{className:"font-medium text-slate-700",children:"Create Landing (Elegant v3 \xb7 STRICT)"}),(0,i.jsx)("span",{className:"text-[10px] px-2 py-0.5 rounded border",children:"create_landing"})]}),(0,i.jsx)(A,{rows:8,value:eX,onChange:e=>eV(e.target.value)}),(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mt-1",children:"Generates a complete page using the Elegant Minimal design system. Uses only provided image URLs."}),(0,i.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[(0,i.jsx)(x,{size:"sm",variant:"outline",onClick:async()=>{try{await (0,g.V0)({landing_copy_prompt:eX}),localStorage.setItem("ptos_prompts_landing_copy",eX)}catch(e){}},children:"Make app default"}),(0,i.jsx)(x,{size:"sm",variant:"outline",onClick:async()=>{try{td(!0);let e=await (0,g.WM)({product:{audience:er,benefits:em,pain_points:ev,base_price:""===eu?void 0:Number(eu),title:ed||void 0,sizes:ef,colors:ey,target_category:el},title:ed||void 0,description:"",model:eF,image_urls:eB||[],prompt:eX,product_handle:ea});tr({html:String((null==e?void 0:e.html)||""),json:e}),tl("preview")}catch(e){tr({error:String((null==e?void 0:e.message)||e)})}finally{td(!1)}},children:"Preview"})]}),to&&(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mt-2",children:"Generating preview…"}),(null==tn?void 0:tn.html)&&(0,i.jsxs)("div",{className:"mt-2 border rounded-xl overflow-hidden",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between px-2 py-1 border-b bg-slate-50",children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-600",children:"Landing preview"}),(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsx)("button",{onClick:()=>tl("preview"),className:"text-[11px] px-2 py-0.5 rounded ".concat("preview"===ts?"bg-white border":"border-transparent"),children:"Preview"}),(0,i.jsx)("button",{onClick:()=>tl("html"),className:"text-[11px] px-2 py-0.5 rounded ".concat("html"===ts?"bg-white border":"border-transparent"),children:"HTML"})]})]}),(0,i.jsx)("div",{className:"max-h-[420px] overflow-auto",children:"preview"===ts?(0,i.jsx)("iframe",{title:"landing-preview",srcDoc:tn.html,className:"w-full h-[400px] bg-white"}):(0,i.jsx)("pre",{className:"text-[11px] p-3 whitespace-pre-wrap overflow-auto",children:tn.html})})]})]}),(0,i.jsx)(S,{}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Gemini ad image prompt"}),(0,i.jsx)(A,{rows:3,value:eK,onChange:e=>eQ(e.target.value)}),(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mt-1",children:"Default prompt used for Gemini ad images."}),(0,i.jsx)("div",{className:"mt-1 flex items-center gap-2",children:(0,i.jsx)(x,{size:"sm",variant:"outline",onClick:async()=>{try{await (0,g.V0)({gemini_ad_prompt:eK}),localStorage.setItem("ptos_prompts_gemini_ad",eK)}catch(e){}},children:"Make app default"})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Gemini street scene prompt"}),(0,i.jsx)(A,{rows:3,value:e$,onChange:e=>e0(e.target.value)}),(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mt-1",children:"Used for the natural street/home scene ad image card."}),(0,i.jsx)("div",{className:"mt-1 flex items-center gap-2",children:(0,i.jsx)(x,{size:"sm",variant:"outline",onClick:async()=>{try{localStorage.setItem("ptos_prompts_gemini_street",e$)}catch(e){}},children:"Make default (local)"})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Gemini variant style prompt"}),(0,i.jsx)(A,{rows:2,value:e3,onChange:e=>e4(e.target.value)}),(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mt-1",children:"Default style used for Gemini variant-set images."}),(0,i.jsx)("div",{className:"mt-1 flex items-center gap-2",children:(0,i.jsx)(x,{size:"sm",variant:"outline",onClick:async()=>{try{await (0,g.V0)({gemini_variant_style_prompt:e3}),localStorage.setItem("ptos_prompts_gemini_variant_style",e3)}catch(e){}},children:"Make app default"})})]}),(0,i.jsx)(S,{}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("div",{className:"text-xs text-slate-500",children:"Audience-specific prompts"}),(0,i.jsx)("div",{children:(0,i.jsxs)("select",{value:e6,onChange:e=>e7(e.target.value),className:"w-full rounded-xl border px-3 py-2 text-sm",children:[(0,i.jsx)("option",{value:"girl",children:"Girl"}),(0,i.jsx)("option",{value:"boy",children:"Boy"}),(0,i.jsx)("option",{value:"unisex_kids",children:"Unisex Kids"}),(0,i.jsx)("option",{value:"men",children:"Men"}),(0,i.jsx)("option",{value:"women",children:"Women"}),(0,i.jsx)("option",{value:"unisex",children:"Unisex"})]})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mb-1",children:"Ad image prompt (neutral background)"}),(0,i.jsx)(A,{rows:3,value:e8,onChange:e=>e9(e.target.value)})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mb-1",children:"Street scene prompt"}),(0,i.jsx)(A,{rows:3,value:te,onChange:e=>tt(e.target.value)})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mb-1",children:"Variant style prompt"}),(0,i.jsx)(A,{rows:2,value:ta,onChange:e=>ti(e.target.value)})]}),(0,i.jsx)("div",{className:"mt-1 flex items-center gap-2",children:(0,i.jsx)(x,{size:"sm",variant:"outline",onClick:()=>{try{let e=String(e6||"unisex").toLowerCase();localStorage.setItem("ptos_prompts_gemini_ad__".concat(e),e8||""),localStorage.setItem("ptos_prompts_gemini_street__".concat(e),te||""),localStorage.setItem("ptos_prompts_gemini_variant_style__".concat(e),ta||"")}catch(e){}},children:"Make default for this audience"})}),(0,i.jsx)("div",{className:"text-[11px] text-slate-500",children:"When you change Target category, the matching audience defaults are auto-applied."})]})]})]}),(0,i.jsxs)(y,{children:[(0,i.jsx)(_,{className:"pb-2",children:(0,i.jsx)(b,{className:"text-base",children:"Flow settings"})}),(0,i.jsxs)(j,{className:"space-y-2 text-xs text-slate-500",children:[(0,i.jsx)("div",{children:"• Run executes: Generate copy → Launch test → Landing → Meta Ads"}),(0,i.jsx)("div",{children:"• Status is polled from your backend and updates nodes/log."})]})]})]}),(0,i.jsxs)("section",{className:"col-span-12 md:col-span-6 relative",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between px-2 py-1",children:[(0,i.jsx)("div",{className:"text-sm text-slate-500",children:"Flow canvas"}),(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)("div",{className:"text-xs text-slate-500",children:"Zoom"}),(0,i.jsx)("input",{type:"range",min:50,max:140,step:10,value:100*B,onChange:e=>W(Number(e.target.value)/100),className:"w-40"})]})]}),(0,i.jsx)(S,{className:"mb-2"}),(0,i.jsxs)("div",{ref:$,className:"relative h-[calc(100%-3rem)] bg-white rounded-2xl shadow-inner overflow-hidden border",onMouseMove:function(e){var t;if(tE.current.active){let t=(e.clientX-tE.current.startX)/B,a=(e.clientY-tE.current.startY)/B;J({x:tE.current.origX+t,y:tE.current.origY+a});return}let a=tO.current;if(!a.id)return;let i=null===(t=$.current)||void 0===t?void 0:t.getBoundingClientRect();if(!i)return;let n=(e.clientX-i.left-a.offsetX)/B-Y.x,r=(e.clientY-i.top-a.offsetY)/B-Y.y;tR.current={id:a.id,x:n,y:r},null==tP.current&&(tP.current=requestAnimationFrame(()=>{let e=tR.current;tP.current=null,e&&G(t=>({...t,nodes:t.nodes.map(t=>t.id===e.id?{...t,x:e.x,y:e.y}:t)}))}))},onMouseUp:function(){tO.current={id:null,offsetX:0,offsetY:0},tE.current.active=!1,tP.current&&(cancelAnimationFrame(tP.current),tP.current=null),tR.current=null},onMouseDown:function(e){(0===e.button||1===e.button||2===e.button)&&(e.preventDefault(),tE.current={active:!0,startX:e.clientX,startY:e.clientY,origX:Y.x,origY:Y.y})},onContextMenu:e=>e.preventDefault(),onWheel:e=>{e.ctrlKey&&e.preventDefault()},children:[(0,i.jsx)(z,{}),(0,i.jsxs)("div",{className:"absolute left-0 top-0 origin-top-left",style:{transform:"translate(".concat(Y.x,"px, ").concat(Y.y,"px) scale(").concat(B,")"),transformOrigin:"0 0",willChange:"transform"},children:[U.edges.map(e=>(0,i.jsx)(F,{edge:e,nodes:U.nodes,active:q&&X===e.from},e.id)),U.nodes.map(e=>{var t;return(0,i.jsx)(D,{node:e,selected:L===e.id,onMouseDown:tI,onDelete:e=>G(t=>({...t,nodes:t.nodes.filter(t=>t.id!==e),edges:t.edges.filter(t=>t.from!==e&&t.to!==e)})),active:q&&X===e.id||"running"===e.run.status,trace:(null==tj?void 0:null===(t=tj.result)||void 0===t?void 0:t.trace)||[],payload:(null==tj?void 0:tj.payload)||null,onUpdateNode:t=>G(a=>({...a,nodes:a.nodes.map(a=>a.id===e.id?{...a,data:{...a.data,...t}}:a)})),onAngleGenerate:e=>tM(e),onAngleApprove:e=>tD(e),onTitleContinue:e=>tG(e),onGeminiGenerate:e=>tz(e),onGalleryApprove:e=>tJ(e),onSuggestPrompts:e=>{},onApplyAdPrompt:e=>{},onOfferGenerateImage:e=>tW(e),onOffersGenerate:()=>tB(),onOfferGenerateFull:e=>tY(e)},e.id)})]})]})]}),(0,i.jsx)("aside",{className:"col-span-12 md:col-span-3 space-y-3 overflow-y-auto pb-24",children:(0,i.jsxs)(y,{children:[(0,i.jsxs)(_,{className:"pb-2 flex items-center justify-between",children:[(0,i.jsx)(b,{className:"text-base",children:"Inspector"}),tN&&(0,i.jsx)("button",{className:"p-1 rounded hover:bg-slate-50",onClick:()=>G(e=>({...e,nodes:e.nodes.filter(e=>e.id!==tN.id),edges:e.edges.filter(e=>e.from!==tN.id&&e.to!==tN.id)})),children:(0,i.jsx)(u.Z,{className:"w-4 h-4 text-slate-500"})})]}),(0,i.jsxs)(j,{children:[!tN&&(0,i.jsx)("div",{className:"text-sm text-slate-500",children:"Select a node to see details."}),tN&&(0,i.jsx)(T,{node:tN,latestTrace:(null==tj?void 0:null===(t=tj.result)||void 0===t?void 0:t.trace)||[],onPreview:e=>tS(e),onUpdateNodeData:(e,t)=>G(a=>({...a,nodes:a.nodes.map(a=>a.id===e?{...a,data:{...a.data,...t}}:a)})),onUpdateRun:(e,t)=>tk(e,t),savedAudiences:th,onAngleGenerate:e=>tM(e),onAngleApprove:e=>tD(e),onTitleContinue:e=>tG(e),onGeminiGenerate:(e,t)=>tz(e,t),onSuggestPrompts:e=>{},onApplyAdPrompt:e=>{},onGalleryApprove:e=>tJ(e),onExternalNav:e=>(function(e){try{window.location.href=e}catch(e){}})(e),onOfferGenerateFull:e=>tY(e),onAppendToGallery:e=>tT(e),productColors:ey,globalLandingPrompt:eX})]})]})})]}),tA&&(0,i.jsx)("div",{className:"fixed inset-0 z-[60] bg-black/70 flex items-center justify-center",onClick:()=>tS(null),children:(0,i.jsxs)("div",{className:"max-w-5xl max-h-[90vh] p-2",onClick:e=>e.stopPropagation(),children:[(0,i.jsx)("img",{src:f(tA),alt:"preview",className:"max-w-full max-h-[85vh] rounded shadow-lg"}),(0,i.jsxs)("div",{className:"mt-2 flex justify-end gap-2",children:[(0,i.jsx)("a",{href:tA,download:!0,className:"rounded-xl font-semibold px-3 py-1.5 bg-white text-slate-700",children:"Download"}),(0,i.jsx)("button",{className:"rounded-xl font-semibold px-3 py-1.5 bg-blue-600 text-white",onClick:()=>tS(null),children:"Close"})]})]})})]})}function D(e){let{node:t,selected:a,onMouseDown:n,onDelete:s,active:l,trace:o,payload:d,onUpdateNode:c,onAngleGenerate:p,onAngleApprove:m,onTitleContinue:g,onGeminiGenerate:v,onGalleryApprove:h,onSuggestPrompts:f,onApplyAdPrompt:y,onOfferGenerateImage:_,onOffersGenerate:b,onOfferGenerateFull:j}=e,N={left:t.x,top:t.y};return(0,i.jsxs)("div",{className:"absolute select-none",style:N,onMouseDown:e=>{e.stopPropagation(),n(e,t)},children:[(0,i.jsxs)(r.E.div,{className:"rounded-2xl bg-white border ".concat(a?"ring-2 ring-blue-500":"ring-1 ring-slate-200"," shadow ").concat(l?"shadow-[0_0_0_4px_rgba(59,130,246,0.15)]":""," w-[220px]"),children:[(0,i.jsxs)("div",{className:"px-3 py-2 flex items-center justify-between",children:[(0,i.jsx)("div",{className:"flex items-center gap-2",children:(0,i.jsx)(w,{className:"border border-blue-200 text-blue-700 bg-blue-50",children:"trigger"===t.type?"Trigger":"Action"})}),(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 rounded ".concat(L(t.run.status)),children:G(t.run.status)}),(0,i.jsx)("button",{className:"p-1 rounded hover:bg-slate-50",onClick:e=>{e.stopPropagation(),s(t.id)},children:(0,i.jsx)(u.Z,{className:"w-3.5 h-3.5 text-slate-500"})})]})]}),(0,i.jsx)(S,{}),(0,i.jsx)("div",{className:"p-3 text-sm text-slate-700 min-h-[64px]",children:function(e,t,a,n,r,s,l,o,d,c,u,p,m,g,v){var h,f,y,_,b,j,w,N,A,S,C,k,O,I,E,P,R,M,U,D,T,z,F,Z,B,W,Y,J,q,H,X,V,K,Q;if("trigger"===e.type)return(0,i.jsx)("div",{className:"text-xs text-slate-600",children:String((null===(b=e.data)||void 0===b?void 0:b.topic)||"start")});let $=null===(h=e.run)||void 0===h?void 0:h.output,ee=null===(f=e.data)||void 0===f?void 0:f.type;if("promotion_generate_offers"===ee){let t="number"==typeof(null==$?void 0:$.count)?$.count:void 0;return(0,i.jsxs)("div",{className:"text-xs text-slate-700",children:[(null===(j=e.data)||void 0===j?void 0:j.label)||"Generate Offers",(0,i.jsx)("div",{className:"text-[11px] text-slate-500",children:null!=t?"Generated: ".concat(t):"To generate: ".concat(String((null===(w=e.data)||void 0===w?void 0:w.numOffers)||3))}),(null===(N=e.data)||void 0===N?void 0:N.prompt)&&(0,i.jsx)("div",{className:"mt-1 text-[11px] text-slate-600 whitespace-pre-wrap max-h-28 overflow-hidden",children:String(e.data.prompt)}),(0,i.jsx)("div",{className:"mt-1 flex justify-end",children:(0,i.jsx)(x,{size:"sm",onClick:()=>g(),disabled:(null===(A=e.run)||void 0===A?void 0:A.status)==="running",children:"Generate"})})]})}if("promotion_offer"===ee){let t=(null===(S=e.data)||void 0===S?void 0:S.offer)||{},a=(null==t?void 0:t.name)||(null==t?void 0:t.headline)||"Offer";return(0,i.jsxs)("div",{className:"text-xs text-slate-700",children:[a,(0,i.jsx)("div",{className:"text-[11px] text-slate-500 truncate",children:(null==t?void 0:t.subheadline)?String(t.subheadline):""}),(0,i.jsxs)("div",{className:"mt-1 flex items-center gap-1 justify-end",children:[(0,i.jsx)(x,{size:"sm",variant:"outline",onClick:()=>v(e.id),disabled:(null===(C=e.run)||void 0===C?void 0:C.status)==="running",children:"Generate offer"}),(0,i.jsx)(x,{size:"sm",onClick:()=>m(e.id),disabled:(null===(k=e.run)||void 0===k?void 0:k.status)==="running",children:"Generate image"})]})]})}if("promotion_offer_copy"===ee){let t=(null===(O=e.data)||void 0===O?void 0:O.offer_full)||{};return(0,i.jsxs)("div",{className:"text-xs text-slate-700",children:[(null==t?void 0:t.headline)||(null==t?void 0:t.name)||"Offer",(0,i.jsx)("div",{className:"text-[11px] text-slate-500 truncate",children:(null==t?void 0:t.subheadline)?String(t.subheadline):""}),(0,i.jsx)("div",{className:"mt-1 flex items-center gap-1 justify-end",children:(0,i.jsx)(x,{size:"sm",onClick:()=>m(e.id),disabled:(null===(I=e.run)||void 0===I?void 0:I.status)==="running",children:"Generate image"})})]})}if("generate_angles"===ee){let t="number"==typeof(null==$?void 0:$.count)?$.count:void 0;return(0,i.jsxs)("div",{className:"text-xs text-slate-700",children:[(null===(E=e.data)||void 0===E?void 0:E.label)||"Generate Angles",(0,i.jsx)("div",{className:"text-[11px] text-slate-500",children:null!=t?"Generated: ".concat(t):"To generate: ".concat(String((null===(P=e.data)||void 0===P?void 0:P.numAngles)||2))})]})}if("angle_variant"===ee){let t=null==$?void 0:$.title;return(0,i.jsxs)("div",{className:"text-xs text-slate-700",children:[(null===(R=e.data)||void 0===R?void 0:R.label)||"Angle",(0,i.jsx)("div",{className:"text-[11px] text-slate-500 truncate",children:t?String(t):"No title yet"}),(0,i.jsxs)("div",{className:"mt-1 flex items-center gap-1",children:[(0,i.jsx)(x,{size:"sm",variant:"outline",onClick:()=>s(e.id),disabled:(null===(M=e.run)||void 0===M?void 0:M.status)==="running",children:"Gen"}),(0,i.jsx)(x,{size:"sm",variant:(null===(U=e.data)||void 0===U?void 0:U.approved)?"outline":"default",disabled:!(null===(D=e.run)||void 0===D?void 0:D.output)||!!(null===(T=e.data)||void 0===T?void 0:T.approved),onClick:()=>l(e.id),children:(null===(z=e.data)||void 0===z?void 0:z.approved)?"✓":"Approve"})]})]})}if("title_desc"===ee){let t=(null===(F=e.data)||void 0===F?void 0:F.value)||{};return(0,i.jsxs)("div",{className:"text-xs text-slate-700",children:[(null===(Z=e.data)||void 0===Z?void 0:Z.label)||"Title & Description",(0,i.jsx)("div",{className:"text-[11px] text-slate-500 truncate",children:(null==t?void 0:t.title)?String(t.title):"-"}),(0,i.jsx)("div",{className:"mt-1 flex justify-end",children:(0,i.jsx)(x,{size:"sm",onClick:()=>o(e.id),disabled:(null===(B=e.run)||void 0===B?void 0:B.status)==="running",children:"Continue"})})]})}if("gemini_ad_images"===ee){let t=Array.isArray(null==$?void 0:$.images)?$.images:[];return(0,i.jsxs)("div",{className:"text-xs text-slate-700",children:[(null===(W=e.data)||void 0===W?void 0:W.label)||"Gemini Ad Images",(0,i.jsxs)("div",{className:"text-[11px] text-slate-500",children:["Images: ",t.length||0]}),(0,i.jsxs)("div",{className:"mt-1 flex items-center gap-1",children:[(0,i.jsx)(x,{size:"sm",variant:"outline",onClick:()=>d(e.id),disabled:(null===(Y=e.run)||void 0===Y?void 0:Y.status)==="running",children:"Generate"}),(0,i.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 rounded ".concat(L(e.run.status)),children:G(e.run.status)})]})]})}if("gemini_feature_benefit_set"===ee||"gemini_variant_set"===ee){let t=Array.isArray(null==$?void 0:$.items)?$.items:[];return(0,i.jsxs)("div",{className:"text-xs text-slate-700",children:[(null===(J=e.data)||void 0===J?void 0:J.label)||("gemini_variant_set"===ee?"Gemini Variant Set":"Gemini Feature/Benefit Set"),(0,i.jsxs)("div",{className:"text-[11px] text-slate-500",children:["Items: ",t.length||0]}),(0,i.jsxs)("div",{className:"mt-1 flex items-center gap-1",children:[(0,i.jsx)(x,{size:"sm",variant:"outline",onClick:()=>d(e.id),disabled:(null===(q=e.run)||void 0===q?void 0:q.status)==="running",children:"Generate"}),(0,i.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 rounded ".concat(L(e.run.status)),children:G(e.run.status)})]})]})}if("image_prompt_suggester"===ee){let t=Array.isArray(null==$?void 0:$.variant_prompts)?$.variant_prompts:[],a=Array.isArray(null==$?void 0:$.feature_prompts)?$.feature_prompts:[];return(0,i.jsxs)("div",{className:"text-xs text-slate-700",children:[(null===(H=e.data)||void 0===H?void 0:H.label)||"Image Prompt Suggester",(0,i.jsxs)("div",{className:"text-[11px] text-slate-500",children:["Variants: ",t.length||0," • Features: ",a.length||0]}),(0,i.jsxs)("div",{className:"mt-1 flex items-center gap-1",children:[(0,i.jsx)(x,{size:"sm",variant:"outline",onClick:()=>u(e.id),disabled:(null===(X=e.run)||void 0===X?void 0:X.status)==="running",children:"Suggest"}),(0,i.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 rounded ".concat(L(e.run.status)),children:G(e.run.status)})]})]})}if("image_gallery"===ee){let t=Array.isArray(null==$?void 0:$.images)?$.images:[],a=Object.values((null===(V=e.data)||void 0===V?void 0:V.selected)||{}).filter(Boolean).length;return(0,i.jsxs)("div",{className:"text-xs text-slate-700",children:[(null===(K=e.data)||void 0===K?void 0:K.label)||"Select Images",(0,i.jsxs)("div",{className:"text-[11px] text-slate-500",children:["Images: ",t.length||0," • Selected: ",a]}),(0,i.jsx)("div",{className:"mt-1 flex justify-end",children:(0,i.jsx)(x,{size:"sm",onClick:()=>c(e.id),disabled:0===a||(null===(Q=e.run)||void 0===Q?void 0:Q.status)==="running",children:"Approve"})})]})}return(0,i.jsxs)("div",{className:"text-xs text-slate-700",children:[(null===(y=e.data)||void 0===y?void 0:y.label)||(null===(_=e.data)||void 0===_?void 0:_.type)||e.type,$?(0,i.jsx)("div",{className:"text-[11px] text-slate-500",children:"Done"}):null]})}(t,0,0,0,0,p,m,g,v,h,f,0,_,b,j)})]}),(0,i.jsx)("div",{className:"absolute w-2 h-2 rounded-full bg-slate-300 border border-slate-400",style:{left:-8,top:96}}),(0,i.jsx)("div",{className:"absolute w-2 h-2 rounded-full bg-slate-300 border border-slate-400",style:{right:-8,top:96}})]})}function G(e){return"idle"===e?"idle":"running"===e?"running":"success"===e?"ok":"error"}function L(e){return"idle"===e?"bg-slate-100 text-slate-600":"running"===e?"bg-amber-100 text-amber-700":"success"===e?"bg-emerald-100 text-emerald-700":"bg-rose-100 text-rose-700"}function T(e){var t,a,r,s,l,o,d,c,u,p,v,h,y,_,b,j,w,C,k,I,E,P,R,M,U,D,G,L,T,z,F,Z,B,W,Y,J,q,H,X,V,K,Q,$,ee,et,ea,ei,en,er,es,el,eo,ed,ec,eu,ep,em,eg,ev,eh,ef,ex,ey,e_;let{node:eb,latestTrace:ej,onPreview:ew,onUpdateNodeData:eN,onUpdateRun:eA,savedAudiences:eS,onAngleGenerate:eC,onAngleApprove:ek,onTitleContinue:eO,onGeminiGenerate:eI,onSuggestPrompts:eE,onApplyAdPrompt:eP,onGalleryApprove:eR,onExternalNav:eM,onOfferGenerateFull:eU,onAppendToGallery:eD,productColors:eG,globalLandingPrompt:eL}=e,[eT,ez]=(0,n.useState)(""),[eF,eZ]=(0,n.useState)({}),[eB,eW]=(0,n.useState)("preview"),eY=(null===(t=eb.run)||void 0===t?void 0:t.output)||{},[eJ,eq]=(0,n.useState)("");!function(e,t){var a;if(!t)return;let i=(null===(a=e.data)||void 0===a?void 0:a.type)||e.type;"generate_copy"===i?t.filter(e=>"generate_copy"===e.step):"create_landing"===i?t.filter(e=>"landing_copy"===e.step||"shopify"===e.step):"meta_ads_launch"===i&&t.filter(e=>"meta"===e.step)}(eb,ej);let eH=[],eX=(null===(a=eb.data)||void 0===a?void 0:a.type)==="image_gallery";if((null===(r=eb.data)||void 0===r?void 0:r.type)==="gemini_ad_images")eH=Array.isArray(null==eY?void 0:eY.images)?eY.images:[];else if((null===(s=eb.data)||void 0===s?void 0:s.type)==="gemini_variant_set")try{eH=(Array.isArray(null==eY?void 0:eY.items)?eY.items:[]).map(e=>null==e?void 0:e.image).filter(Boolean)}catch(e){eH=[]}else if((null===(l=eb.data)||void 0===l?void 0:l.type)==="gemini_feature_benefit_set")try{eH=(Array.isArray(null==eY?void 0:eY.items)?eY.items:[]).map(e=>null==e?void 0:e.image).filter(Boolean)}catch(e){eH=[]}else if(eX)try{eH=(Array.isArray(null==eY?void 0:eY.images)?eY.images:[]).filter(Boolean)}catch(e){eH=[]}async function eV(){try{var e;let t=eH.filter(e=>eF[e]);if(0===t.length){alert("Select image(s) to upload.");return}if(!eT){alert("Enter Shopify product GID.");return}let a=t.filter(e=>e.startsWith("data:")),i=t.filter(e=>!e.startsWith("data:")),n=[];if(a.length>0){let e=await Promise.all(a.map((e,t)=>eQ(e,"gemini-".concat(t+1,".png"),1600,1600,870400))),t=await (0,g.eg)(e);n=Array.isArray(null==t?void 0:t.urls)?t.urls:[]}let r=[...i,...n];if(0===r.length){alert("No usable URLs to upload.");return}let s=await (0,g.VI)({product_gid:eT,image_urls:r});try{let e=Array.isArray(null==s?void 0:s.urls)?s.urls:Array.isArray(null==s?void 0:s.images)?s.images.map(e=>null==e?void 0:e.src).filter(Boolean):[];e.length>0&&eD(e)}catch(e){}alert("Uploaded ".concat((null===(e=s.urls)||void 0===e?void 0:e.length)||0," image(s) to Shopify."))}catch(e){alert("Upload failed: "+String((null==e?void 0:e.message)||e))}}async function eK(e,t){let a=await fetch(e),i=await a.blob(),n=i.type||"image/png";return new File([i],t,{type:n})}async function eQ(e,t,a,i,n){return new Promise(r=>{try{let s=new Image;s.onload=async()=>{try{let l=s.width,o=s.height,d=l,c=o,u=Math.min(1,Math.min(a/Math.max(1,l),i/Math.max(1,o)));d=Math.max(1,Math.round(l*u)),c=Math.max(1,Math.round(o*u));let p=document.createElement("canvas");p.width=d,p.height=c,p.getContext("2d").drawImage(s,0,0,d,c);let m=.9,g="image/jpeg",v=async e=>new Promise(t=>p.toBlob(e=>t(e),g,e)),h=await v(m);for(;h&&h.size>n&&m>.5;)m=Math.max(.5,m-.1),h=await v(m);if(!h){let a=await eK(e,t);r(a);return}let f=new File([h],t,{type:g});r(f)}catch(a){eK(e,t).then(r)}},s.onerror=()=>{eK(e,t).then(r)},s.src=e}catch(a){eK(e,t).then(r)}})}async function e$(){try{var e,t,a,i,n,r,s,l,o,d,c,u,p,m;let v;eA(eb.id,{status:"running",startedAt:O()});let h={headline:String((null===(e=eb.data)||void 0===e?void 0:e.headline)||""),primary_text:String((null===(t=eb.data)||void 0===t?void 0:t.primary_text)||""),description:String((null===(a=eb.data)||void 0===a?void 0:a.description)||""),image_url:String((null===(i=eb.data)||void 0===i?void 0:i.image_url)||""),landing_url:String((null===(n=eb.data)||void 0===n?void 0:n.landing_url)||""),call_to_action:(String((null===(r=eb.data)||void 0===r?void 0:r.call_to_action)||"SHOP_NOW")||"SHOP_NOW").toUpperCase(),adset_budget:"number"==typeof(null===(s=eb.data)||void 0===s?void 0:s.adset_budget)?eb.data.adset_budget:Number((null===(l=eb.data)||void 0===l?void 0:l.adset_budget)||9),title:String((null===(o=eb.data)||void 0===o?void 0:o.headline)||"")},f=!!(null===(d=eb.data)||void 0===d?void 0:d.advantage_plus),x=String((null===(c=eb.data)||void 0===c?void 0:c.saved_audience_id)||""),y=Array.isArray(null===(u=eb.data)||void 0===u?void 0:u.countries)?eb.data.countries:[];!f&&(x?h.saved_audience_id=x:y.length>0&&(h.targeting={geo_locations:{countries:y.map(e=>String(e||"").toUpperCase())}})),Array.isArray(null===(p=eb.data)||void 0===p?void 0:p.candidate_images)&&eb.data.candidate_images;let _=(Array.isArray(null===(m=eb.data)||void 0===m?void 0:m.selected_images)?eb.data.selected_images:[]).filter(e=>"string"==typeof e&&e);if(_.length>=2){let e=_.map(e=>({image_url:e,headline:h.headline,description:h.description,link:h.landing_url,call_to_action:h.call_to_action})),t={primary_text:h.primary_text,landing_url:h.landing_url,cards:e,call_to_action:h.call_to_action,adset_budget:h.adset_budget,title:h.title};h.saved_audience_id&&(t.saved_audience_id=h.saved_audience_id),h.targeting&&(t.targeting=h.targeting),v=await (0,g.sj)(t)}else{let e=_[0];e&&(h.image_url=e),v=await (0,g.dP)(h)}if(null==v?void 0:v.error)throw Error(v.error);eA(eb.id,{status:"success",output:{campaign_id:v.campaign_id||null,adsets:v.adsets||[],requests:v.requests||[]},finishedAt:O(),ms:1})}catch(e){eA(eb.id,{status:"error",error:String((null==e?void 0:e.message)||e),finishedAt:O(),ms:1})}}return(0,i.jsxs)("div",{className:"text-xs space-y-3",children:[(0,i.jsx)("div",{className:"text-slate-500",children:eb.data.label||eb.data.type||eb.type}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-slate-500 mb-1",children:"Inputs"}),(null===(o=eb.data)||void 0===o?void 0:o.type)==="gemini_ad_images"&&(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("div",{className:"break-all",children:[(0,i.jsx)("span",{className:"text-slate-500",children:"source_image_url:"})," ",String((null===(d=eb.data)||void 0===d?void 0:d.source_image_url)||"-")]}),(0,i.jsxs)("div",{className:"whitespace-pre-wrap",children:[(0,i.jsx)("span",{className:"text-slate-500",children:"prompt:"})," ",String((null===(c=eb.data)||void 0===c?void 0:c.prompt)||"-")]})]}),(null===(u=eb.data)||void 0===u?void 0:u.type)==="gemini_variant_set"&&(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("div",{className:"break-all",children:[(0,i.jsx)("span",{className:"text-slate-500",children:"source_image_url:"})," ",String((null===(p=eb.data)||void 0===p?void 0:p.source_image_url)||"-")]}),(0,i.jsxs)("div",{className:"whitespace-pre-wrap",children:[(0,i.jsx)("span",{className:"text-slate-500",children:"style_prompt:"})," ",String((null===(v=eb.data)||void 0===v?void 0:v.style_prompt)||"")]})]}),(null===(h=eb.data)||void 0===h?void 0:h.type)==="meta_ads_launch"&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mb-1",children:"Primary text"}),(0,i.jsx)(A,{rows:3,value:String((null===(y=eb.data)||void 0===y?void 0:y.primary_text)||""),onChange:e=>eN(eb.id,{primary_text:e.target.value})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mb-1",children:"Headline"}),(0,i.jsx)(N,{value:String((null===(_=eb.data)||void 0===_?void 0:_.headline)||""),onChange:e=>eN(eb.id,{headline:e.target.value})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mb-1",children:"Description (optional)"}),(0,i.jsx)(A,{rows:2,value:String((null===(b=eb.data)||void 0===b?void 0:b.description)||""),onChange:e=>eN(eb.id,{description:e.target.value})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mb-1",children:"Landing URL"}),(0,i.jsx)(N,{value:String((null===(j=eb.data)||void 0===j?void 0:j.landing_url)||""),onChange:e=>eN(eb.id,{landing_url:e.target.value})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mb-1",children:"CTA"}),(0,i.jsx)("select",{value:String((null===(w=eb.data)||void 0===w?void 0:w.call_to_action)||"SHOP_NOW"),onChange:e=>eN(eb.id,{call_to_action:e.target.value}),className:"w-full rounded-xl border px-3 py-2",children:["SHOP_NOW","LEARN_MORE","SIGN_UP","SUBSCRIBE","GET_OFFER","BUY_NOW","CONTACT_US"].map(e=>(0,i.jsx)("option",{value:e,children:e.replaceAll("_"," ")},e))})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mb-1",children:"Ad image"}),(0,i.jsxs)("select",{value:String((null===(C=eb.data)||void 0===C?void 0:C.image_url)||""),onChange:e=>eN(eb.id,{image_url:e.target.value}),className:"w-full rounded-xl border px-3 py-2",children:[(0,i.jsx)("option",{value:"",children:"Select image…"}),(Array.isArray(null===(k=eb.data)||void 0===k?void 0:k.candidate_images)?eb.data.candidate_images:[]).map((e,t)=>(0,i.jsx)("option",{value:e,children:e},t))]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mb-1",children:"Carousel images (select 2+ to create a carousel ad)"}),(0,i.jsx)("div",{className:"max-h-40 overflow-auto border rounded-xl p-2 space-y-1",children:(Array.isArray(null===(I=eb.data)||void 0===I?void 0:I.candidate_images)?eb.data.candidate_images:[]).map((e,t)=>{var a;let n=(Array.isArray(null===(a=eb.data)||void 0===a?void 0:a.selected_images)?eb.data.selected_images:[]).includes(e);return(0,i.jsxs)("label",{className:"flex items-center gap-2 text-xs",children:[(0,i.jsx)("input",{type:"checkbox",checked:n,onChange:()=>{var t;let a=Array.isArray(null===(t=eb.data)||void 0===t?void 0:t.selected_images)?eb.data.selected_images:[],i=n?a.filter(t=>t!==e):Array.from(new Set([...a,e]));eN(eb.id,{selected_images:i})}}),(0,i.jsx)("span",{className:"truncate",children:e})]},t)})}),(0,i.jsxs)("div",{className:"text-[11px] text-slate-500 mt-1",children:["Selected: ",Array.isArray(null===(E=eb.data)||void 0===E?void 0:E.selected_images)?eb.data.selected_images.length:0]})]}),(0,i.jsx)(S,{}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mb-1",children:"Ad set daily budget (USD)"}),(0,i.jsx)(N,{type:"number",min:1,value:String((null===(P=eb.data)||void 0===P?void 0:P.adset_budget)||9),onChange:e=>eN(eb.id,{adset_budget:""===e.target.value?9:Number(e.target.value)}),placeholder:"9"})]}),(0,i.jsx)("div",{children:(0,i.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,i.jsx)("input",{type:"checkbox",checked:!!(null===(R=eb.data)||void 0===R?void 0:R.advantage_plus),onChange:e=>eN(eb.id,{advantage_plus:e.target.checked})}),(0,i.jsx)("span",{children:"Advantage+ audience (let Meta expand targeting)"})]})}),!(null===(M=eb.data)||void 0===M?void 0:M.advantage_plus)&&(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mb-1",children:"Saved audience"}),(0,i.jsxs)("select",{value:String((null===(U=eb.data)||void 0===U?void 0:U.saved_audience_id)||""),onChange:e=>eN(eb.id,{saved_audience_id:e.target.value}),className:"w-full rounded-xl border px-3 py-2",children:[(0,i.jsx)("option",{value:"",children:"None"}),eS.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mb-1",children:"Countries (ISO codes, e.g., US, MA)"}),(0,i.jsx)(m,{value:Array.isArray(null===(D=eb.data)||void 0===D?void 0:D.countries)?eb.data.countries:[],onChange:e=>eN(eb.id,{countries:e}),placeholder:"Add country & Enter"})]}),(0,i.jsx)("div",{className:"text-[11px] text-slate-500",children:"If both saved audience and countries are provided, the saved audience takes precedence."})]}),(0,i.jsx)("div",{className:"flex justify-end",children:(0,i.jsx)(x,{size:"sm",onClick:e$,disabled:(null===(G=eb.run)||void 0===G?void 0:G.status)==="running",children:"Approve & Create Draft"})})]}),(null===(L=eb.data)||void 0===L?void 0:L.type)==="promotion_offer"&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mb-1",children:"Offer expansion prompt"}),(0,i.jsx)(A,{rows:4,value:String((null===(T=eb.data)||void 0===T?void 0:T.offer_prompt)||"You are a highly skilled, knowledgeable direct-response marketing expert. Expand the OFFER_IDEA into a complete, compelling promotional offer ready for Meta ads. Return ONE valid json object only with fields: offer { name, headline, subheadline, bullets[3-6], mechanics, price_anchor, risk_reversal, guarantee, urgency, CTA_label, creative_text[3-6] }. Rules: headlines ≤ 12 words; subheadline ≤ 18 words; bullets are concrete benefits; no emojis; clear, believable, specific; English only."),onChange:e=>eN(eb.id,{offer_prompt:e.target.value})}),(0,i.jsx)("div",{className:"flex justify-end",children:(0,i.jsx)(x,{size:"sm",variant:"outline",onClick:()=>eU(eb.id),disabled:(null===(z=eb.run)||void 0===z?void 0:z.status)==="running",children:"Generate Offer"})})]}),!((null===(F=eb.data)||void 0===F?void 0:F.type)==="gemini_ad_images"||(null===(Z=eb.data)||void 0===Z?void 0:Z.type)==="gemini_variant_set"||(null===(B=eb.data)||void 0===B?void 0:B.type)==="image_gallery"||(null===(W=eb.data)||void 0===W?void 0:W.type)==="meta_ads_launch"||(null===(Y=eb.data)||void 0===Y?void 0:Y.type)==="promotion_offer")&&(0,i.jsx)("pre",{className:"bg-slate-50 p-2 rounded overflow-x-auto max-h-[200px]",children:JSON.stringify(eb.data,null,2)})]}),(null===(J=eb.data)||void 0===J?void 0:J.type)==="angle_variant"&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mb-1",children:"Prompt for title + description"}),(0,i.jsx)(A,{rows:4,value:String((null===(q=eb.data)||void 0===q?void 0:q.prompt)||""),onChange:e=>eN(eb.id,{prompt:e.target.value})})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(x,{size:"sm",variant:"outline",onClick:()=>eC(eb.id),disabled:(null===(H=eb.run)||void 0===H?void 0:H.status)==="running",children:"Generate"}),(0,i.jsx)(x,{size:"sm",variant:(null===(X=eb.data)||void 0===X?void 0:X.approved)?"outline":"default",disabled:!(null===(V=eb.run)||void 0===V?void 0:V.output)||!!(null===(K=eb.data)||void 0===K?void 0:K.approved),onClick:()=>ek(eb.id),children:(null===(Q=eb.data)||void 0===Q?void 0:Q.approved)?"Approved":"Approve"})]})]}),(null===($=eb.data)||void 0===$?void 0:$.type)==="title_desc"&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mb-1",children:"Title"}),(0,i.jsx)(N,{value:String(((null===(ee=eb.data)||void 0===ee?void 0:ee.value)||{}).title||""),onChange:e=>{var t;return eN(eb.id,{value:{...(null===(t=eb.data)||void 0===t?void 0:t.value)||{},title:e.target.value}})}})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mb-1",children:"Description"}),(0,i.jsx)(A,{rows:3,value:String(((null===(et=eb.data)||void 0===et?void 0:et.value)||{}).description||""),onChange:e=>{var t;return eN(eb.id,{value:{...(null===(t=eb.data)||void 0===t?void 0:t.value)||{},description:e.target.value}})}})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mb-1",children:"Landing page prompt"}),(0,i.jsx)(A,{rows:4,value:String((null===(ea=eb.data)||void 0===ea?void 0:ea.landingPrompt)||""),onChange:e=>eN(eb.id,{landingPrompt:e.target.value})})]}),(0,i.jsx)("div",{className:"flex justify-end",children:(0,i.jsx)(x,{size:"sm",onClick:()=>eO(eb.id),disabled:(null===(ei=eb.run)||void 0===ei?void 0:ei.status)==="running",children:"Continue"})})]}),(null===(en=eb.data)||void 0===en?void 0:en.type)==="generate_angles"&&(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mb-1",children:"Angles to generate"}),(0,i.jsx)(N,{type:"number",min:1,max:5,value:String((null===(er=eb.data)||void 0===er?void 0:er.numAngles)||2),onChange:e=>eN(eb.id,{numAngles:Math.max(1,Math.min(5,Number(e.target.value)||2))})})]}),(null===(es=eb.data)||void 0===es?void 0:es.type)==="create_landing"&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500",children:"Landing page created."}),(()=>{try{var e,t,a,n,r,s,l;let o=String((null===(e=(null===(t=eb.run)||void 0===t?void 0:t.output)||{})||void 0===e?void 0:e.url)||""),d=(null===(a=(null===(n=eb.run)||void 0===n?void 0:n.output)||{})||void 0===a?void 0:a.landing_copy)||null,c=String((null===(r=(null===(s=eb.run)||void 0===s?void 0:s.output)||{})||void 0===r?void 0:r.prompt)||""),u=String((null===(l=d||{})||void 0===l?void 0:l.html)||"");return(0,i.jsxs)("div",{className:"space-y-2",children:[c&&(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500",children:"Prompt sent"}),(0,i.jsx)("pre",{className:"text-[11px] p-3 whitespace-pre-wrap overflow-auto border rounded-lg max-h-[180px] bg-slate-50",children:c})]}),d&&(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500",children:"Output (JSON)"}),(0,i.jsx)("pre",{className:"text-[11px] p-3 whitespace-pre overflow-auto border rounded-lg max-h-[220px] bg-slate-50",children:JSON.stringify(d,null,2)})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2 justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsx)("button",{onClick:()=>eW("preview"),className:"text-[11px] px-2 py-0.5 rounded ".concat("preview"===eB?"bg-white border":"border-transparent"),children:"Preview"}),(0,i.jsx)("button",{onClick:()=>eW("html"),className:"text-[11px] px-2 py-0.5 rounded ".concat("html"===eB?"bg-white border":"border-transparent"),children:"HTML"})]}),o&&(0,i.jsx)("button",{onClick:()=>eM(o),className:"text-xs px-3 py-1.5 rounded border hover:bg-slate-50",children:"Open page"})]}),u&&(0,i.jsx)("div",{className:"max-h-[320px] overflow-auto border rounded-lg",children:"preview"===eB?(0,i.jsx)("iframe",{title:"landing-inline-preview",srcDoc:u,className:"w-full h-[300px] bg-white"}):(0,i.jsx)("pre",{className:"text-[11px] p-3 whitespace-pre-wrap overflow-auto",children:u})})]})}catch(e){return null}})()]}),(null===(el=eb.data)||void 0===el?void 0:el.type)==="gemini_ad_images"&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("label",{className:"flex items-center gap-2",children:[(0,i.jsx)("input",{type:"checkbox",checked:(null===(eo=eb.data)||void 0===eo?void 0:eo.use_global_prompt)!==!1,onChange:e=>eN(eb.id,{use_global_prompt:e.target.checked})}),(0,i.jsx)("span",{children:"Use global default prompt"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mb-1",children:"Prompt"}),(0,i.jsx)(A,{rows:3,value:String((null===(ed=eb.data)||void 0===ed?void 0:ed.prompt)||""),onChange:e=>eN(eb.id,{prompt:e.target.value,use_global_prompt:!1})})]}),(0,i.jsx)("div",{className:"flex justify-end",children:(0,i.jsx)(x,{size:"sm",variant:"outline",onClick:()=>eI(eb.id),disabled:(null===(ec=eb.run)||void 0===ec?void 0:ec.status)==="running",children:"Generate"})})]}),(null===(eu=eb.data)||void 0===eu?void 0:eu.type)==="gemini_variant_set"&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("label",{className:"flex items-center gap-2",children:[(0,i.jsx)("input",{type:"checkbox",checked:(null===(ep=eb.data)||void 0===ep?void 0:ep.use_global_style)!==!1,onChange:e=>eN(eb.id,{use_global_style:e.target.checked})}),(0,i.jsx)("span",{children:"Use global default style"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mb-1",children:"Style prompt"}),(0,i.jsx)(A,{rows:3,value:String((null===(em=eb.data)||void 0===em?void 0:em.style_prompt)||""),onChange:e=>eN(eb.id,{style_prompt:e.target.value,use_global_style:!1})})]}),(0,i.jsx)("div",{className:"flex justify-end",children:(0,i.jsx)(x,{size:"sm",variant:"outline",onClick:()=>eI(eb.id),disabled:(null===(eg=eb.run)||void 0===eg?void 0:eg.status)==="running",children:"Generate"})})]}),eX?(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-slate-500 mb-1",children:"Gallery images"}),eH.length>0?(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"grid grid-cols-2 gap-2",children:eH.map((e,t)=>{var a,n;return(0,i.jsxs)("div",{className:"relative border rounded p-1 ".concat(((null===(a=eb.data)||void 0===a?void 0:a.selected)||{})[e]?"ring-2 ring-blue-500":"ring-1 ring-slate-200"),children:[(0,i.jsx)("label",{className:"absolute top-1 left-1 bg-white/80 rounded p-0.5",children:(0,i.jsx)("input",{type:"checkbox",checked:!!((null===(n=eb.data)||void 0===n?void 0:n.selected)||{})[e],onChange:()=>{var t,a;return eN(eb.id,{selected:{...(null===(t=eb.data)||void 0===t?void 0:t.selected)||{},[e]:!((null===(a=eb.data)||void 0===a?void 0:a.selected)||{})[e]}})}})}),(0,i.jsx)("button",{className:"absolute top-1 right-1 bg-white/85 text-slate-700 rounded px-1 text-[10px]",onClick:t=>{t.preventDefault(),t.stopPropagation();let a=document.createElement("a");a.href=e,a.download="image",document.body.appendChild(a),a.click(),a.remove()},children:"Download"}),(0,i.jsx)("img",{src:f(e),alt:"img-".concat(t),className:"w-full h-24 object-cover rounded",onClick:()=>ew(e)})]},t)})}),(0,i.jsx)("div",{className:"flex items-center gap-2 justify-end mt-2",children:(0,i.jsx)(x,{size:"sm",onClick:()=>eR(eb.id),disabled:!Object.values((null===(ev=eb.data)||void 0===ev?void 0:ev.selected)||{}).some(Boolean),children:"Approve"})}),(0,i.jsxs)("div",{className:"mt-3 space-y-1",children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500",children:"Landing prompt override"}),(0,i.jsx)(A,{rows:6,value:String((null===(eh=eb.data)||void 0===eh?void 0:eh.landing_prompt)||""),onChange:e=>eN(eb.id,{landing_prompt:e.target.value})}),(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500",children:"If empty, the app default prompt will be used."}),(0,i.jsx)(x,{size:"sm",variant:"outline",onClick:()=>eN(eb.id,{landing_prompt:eL}),children:"Use app default"})]})]})]}):(0,i.jsx)("div",{className:"text-slate-500",children:"No images yet. Generate with Gemini or upload to product."})]}):eH.length>0?(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-slate-500 mb-1",children:"Output images"}),(0,i.jsx)("div",{className:"grid grid-cols-2 gap-2",children:eH.map((e,t)=>(0,i.jsxs)("div",{className:"relative border rounded p-1 ".concat(eF[e]?"ring-2 ring-blue-500":"ring-1 ring-slate-200"),children:[(0,i.jsx)("label",{className:"absolute top-1 left-1 bg-white/80 rounded p-0.5",children:(0,i.jsx)("input",{type:"checkbox",checked:!!eF[e],onChange:()=>{eZ(t=>({...t,[e]:!t[e]}))}})}),(0,i.jsx)("button",{className:"absolute top-1 right-1 bg-white/85 text-slate-700 rounded px-1 text-[10px]",onClick:t=>{t.preventDefault(),t.stopPropagation();let a=document.createElement("a");a.href=e,a.download="image",document.body.appendChild(a),a.click(),a.remove()},children:"Download"}),(0,i.jsx)("img",{src:f(e),alt:"img-".concat(t),className:"w-full h-24 object-cover rounded",onClick:()=>ew(e)})]},t))}),(0,i.jsx)("div",{className:"flex items-center justify-end mt-2",children:(0,i.jsx)("button",{className:"rounded-xl font-semibold px-3 py-1.5 border",onClick:e=>{e.preventDefault(),e.stopPropagation();try{eH.forEach((e,t)=>{let a=document.createElement("a");a.href=e,a.download="image-".concat(t+1),document.body.appendChild(a),a.click(),a.remove()})}catch(e){}},children:"Download All"})}),(0,i.jsxs)("div",{className:"mt-2 space-y-1",children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500",children:"Shopify product GID"}),(0,i.jsx)("input",{className:"w-full rounded-xl border px-3 py-2",placeholder:"gid://shopify/Product/1234567890",value:eT,onChange:e=>ez(e.target.value)}),(0,i.jsx)("div",{className:"flex justify-end",children:(0,i.jsx)("button",{className:"rounded-xl font-semibold px-3 py-1.5 bg-blue-600 text-white disabled:opacity-60",onClick:eV,disabled:!eT||!Object.values(eF).some(Boolean),children:"Upload selected to Shopify"})})]})]}):(null===(ef=eb.run)||void 0===ef?void 0:ef.output)?(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-slate-500 mb-1",children:"Results"}),(0,i.jsx)("pre",{className:"bg-slate-50 p-2 rounded overflow-x-auto max-h-[200px]",children:JSON.stringify(eb.run.output,null,2)})]}):null,(null===(ex=eb.data)||void 0===ex?void 0:ex.type)==="gemini_variant_set"&&Array.isArray(eG)&&eG.length>0&&(0,i.jsxs)("div",{className:"mt-3 border-t pt-2",children:[(0,i.jsx)("div",{className:"text-[11px] text-slate-500 mb-1",children:"Generate a specific color variant"}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsxs)("select",{value:eJ,onChange:e=>eq(e.target.value),className:"w-full rounded-xl border px-3 py-2",children:[(0,i.jsx)("option",{value:"",children:"Select color…"}),eG.map((e,t)=>(0,i.jsx)("option",{value:e,children:e},t))]}),(0,i.jsx)(x,{size:"sm",variant:"outline",disabled:!eJ||(null===(ey=eb.run)||void 0===ey?void 0:ey.status)==="running",onClick:async()=>{let e="Exact colorway: ".concat(eJ,". CRITICAL: Strictly render the ").concat(eJ," color variant only; do not change materials, shape, or branding. Neutral studio background.");eI(eb.id,{variantOverride:[{name:eJ,description:e}]})},children:"Generate"})]})]}),(null===(e_=eb.run)||void 0===e_?void 0:e_.error)&&(0,i.jsx)("div",{className:"text-rose-600",children:String(eb.run.error)})]})}function z(){return(0,i.jsxs)("div",{className:"absolute inset-0",children:[(0,i.jsx)("div",{className:"absolute inset-0 bg-[linear-gradient(to_right,_#eef2ff_1px,transparent_1px),linear-gradient(to_bottom,_#eef2ff_1px,transparent_1px)] bg-[size:24px_24px]"}),(0,i.jsx)("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_20%_20%,rgba(59,130,246,0.06),transparent_30%),radial-gradient(circle_at_80%_60%,rgba(14,165,233,0.06),transparent_35%)]"})]})}function F(e){let{edge:t,nodes:a,active:n}=e,r=a.find(e=>e.id===t.from),s=a.find(e=>e.id===t.to);if(!r||!s)return null;let l=r.x+200,o=function(e,t,a,i){let n=.4*Math.abs(a-e);return"M ".concat(e," ").concat(t," C ").concat(e+n," ").concat(t,", ").concat(a-n," ").concat(i,", ").concat(a," ").concat(i)}(l,r.y+100,s.x+20,s.y+100);return(0,i.jsxs)("svg",{className:"absolute overflow-visible pointer-events-none",style:{left:0,top:0},children:[(0,i.jsxs)("defs",{children:[(0,i.jsx)("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",markerUnits:"strokeWidth",children:(0,i.jsx)("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#94a3b8"})}),(0,i.jsx)("marker",{id:"arrowhead-active",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",markerUnits:"strokeWidth",children:(0,i.jsx)("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#3b82f6"})})]}),(0,i.jsx)("path",{d:o,className:"fill-none ".concat(n?"edge edge-active":"edge"),strokeWidth:n?3:2,strokeLinecap:"round",strokeLinejoin:"round",vectorEffect:"non-scaling-stroke",markerEnd:n?"url(#arrowhead-active)":"url(#arrowhead)"})]})}},6264:function(e,t,a){a.d(t,{$8:function(){return X},DO:function(){return d},HW:function(){return T},HX:function(){return y},JA:function(){return L},KQ:function(){return N},Ks:function(){return z},LJ:function(){return k},ME:function(){return u},Nm:function(){return U},PN:function(){return h},Q:function(){return F},Rd:function(){return p},Sv:function(){return S},V0:function(){return J},VI:function(){return w},WM:function(){return x},XD:function(){return c},_R:function(){return H},_X:function(){return q},aW:function(){return Y},dP:function(){return _},e1:function(){return G},eg:function(){return j},ew:function(){return V},fE:function(){return m},fh:function(){return O},hw:function(){return f},jZ:function(){return M},kY:function(){return Z},l9:function(){return g},n4:function(){return o},oB:function(){return P},rU:function(){return W},sF:function(){return R},sP:function(){return D},sQ:function(){return E},sj:function(){return b},sm:function(){return A},th:function(){return C},vz:function(){return B},xY:function(){return s},yD:function(){return l},yp:function(){return v},zO:function(){return I}});var i=a(8472);let n=a(357).env.NEXT_PUBLIC_API_BASE_URL||"";function r(){try{return localStorage.getItem("ptos_store")||void 0}catch(e){return}}async function s(e){let t=new FormData;for(let a of(t.append("audience",e.audience),t.append("benefits",JSON.stringify(e.benefits)),t.append("pain_points",JSON.stringify(e.pain_points)),null!=e.base_price&&t.append("base_price",String(e.base_price)),e.title&&t.append("title",e.title),Array.isArray(e.sizes)&&t.append("sizes",JSON.stringify(e.sizes)),Array.isArray(e.colors)&&t.append("colors",JSON.stringify(e.colors)),e.targeting&&t.append("targeting","string"==typeof e.targeting?e.targeting:JSON.stringify(e.targeting)),"boolean"==typeof e.advantage_plus&&t.append("advantage_plus",String(e.advantage_plus)),"number"==typeof e.adset_budget&&t.append("adset_budget",String(e.adset_budget)),e.model&&t.append("model",e.model),e.angles_prompt&&t.append("angles_prompt",e.angles_prompt),e.title_desc_prompt&&t.append("title_desc_prompt",e.title_desc_prompt),e.landing_copy_prompt&&t.append("landing_copy_prompt",e.landing_copy_prompt),e.images||[]))t.append("images",a);let{data:a}=await i.Z.post("".concat(n,"/api/tests"),t,{headers:{"Content-Type":"multipart/form-data"}});return a}async function l(e){let{data:t}=await i.Z.get("".concat(n,"/api/tests/").concat(e));return t}async function o(e){let{data:t}=await i.Z.get("".concat(n,"/api/tests/").concat(e,"?slim=1"));return t}async function d(e){var t,a;let s={...e,settings:{...e.settings||{},store:null!==(a=null==e?void 0:null===(t=e.settings)||void 0===t?void 0:t.store)&&void 0!==a?a:r()}},{data:l}=await i.Z.post("".concat(n,"/api/flows/draft"),s);return l}async function c(e,t){var a,s;let l={...t,settings:{...t.settings||{},store:null!==(s=null==t?void 0:null===(a=t.settings)||void 0===a?void 0:a.store)&&void 0!==s?s:r()}},{data:o}=await i.Z.put("".concat(n,"/api/flows/draft/").concat(e),l);return o}async function u(e){let{data:t}=await i.Z.get("".concat(n,"/api/flows/").concat(e));return t}async function p(e,t){let a=[];"number"==typeof e&&a.push("limit=".concat(e));let s=t||r();s&&a.push("store=".concat(encodeURIComponent(s)));let l=a.length?"?".concat(a.join("&")):"",{data:o}=await i.Z.get("".concat(n,"/api/flows").concat(l));return o}async function m(e){let{data:t}=await i.Z.delete("".concat(n,"/api/flows/").concat(e));return t}async function g(){let{data:e}=await i.Z.get("".concat(n,"/api/meta/audiences"));return e}async function v(e){let{data:t}=await i.Z.post("".concat(n,"/api/flows/ads/launch"),e);return t}async function h(e){let{data:t}=await i.Z.post("".concat(n,"/api/llm/angles"),e);return t}async function f(e){let{data:t}=await i.Z.post("".concat(n,"/api/llm/title_desc"),e);return t}async function x(e){let{data:t}=await i.Z.post("".concat(n,"/api/llm/landing_copy"),e);return t}async function y(e){let{data:t}=await i.Z.post("".concat(n,"/api/llm/analyze_landing_page"),e);return t}async function _(e){let{data:t}=await i.Z.post("".concat(n,"/api/meta/draft_image_campaign"),e);return t}async function b(e){let{data:t}=await i.Z.post("".concat(n,"/api/meta/draft_carousel_campaign"),e);return t}async function j(e){let t=new FormData;for(let a of e||[])t.append("files",a);let{data:a}=await i.Z.post("".concat(n,"/api/uploads"),t,{headers:{"Content-Type":"multipart/form-data"}});return a}async function w(e){let{data:t}=await i.Z.post("".concat(n,"/api/shopify/upload_images"),{...e,store:r()});return t}async function N(e){let{data:t}=await i.Z.post("".concat(n,"/api/shopify/product_create_from_title_desc"),{...e,store:r()});return t}async function A(e){let{data:t}=await i.Z.post("".concat(n,"/api/shopify/update_title"),{...e,store:r()});return t}async function S(e){var t,a;let{data:s}=await i.Z.post("".concat(n,"/api/shopify/create_page_from_copy"),{...e,store:r()});return{page_url:null!==(a=null!==(t=null==s?void 0:s.page_url)&&void 0!==t?t:null==s?void 0:s.url)&&void 0!==a?a:void 0}}async function C(e){let{data:t}=await i.Z.post("".concat(n,"/api/shopify/configure_variants"),{...e,store:r()});return t}async function k(e){let t=new FormData;t.append("product_gid",e.product_gid),e.title&&t.append("title",e.title),e.description&&t.append("description",e.description),e.landing_copy&&t.append("landing_copy",JSON.stringify(e.landing_copy));let a=r();for(let i of(a&&t.append("store",a),e.files||[]))t.append("files",i);let{data:s}=await i.Z.post("".concat(n,"/api/shopify/upload_files"),t,{headers:{"Content-Type":"multipart/form-data"}});return s}async function O(e){var t;let a={...e,store:null!==(t=e.store)&&void 0!==t?t:r()},{data:s}=await i.Z.post("".concat(n,"/api/shopify/collection_products"),a);return s}async function I(e){let t=[],a=null!=e?e:r();a&&t.push("store=".concat(encodeURIComponent(a)));let s=t.length?"?".concat(t.join("&")):"",{data:l}=await i.Z.get("".concat(n,"/api/campaign_mappings").concat(s));return l}async function E(e){var t;let a={...e,store:null!==(t=e.store)&&void 0!==t?t:r()},{data:s}=await i.Z.post("".concat(n,"/api/campaign_mappings"),a);return s}async function P(e){let{data:t}=await i.Z.post("".concat(n,"/api/gemini/ad_image"),e);return t}async function R(e){let{data:t}=await i.Z.post("".concat(n,"/api/gemini/feature_benefit_set"),e);return t}async function M(e){let{data:t}=await i.Z.post("".concat(n,"/api/agent/execute"),e);return t}async function U(e){let{data:t}=await i.Z.post("".concat(n,"/api/translate"),e);return t}async function D(e){let{data:t}=await i.Z.get("".concat(n,"/api/agents").concat("number"==typeof e?"?limit=".concat(e):""));return t}async function G(e){let{data:t}=await i.Z.get("".concat(n,"/api/agents/").concat(e));return t}async function L(e,t){let{data:a}=await i.Z.put("".concat(n,"/api/agents/").concat(e),t);return a}async function T(e,t){let{data:a}=await i.Z.get("".concat(n,"/api/agents/").concat(e,"/runs").concat("number"==typeof t?"?limit=".concat(t):""));return a}async function z(e,t){let{data:a}=await i.Z.post("".concat(n,"/api/agents/").concat(e,"/runs"),t);return a}async function F(e,t,a){let{data:r}=await i.Z.put("".concat(n,"/api/agents/").concat(e,"/runs/").concat(t),a);return r}async function Z(e,t){let{data:a}=await i.Z.get("".concat(n,"/api/agents/").concat(e,"/runs/").concat(t));return a}async function B(e){let{data:t}=await i.Z.post("".concat(n,"/api/llm/product_from_image"),e);return t}async function W(e){let{data:t}=await i.Z.post("".concat(n,"/api/gemini/variant_set"),e);return t}async function Y(){let{data:e}=await i.Z.get("".concat(n,"/api/prompts"));return e}async function J(e){let{data:t}=await i.Z.post("".concat(n,"/api/prompts"),e);return t}async function q(e,t){let a=[];e&&a.push("date_preset=".concat(encodeURIComponent(e))),t&&a.push("ad_account=".concat(encodeURIComponent(t)));let r=a.length?"?".concat(a.join("&")):"",{data:s}=await i.Z.get("".concat(n,"/api/meta/campaigns").concat(r));return s}async function H(e){var t,a;let s={...e,store:null!==(t=e.store)&&void 0!==t?t:r(),include_closed:null===(a=e.include_closed)||void 0===a||a,date_field:e.date_field},{data:l}=await i.Z.post("".concat(n,"/api/shopify/orders_count_by_title"),s);return l}async function X(e){var t;let a={...e,store:null!==(t=e.store)&&void 0!==t?t:r()},{data:s}=await i.Z.post("".concat(n,"/api/shopify/products_brief"),a);return s}async function V(e){var t,a;let s={...e,store:null!==(t=e.store)&&void 0!==t?t:r(),include_closed:null===(a=e.include_closed)||void 0===a||a,aggregate:e.aggregate,date_field:e.date_field},{data:l}=await i.Z.post("".concat(n,"/api/shopify/orders_count_by_collection"),s);return l}}}]);