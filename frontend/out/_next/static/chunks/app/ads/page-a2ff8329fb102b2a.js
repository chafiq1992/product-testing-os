(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[418],{4106:function(e,t,a){Promise.resolve().then(a.bind(a,9619))},9619:function(e,t,a){"use strict";a.d(t,{default:function(){return j}});var n=a(7437),s=a(2265),i=a(6463),l=a(7138),r=a(2757);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let o=(0,a(8030).Z)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);var d=a(399),c=a(6264),p=a(357);function u(e){let{children:t,onClick:a,disabled:s,variant:i="default",size:l="md"}=e;return(0,n.jsx)("button",{onClick:a,disabled:s,className:"".concat("rounded-xl font-semibold transition inline-flex items-center justify-center"," ").concat("sm"===l?"text-sm px-3 py-1.5":"px-4 py-2"," ").concat("outline"===i?"border border-slate-300 text-slate-700 bg-white hover:bg-slate-50 disabled:opacity-60":"bg-blue-600 hover:bg-blue-700 text-white disabled:opacity-60"),children:t})}function m(e){let{children:t}=e;return(0,n.jsx)("div",{className:"bg-white border rounded-2xl shadow-sm",children:t})}function g(e){let{children:t,className:a=""}=e;return(0,n.jsx)("div",{className:"px-4 pt-4 ".concat(a),children:t})}function h(e){let{children:t,className:a=""}=e;return(0,n.jsx)("h3",{className:"font-semibold ".concat(a),children:t})}function x(e){let{children:t,className:a=""}=e;return(0,n.jsx)("div",{className:"px-4 pb-4 ".concat(a),children:t})}function v(e){return(0,n.jsx)("input",{...e,className:"w-full rounded-xl border px-3 py-2 ".concat(e.className||"")})}function f(e){return(0,n.jsx)("textarea",{...e,className:"w-full rounded-xl border px-3 py-2 ".concat(e.className||"")})}function y(e){let{className:t=""}=e;return(0,n.jsx)("div",{className:"border-t ".concat(t)})}function j(){var e,t,a,j,b,w,A,S,C,I,k,O,R,E,P,M,z,L,U,D;let Z=(0,i.useSearchParams)(),B=Z.get("id")||Z.get("flow")||"",T=Z.get("store");(0,s.useEffect)(()=>{try{T&&localStorage.setItem("ptos_store",T)}catch(e){}},[T]);let[F,J]=(0,s.useState)(""),[G,H]=(0,s.useState)("Shoppers likely to buy this product"),[Y,X]=(0,s.useState)(""),[V,W]=(0,s.useState)(""),[q,K]=(0,s.useState)(""),[Q,$]=(0,s.useState)(""),[ee,et]=(0,s.useState)(""),[ea,en]=(0,s.useState)(""),[es,ei]=(0,s.useState)([]),[el,er]=(0,s.useState)({audience:"manual",benefits:"manual",pains:"manual",offers:"manual",emotions:"manual",title:"manual",sourceImage:"manual"}),eo=p.env.NEXT_PUBLIC_API_BASE_URL||"";function ed(e){try{if(!e||e.startsWith("/")||!/^https?:\/\//i.test(e))return e;let t=new URL(e).host,a="";try{a=eo?new URL(eo).host:window.location.host}catch(e){}return["cdn.shopify.com","images.openai.com","oaidalleapiprodscus.blob.core.windows.net"].some(e=>t===e||t.endsWith("."+e))||a&&t===a?e:"".concat(eo,"/proxy/image?url=").concat(encodeURIComponent(e))}catch(t){return e}}let[ec,ep]=(0,s.useState)(3),[eu,em]=(0,s.useState)([]),[eg,eh]=(0,s.useState)(0),[ex,ev]=(0,s.useState)([]),[ef,ey]=(0,s.useState)(""),[ej,e_]=(0,s.useState)(""),[eN,eb]=(0,s.useState)(""),[ew,eA]=(0,s.useState)([]),[eS,eC]=(0,s.useState)("SHOP_NOW"),[eI,ek]=(0,s.useState)(9),[eO,eR]=(0,s.useState)(!0),[eE,eP]=(0,s.useState)("gpt-5"),[eM,ez]=(0,s.useState)(""),[eL,eU]=(0,s.useState)(""),[eD,eZ]=(0,s.useState)([]),[eB,eT]=(0,s.useState)(!1),[eF,eJ]=(0,s.useState)(!1),[eG,eH]=(0,s.useState)(B||""),eY=(0,s.useRef)({});async function eX(){if(eG)return eG;let e={audience:G,benefits:V.split("\n").map(e=>e.trim()).filter(Boolean),pain_points:q.split("\n").map(e=>e.trim()).filter(Boolean),title:Y||void 0},t={flow_type:"ads",adset_budget:eI,advantage_plus:eO,model:eE};eM&&(t.countries=eM.split(",").map(e=>e.trim()).filter(Boolean)),eL&&(t.saved_audience_id=eL);let a=await (0,c.DO)({product:e,image_urls:es,settings:t,prompts:{analyze_landing_prompt:e4,headlines_prompt:e$,copies_prompt:e1,gemini_ad_prompt:e5},ui:{zoom:tp,pan:tm,selected_node:tx,active_left_tab:td},flow:{nodes:tA,edges:tC}});eH(a.id);try{let e=new URL(window.location.href);e.searchParams.set("id",a.id),window.history.replaceState({},"",e.toString())}catch(e){}return a.id}async function eV(e){if(eG)try{let t={selectedHeadline:ef,selectedPrimary:ej,selectedImage:eN,selectedImages:ew,cta:eS,budget:eI,advantagePlus:eO,countries:eM,savedAudienceId:eL,candidateImages:es,adImages:ex,...function(){let e=tA.filter(e=>"angle_variant"===e.type).map(e=>{var t;let a=e.id,n=tA.filter(e=>{var t;return"headlines_out"===e.type&&(null===(t=e.data)||void 0===t?void 0:t.angleId)===a}).flatMap(e=>{var t;return Array.isArray(null===(t=e.data)||void 0===t?void 0:t.headlines)?e.data.headlines:[]}),s=tA.filter(e=>{var t;return"copies_out"===e.type&&(null===(t=e.data)||void 0===t?void 0:t.angleId)===a}).flatMap(e=>{var t;return Array.isArray(null===(t=e.data)||void 0===t?void 0:t.primaries)?e.data.primaries:[]}),i=tA.filter(e=>{var t;return"images_out"===e.type&&(null===(t=e.data)||void 0===t?void 0:t.angleId)===a}).flatMap(e=>{var t;return Array.isArray(null===(t=e.data)||void 0===t?void 0:t.images)?e.data.images:[]});return{angle:(null===(t=e.data)||void 0===t?void 0:t.angle)||{},headlines:n.slice(0,12),primaries:s.slice(0,12),images:i.slice(0,12)}});return{landing_url:F,source_image:ea||es[1]||es[0]||"",angles:eu,per_angle:e}}(),...e||{}},a={audience:G,benefits:V.split("\n").filter(Boolean),pain_points:q.split("\n").filter(Boolean),title:Y||void 0};await (0,c.XD)(eG,{product:a,ads:t,prompts:{analyze_landing_prompt:e4,headlines_prompt:e$,copies_prompt:e1,gemini_ad_prompt:e5},settings:{flow_type:"ads",adset_budget:eI,advantage_plus:eO,model:eE},ui:{zoom:tp,pan:tm,selected_node:tx,active_left_tab:td},flow:{nodes:tA,edges:tC}})}catch(e){}}async function eW(){let e=await eX();try{if(!eY.current[e]){let t=await (0,c.yp)({flow_id:e,landing_url:F||void 0,source_image:ea||es[1]||es[0]||void 0,num_angles:3,prompts:{analyze_landing_prompt:e4,angles_prompt:eK,headlines_prompt:e$,copies_prompt:e1,gemini_ad_prompt:e5},model:eE});t&&!t.error&&(eY.current[e]=!0)}}catch(e){}(async()=>{for(;eF&&(!F||!ea);)F&&!ea&&es.length>1&&en(es[1]),await new Promise(e=>setTimeout(e,400));if(!eF||(F&&(!es||0===es.length)&&await tN(),await eV(),!eF))return;tE(),t_({step:"generate_angles"});let e=await eq();if(await eV(),!eF)return;let t=e&&e.length>0?e:tk.current.filter(e=>"angle_variant"===e.type).slice(0,3);for(let e=0;e<t.length;e++){let a=t[e];if(!eF)break;await tD(a.id),await new Promise(e=>setTimeout(e,250));let n=tk.current.find(e=>{var t;return"headlines"===e.type&&(null===(t=e.data)||void 0===t?void 0:t.angleId)===a.id}),s=tk.current.find(e=>{var t;return"copies"===e.type&&(null===(t=e.data)||void 0===t?void 0:t.angleId)===a.id}),i=tk.current.find(e=>{var t;return"gemini_images"===e.type&&(null===(t=e.data)||void 0===t?void 0:t.angleId)===a.id});t_({step:"generate_headlines",angle_index:e}),n&&await tM(n.id),t_({step:"generate_copies",angle_index:e}),s&&await tz(s.id),t_({step:"generate_images",angle_index:e}),i&&await tL(i.id),await eV()}t_(null)})()}async function eq(){try{eT(!0);let e={audience:G,benefits:V.split("\n").map(e=>e.trim()).filter(Boolean),pain_points:q.split("\n").map(e=>e.trim()).filter(Boolean),title:Y||void 0},t=await (0,c.PN)({product:e,num_angles:3,prompt:eK||void 0,model:eE}),a=Array.isArray(null==t?void 0:t.angles)?t.angles:[];em(a);let n=tk.current.find(e=>"landing"===e.type)||tk.current[0],s=tk.current.find(e=>"angles"===e.type);!s&&n&&(s=tO("angles",n,{},{x:n.x+300,y:n.y}),tR(n,s));let i=[],l=Math.min(3,Math.max(0,a.length||3));for(let e=0;e<l;e++){let t=a[e]||{name:"Angle ".concat(e+1)},n=tP("angle_variant",s,{angle:t,angleIndex:e},e,l);i.push(n)}return i}catch(e){return alert("Angles generation failed: "+String((null==e?void 0:e.message)||e)),[]}finally{eT(!1)}}(0,s.useEffect)(()=>{(async()=>{if(B)try{let t=await (0,c.ME)(B);try{var e;let a=(null==t?void 0:t.ui)||{};"number"==typeof a.zoom&&tu(a.zoom),a.pan&&"number"==typeof a.pan.x&&"number"==typeof a.pan.y&&tg({x:a.pan.x,y:a.pan.y}),"string"==typeof a.selected_node&&tv(a.selected_node),"string"==typeof a.active_left_tab&&("inputs"===a.active_left_tab||"prompts"===a.active_left_tab)&&tc(a.active_left_tab);let n=null==t?void 0:null===(e=t.settings)||void 0===e?void 0:e.model;"string"==typeof n&&eP(n)}catch(e){}try{let e=(null==t?void 0:t.flow)||{},a=Array.isArray(null==e?void 0:e.nodes)?e.nodes:[],n=Array.isArray(null==e?void 0:e.edges)?e.edges:[];if(a.length>0){tS(a),tI(n);try{let e=a.map(e=>Number(String((null==e?void 0:e.id)||"").replace(/[^0-9]/g,""))).filter(e=>Number.isFinite(e)),t=e.length>0?Math.max(...e):0;tb.current=Math.max(tb.current,t+1)}catch(e){}}}catch(e){}let a=(null==t?void 0:t.ads)||{};"string"==typeof a.selectedHeadline&&ey(a.selectedHeadline),"string"==typeof a.selectedPrimary&&e_(a.selectedPrimary),"string"==typeof a.cta&&eC(a.cta),"number"==typeof a.budget&&ek(a.budget),"boolean"==typeof a.advantagePlus&&eR(a.advantagePlus),"string"==typeof a.savedAudienceId&&eU(a.savedAudienceId),"string"==typeof a.countries&&ez(a.countries);let n=Array.isArray(a.adImages)?a.adImages:[];n.length>0&&ev(n);try{let e=(null==t?void 0:t.prompts)||{};"string"==typeof e.headlines_prompt?e0(e.headlines_prompt):"string"==typeof e.angles_prompt&&e0(e.angles_prompt),"string"==typeof e.copies_prompt&&e2(e.copies_prompt),"string"==typeof e.gemini_ad_prompt&&e3(e.gemini_ad_prompt),"string"==typeof e.analyze_landing_prompt&&e6(e.analyze_landing_prompt)}catch(e){}}catch(e){}})()},[B]),(0,s.useEffect)(()=>{(async()=>{try{let e=await (0,c.l9)(),t=Array.isArray(null==e?void 0:e.data)?e.data:[];eZ(t)}catch(e){eZ([])}})()},[]),(0,s.useEffect)(()=>{try{let e=localStorage.getItem("ptos_ads_auto_run");null!=e&&eJ("1"===e)}catch(e){}},[]),(0,s.useEffect)(()=>{try{localStorage.setItem("ptos_ads_auto_run",eF?"1":"0")}catch(e){}},[eF]),(0,s.useEffect)(()=>{if(!eG)return;let e=!1,t=async()=>{try{let e=await (0,c.ME)(eG),t=(null==e?void 0:e.ads)||{};try{var a;let e=((Array.isArray(null==t?void 0:null===(a=t.analyze)||void 0===a?void 0:a.images)?t.analyze.images:[])||[]).filter(e=>"string"==typeof e&&e),n=e.slice(1),s=n.length>0?n:e;F&&s.length>0&&0===es.length&&(ei(s.slice(0,10)),ea||en(s[0]))}catch(e){}try{let e=[];for(let a of(null==t?void 0:t.per_angle)||[])for(let t of(null==a?void 0:a.images)||[])"string"==typeof t&&t&&e.push(t);e.length>0&&ev(t=>{let a=new Set([...t||[],...e]);return Array.from(a)})}catch(e){}try{0===eu.length&&Array.isArray(null==t?void 0:t.angles)&&t.angles.length>0&&em(t.angles)}catch(e){}try{!function(e){if(!e||"object"!=typeof e)return;let t=Array.isArray(e.angles)?e.angles:[];if(t.length>0){let e=tk.current,a=e.find(e=>"landing"===e.type)||e[0],n=e.find(e=>"angles"===e.type);if(n||(n=tO("angles",a,{},{x:a.x+300,y:a.y}),tR(a,n)),0===e.filter(e=>"angle_variant"===e.type).length){let e=Math.min(3,t.length);for(let a=0;a<e;a++){let s=t[a],i=tP("angle_variant",n,{angle:s,angleIndex:a},a,e);tP("headlines",i,{angle:s,angleId:i.id,angleIndex:a},0,3),tP("copies",i,{angle:s,angleId:i.id,angleIndex:a},1,3),tP("gemini_images",i,{from:ea||es[1]||es[0]||"",angle:s,angleId:i.id,angleIndex:a},2,3)}}}let a=Array.isArray(e.per_angle)?e.per_angle:[];a.length>0&&a.forEach((e,t)=>{let a=tk.current.find(e=>"angle_variant"===e.type&&Number((e.data||{}).angleIndex)===t);if(a){if(Array.isArray(e.headlines)&&e.headlines.length>0&&!tk.current.find(e=>"headlines_out"===e.type&&(e.data||{}).angleId===a.id)){let t=tP("headlines_out",a,{headlines:e.headlines.slice(0,8),angleId:a.id},0,1),n=tk.current.find(e=>"meta_ad"===e.type&&(e.data||{}).angleId===a.id)||tO("meta_ad",t,{angleId:a.id},{x:t.x+300,y:t.y+300});tR(t,n)}if(Array.isArray(e.primaries)&&e.primaries.length>0&&!tk.current.find(e=>"copies_out"===e.type&&(e.data||{}).angleId===a.id)){let t=tP("copies_out",a,{primaries:e.primaries.slice(0,2),angleId:a.id},0,1),n=tk.current.find(e=>"meta_ad"===e.type&&(e.data||{}).angleId===a.id)||tO("meta_ad",t,{angleId:a.id},{x:t.x+300,y:t.y+300});tR(t,n)}if(Array.isArray(e.images)&&e.images.length>0&&!tk.current.find(e=>"images_out"===e.type&&(e.data||{}).angleId===a.id)){let t=tP("images_out",a,{images:e.images.slice(0,4),angleId:a.id},0,1),n=tk.current.find(e=>"meta_ad"===e.type&&(e.data||{}).angleId===a.id)||tO("meta_ad",t,{angleId:a.id},{x:t.x+300,y:t.y+300});tR(t,n)}}})}(t)}catch(e){}try{let e=Array.isArray(null==t?void 0:t.steps)?t.steps:[],a=e.filter(e=>(null==e?void 0:e.status)==="running"),n=a.length>0?a[a.length-1]:e.length>0?e[e.length-1]:null;t_(n||null)}catch(e){}}catch(e){}e||setTimeout(t,8e3)},a=setTimeout(t,3e3);return()=>{e=!0,clearTimeout(a)}},[eG]);let[eK,eQ]=(0,s.useState)("You are a marketing strategist, professional performance marketer, and market researcher. Using PRODUCT_INFO, generate exactly 3 distinct, high-converting angles for paid ads. Each angle must include: name (concise), big_idea (1 sentence), promise (benefit-focused), 6-10 headlines (≤12 words, specific, no emojis/ALL CAPS), and primaries with 2 variants: short (≤60 chars) and medium (≤120 chars). Avoid fluff; be concrete and conversion-oriented.\n\nReturn ONE valid json object ONLY with fields: angles[3] each with { name, big_idea, promise, headlines[6..10], primaries { short, medium } }."),[e$,e0]=(0,s.useState)('You are a senior direct‑response copywriter and conversion strategist. Using PRODUCT_INFO and ANGLE, write 8 unique, high‑converting ad headlines for Meta in three languages: English ("en"), Arabic Modern Standard ("ar"), and French ("fr"). Rules: ≤12 words each, concrete, specific, benefit‑led, no emojis, minimal punctuation, avoid spammy claims, no ALL CAPS.\n\nReturn ONE valid JSON object ONLY:\n{ "angles": [ { "headlines": { "en": ["h1","h2","h3","h4","h5","h6","h7","h8"], "ar": ["h1","h2","h3","h4","h5","h6","h7","h8"], "fr": ["h1","h2","h3","h4","h5","h6","h7","h8"] } } ] }'),[e1,e2]=(0,s.useState)('You are a senior direct‑response copywriter. Using PRODUCT_INFO and ANGLE, write 2 persuasive Meta primary texts per language that are multi‑line, include tasteful and relevant emojis, and maximize conversion with clear value, social proof (if implied), and a strong CTA. Each copy can be 2–4 short lines with line breaks. Provide English ("en"), Arabic Modern Standard ("ar"), and French ("fr").\n\nReturn ONE valid JSON object ONLY:\n{ "angles": [ { "primaries": { "en": ["...multi\nline\nA...", "...multi\nline\nB..."], "ar": ["...A AR...", "...B AR..."], "fr": ["...A FR...", "...B FR..."] } } ] }'),[e5,e3]=(0,s.useState)("Create a high‑quality ad image from this product photo. No text, premium look."),[e4,e6]=(0,s.useState)("You are a senior direct-response marketer. Analyze the landing page HTML to extract: title, benefits, pain_points, offers, emotions, and propose 3-5 marketing angles with headlines and primary texts. Respond only as compact JSON. Avoid prose."),[e8,e7]=(0,s.useState)(""),[e9,te]=(0,s.useState)([]),[tt,ta]=(0,s.useState)([]),[tn,ts]=(0,s.useState)([]),[ti,tl]=(0,s.useState)([]);function tr(e){let t=Date.now();"angles"===e&&te(e=>{var a;return[{version:((null===(a=e[0])||void 0===a?void 0:a.version)||0)+1,text:eK,savedAt:t},...e]}),"headlines"===e&&ta(e=>{var a;return[{version:((null===(a=e[0])||void 0===a?void 0:a.version)||0)+1,text:e$,savedAt:t},...e]}),"copies"===e&&ts(e=>{var a;return[{version:((null===(a=e[0])||void 0===a?void 0:a.version)||0)+1,text:e1,savedAt:t},...e]}),"gemini"===e&&tl(e=>{var a;return[{version:((null===(a=e[0])||void 0===a?void 0:a.version)||0)+1,text:e5,savedAt:t},...e]})}function to(e,t){if("angles"===e){let e=e9.find(e=>e.version===t);e&&eQ(e.text)}if("headlines"===e){let e=tt.find(e=>e.version===t);e&&e0(e.text)}if("copies"===e){let e=tn.find(e=>e.version===t);e&&e2(e.text)}if("gemini"===e){let e=ti.find(e=>e.version===t);e&&e3(e.text)}}(0,s.useEffect)(()=>{!function(){try{let e=localStorage.getItem("ptos_versions_angles");e&&te(JSON.parse(e))}catch(e){}try{let e=localStorage.getItem("ptos_versions_headlines");e&&ta(JSON.parse(e))}catch(e){}try{let e=localStorage.getItem("ptos_versions_copies");e&&ts(JSON.parse(e))}catch(e){}try{let e=localStorage.getItem("ptos_versions_gemini");e&&tl(JSON.parse(e))}catch(e){}}()},[]),(0,s.useEffect)(()=>{try{localStorage.setItem("ptos_versions_angles",JSON.stringify(e9||[]))}catch(e){}},[e9]),(0,s.useEffect)(()=>{try{localStorage.setItem("ptos_versions_headlines",JSON.stringify(tt||[]))}catch(e){}},[tt]),(0,s.useEffect)(()=>{try{localStorage.setItem("ptos_versions_copies",JSON.stringify(tn||[]))}catch(e){}},[tn]),(0,s.useEffect)(()=>{try{localStorage.setItem("ptos_versions_gemini",JSON.stringify(ti||[]))}catch(e){}},[ti]);let[td,tc]=(0,s.useState)("inputs"),[tp,tu]=(0,s.useState)(1),[tm,tg]=(0,s.useState)({x:0,y:0}),th=(0,s.useRef)(null),[tx,tv]=(0,s.useState)(null),tf=(0,s.useRef)(null),ty=(0,s.useRef)(null),[tj,t_]=(0,s.useState)(null);async function tN(){try{if(!F){alert("Enter landing page URL first.");return}eT(!0);let e=await (0,c.HX)({url:F,prompt:e4,model:eE});if(null==e?void 0:e.error)throw Error(e.error);"string"==typeof(null==e?void 0:e.prompt_used)&&e7(e.prompt_used),"string"!=typeof(null==e?void 0:e.title)||Y&&Y.trim()||(X(e.title),er(e=>({...e,title:"analyze_landing"})));let t=Array.isArray(null==e?void 0:e.benefits)?e.benefits:[];t.length>0&&(W(t.join("\n")),er(e=>({...e,benefits:"analyze_landing"})));let a=Array.isArray(null==e?void 0:e.pain_points)?e.pain_points:[];a.length>0&&(K(a.join("\n")),er(e=>({...e,pains:"analyze_landing"})));let n=Array.isArray(null==e?void 0:e.offers)?e.offers:[];n.length>0&&($(n.join("\n")),er(e=>({...e,offers:"analyze_landing"})));let s=Array.isArray(null==e?void 0:e.emotions)?e.emotions:[];s.length>0&&!ej&&e_(s[0]);let i=((Array.isArray(null==e?void 0:e.images)?e.images:[])||[]).filter(e=>"string"==typeof e&&e),l=i.slice(1),r=l.length>0?l:i;r.length>0&&(ei(r.slice(0,10)),ea||(en(r[0]),er(e=>({...e,sourceImage:"analyze_landing"}))));let o=Array.isArray(null==e?void 0:e.angles)?e.angles:[];o.length>0&&(em(o),eh(0)),alert("Analyzed landing page with AI. Prefilled inputs.")}catch(e){alert("Analyze failed: "+String((null==e?void 0:e.message)||e))}finally{eT(!1)}}(0,s.useEffect)(()=>{try{let s=sessionStorage.getItem("ptos_last_test_id");if(!s)return;let i=sessionStorage.getItem("flow_cache_".concat(s));if(i){var e,t,a,n;let s=JSON.parse(i||"{}");"string"==typeof(null==s?void 0:null===(e=s.settings)||void 0===e?void 0:e.saved_audience_id)&&eU(s.settings.saved_audience_id),Array.isArray(null==s?void 0:null===(t=s.settings)||void 0===t?void 0:t.countries)&&ez((s.settings.countries||[]).join(",")),"boolean"==typeof(null==s?void 0:null===(a=s.settings)||void 0===a?void 0:a.advantage_plus)&&eR(!!s.settings.advantage_plus),"string"==typeof(null==s?void 0:null===(n=s.settings)||void 0===n?void 0:n.model)&&eP(s.settings.model)}}catch(e){}},[]),(0,s.useEffect)(()=>{try{if(!e4){let e=localStorage.getItem("ptos_analyze_prompt_default");e&&e6(e)}}catch(e){}},[e4]),(0,s.useEffect)(()=>{try{let e=localStorage.getItem("ptos_ads_headlines_prompt");e&&e0(e)}catch(e){}try{let e=localStorage.getItem("ptos_ads_copies_prompt");e&&e2(e)}catch(e){}try{let e=localStorage.getItem("ptos_ads_gemini_prompt");e&&e3(e)}catch(e){}},[]),(0,s.useEffect)(()=>{try{localStorage.setItem("ptos_ads_headlines_prompt",e$)}catch(e){}},[e$]),(0,s.useEffect)(()=>{try{localStorage.setItem("ptos_ads_copies_prompt",e1)}catch(e){}},[e1]),(0,s.useEffect)(()=>{try{localStorage.setItem("ptos_ads_gemini_prompt",e5)}catch(e){}},[e5]),(0,s.useEffect)(()=>{try{sessionStorage.removeItem("ptos_transfer_landing")}catch(e){}},[]),(0,s.useEffect)(()=>{!eN&&ex.length>0&&eb(ex[0])},[ex,eN]);let tb=(0,s.useRef)(1),tw=()=>"a".concat(tb.current++),[tA,tS]=(0,s.useState)(()=>[{id:tw(),type:"landing",x:120,y:160,data:{url:"",image:"",title:""}}]),[tC,tI]=(0,s.useState)([]),tk=(0,s.useRef)([]);function tO(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0,s={id:tw(),type:e,x:n?n.x:t.x+300,y:n?n.y:t.y,data:a};return tS(e=>[...e,s]),s}function tR(e,t){tI(a=>a.some(a=>a.from===e.id&&a.to===t.id)?a:[...a,{id:tw(),from:e.id,fromPort:"out",to:t.id,toPort:"in"}])}function tE(){let e=tA.find(e=>"landing"===e.type)||tA[0],t=tA.find(e=>"angles"===e.type);if(t){tv(t.id);return}let a=tO("angles",e,{},{x:e.x+300,y:e.y});tR(e,a),tv(a.id)}function tP(e,t,a,n,s){let i=function(e){let t={...e},a=0;for(;function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{w:220,h:160};return tA.some(a=>{let n={x:e.x,y:e.y,w:t.w,h:t.h},s={x:a.x,y:a.y,w:220,h:160};return!(n.x+n.w<s.x||s.x+s.w<n.x||n.y+n.h<s.y||s.y+s.h<n.y)})}(t)&&a<50;)t.y+=200,a++;return t}({x:t.x+300,y:Math.round(t.y+(n-(s-1)/2)*180)}),l=tO(e,t,a,i);return tR(t,l),l}async function tM(e){try{var t,a,n;let s=tA.find(t=>t.id===e&&"headlines"===t.type);if(!s)return;tS(t=>t.map(t=>t.id===e?{...t,data:{...t.data,status:"running"}}:t)),eT(!0);let i=Date.now(),l=V.split("\n").map(e=>e.trim()).filter(Boolean),r=q.split("\n").map(e=>e.trim()).filter(Boolean),o=null===(t=s.data)||void 0===t?void 0:t.angle,d={audience:G,benefits:l,pain_points:r,title:Y},p=tJ(e$),u=o?"".concat(p,"\n\nPRODUCT_INFO: ").concat(JSON.stringify(d),"\nANGLE: ").concat(JSON.stringify(o)):"".concat(p,"\n\nPRODUCT_INFO: ").concat(JSON.stringify(d)),m=await (0,c.PN)({product:d,num_angles:1,prompt:u||void 0,model:eE}),g=(Array.isArray(null==m?void 0:m.angles)?m.angles:[])[0]||{},h=[],x=[],v=[];try{Array.isArray(g.headlines_en)&&(h=g.headlines_en),Array.isArray(g.headlines_fr)&&(x=g.headlines_fr),Array.isArray(g.headlines_ar)&&(v=g.headlines_ar);let e=g.headlines;h.length&&x.length&&v.length||(e&&"object"==typeof e?(!h.length&&Array.isArray(e.en)&&(h=e.en),!x.length&&Array.isArray(e.fr)&&(x=e.fr),!v.length&&Array.isArray(e.ar)&&(v=e.ar)):!Array.isArray(g.headlines)||h.length||(h=g.headlines))}catch(e){}let f=tP("headlines_out",s,{headlines_en:(h||[]).slice(0,8),headlines_fr:(x||[]).slice(0,8),headlines_ar:(v||[]).slice(0,8),headlines:(h||[]).slice(0,8),angleId:(null===(a=s.data)||void 0===a?void 0:a.angleId)||s.id},0,1),y=String((null===(n=s.data)||void 0===n?void 0:n.angleId)||s.id),j=tA.find(e=>{var t;return"meta_ad"===e.type&&(null===(t=e.data)||void 0===t?void 0:t.angleId)===y});j&&tR(f,j);let _=Date.now();tS(t=>t.map(t=>{var a;return t.id===e?{...t,data:{...t.data,status:"done",meta:{...(null===(a=t.data)||void 0===a?void 0:a.meta)||{},lastRun:{nodeType:"headlines",startedAt:i,finishedAt:_,durationMs:_-i,model:"default (server)",promptUsed:u,inputSnapshot:{audience:G,benefits:l,pain_points:r,title:Y,angle:o},inputSources:el,outputSnapshot:{headlines_en:(h||[]).slice(0,8),headlines_fr:(x||[]).slice(0,8),headlines_ar:(v||[]).slice(0,8)},logs:[]}}}}:t}))}catch(e){alert("Generate failed: "+String((null==e?void 0:e.message)||e))}finally{eT(!1)}}async function tz(e){try{var t,a,n,s,i,l;let r=tA.find(t=>t.id===e&&"copies"===t.type);if(!r)return;tS(t=>t.map(t=>t.id===e?{...t,data:{...t.data,status:"running"}}:t)),eT(!0);let o=Date.now(),d=V.split("\n").map(e=>e.trim()).filter(Boolean),p=q.split("\n").map(e=>e.trim()).filter(Boolean),u=null===(t=r.data)||void 0===t?void 0:t.angle,m={audience:G,benefits:d,pain_points:p,title:Y},g=tJ(e1),h=u?"".concat(g,"\n\nPRODUCT_INFO: ").concat(JSON.stringify(m),"\nANGLE: ").concat(JSON.stringify(u)):"".concat(g,"\n\nPRODUCT_INFO: ").concat(JSON.stringify(m)),x=await (0,c.PN)({product:m,num_angles:1,prompt:h||void 0,model:eE}),v=(Array.isArray(null==x?void 0:x.angles)?x.angles:[])[0]||{},f=[];try{let e=v.primaries;Array.isArray(e)?f=e:e&&"object"==typeof e&&(f=[e.short,e.medium,e.long].filter(e=>"string"==typeof e&&e))}catch(e){}let y=[],j=[],_=[];try{Array.isArray(v.primaries_en)&&(y=v.primaries_en),Array.isArray(v.primaries_fr)&&(j=v.primaries_fr),Array.isArray(v.primaries_ar)&&(_=v.primaries_ar);let e=v.primaries;e&&"object"==typeof e&&!Array.isArray(e)&&(!y.length&&Array.isArray(e.en)&&(y=e.en),!j.length&&Array.isArray(e.fr)&&(j=e.fr),!_.length&&Array.isArray(e.ar)&&(_=e.ar)),!y.length&&Array.isArray(v.primaries)&&(y=v.primaries),y.length||(y=f)}catch(e){}let N=tP("copies_out",r,{primaries_en:(y||[]).slice(0,2),primaries_fr:(j||[]).slice(0,2),primaries_ar:(_||[]).slice(0,2),primaries:(y||[]).slice(0,2),angleId:(null===(a=r.data)||void 0===a?void 0:a.angleId)||r.id},0,1),b=(i=String((null===(n=r.data)||void 0===n?void 0:n.angleId)||r.id),l=r,tA.find(e=>{var t;return"meta_ad"===e.type&&(null===(t=e.data)||void 0===t?void 0:t.angleId)===i})||tO("meta_ad",l,{angleId:i},{x:l.x+300,y:l.y+300}));tR(N,b);let w=String((null===(s=r.data)||void 0===s?void 0:s.angleId)||r.id);for(let e of tA.filter(e=>{var t;return("headlines_out"===e.type||"images_out"===e.type)&&(null===(t=e.data)||void 0===t?void 0:t.angleId)===w}))tR(e,b);let A=Date.now();tS(t=>t.map(t=>{var a;return t.id===e?{...t,data:{...t.data,status:"done",meta:{...(null===(a=t.data)||void 0===a?void 0:a.meta)||{},lastRun:{nodeType:"copies",startedAt:o,finishedAt:A,durationMs:A-o,model:"default (server)",promptUsed:h,inputSnapshot:{audience:G,benefits:d,pain_points:p,title:Y,angle:u},inputSources:el,outputSnapshot:{primaries_en:(y||[]).slice(0,2),primaries_fr:(j||[]).slice(0,2),primaries_ar:(_||[]).slice(0,2)},logs:[]}}}}:t}))}catch(e){alert("Generate failed: "+String((null==e?void 0:e.message)||e))}finally{eT(!1)}}async function tL(e){try{var t,a,n,s;let i=tA.find(t=>t.id===e&&"gemini_images"===t.type);if(!i)return;tS(t=>t.map(t=>t.id===e?{...t,data:{...t.data,status:"running"}}:t));let l=(null===(t=i.data)||void 0===t?void 0:t.from)||ea||es[1]||es[0];if(!l){alert("Missing source image URL");return}eT(!0);let r=Date.now(),o=(Q||"").trim(),d=null===(a=i.data)||void 0===a?void 0:a.angle,p=d&&d.name?" Angle: ".concat(String(d.name)):"",u=tJ(e5||"Create a high‑quality ad image from this product photo. No text, premium look."),m="".concat(u).concat(o?" Emphasize the offer/promotion: ".concat(o,"."):"").concat(p),g=await (0,c.oB)({image_url:l,prompt:m,num_images:4,neutral_background:!0}),h=[];try{let e=g||{};Array.isArray(e.images)?h=e.images:Array.isArray(e.urls)?h=e.urls:Array.isArray(e.items)&&(h=e.items.map(e=>(null==e?void 0:e.image)||(null==e?void 0:e.url)).filter(e=>"string"==typeof e&&e))}catch(e){}ev(h);let x=tP("images_out",i,{images:h.slice(0,4),angleId:(null===(n=i.data)||void 0===n?void 0:n.angleId)||i.id},0,1),v=String((null===(s=i.data)||void 0===s?void 0:s.angleId)||i.id),f=tA.find(e=>{var t;return"meta_ad"===e.type&&(null===(t=e.data)||void 0===t?void 0:t.angleId)===v});f&&tR(x,f);let y=Date.now();tS(t=>t.map(t=>{var a;return t.id===e?{...t,data:{...t.data,status:"done",meta:{...(null===(a=t.data)||void 0===a?void 0:a.meta)||{},lastRun:{nodeType:"gemini_images",startedAt:r,finishedAt:y,durationMs:y-r,model:"Gemini (server default)",promptUsed:m,inputSnapshot:{image_url:l,offers:o,angle:d},inputSources:el,outputSnapshot:{images:h.slice(0,4)},logs:[]}}}}:t}))}catch(e){alert("Image gen failed: "+String((null==e?void 0:e.message)||e))}finally{eT(!1)}}async function tU(){try{eT(!0);let e=Date.now(),t={audience:G,benefits:V.split("\n").map(e=>e.trim()).filter(Boolean),pain_points:q.split("\n").map(e=>e.trim()).filter(Boolean),title:Y||void 0},a=await (0,c.PN)({product:t,num_angles:3,prompt:eK||void 0,model:eE}),n=Array.isArray(null==a?void 0:a.angles)?a.angles:[];em(n);let s=tA.find(e=>"landing"===e.type)||tA[0],i=tA.find(e=>"angles"===e.type)||tO("angles",s,{},{x:s.x+300,y:s.y});tR(s,i);let l=Math.min(3,Math.max(0,n.length||3));for(let e=0;e<l;e++){let t=n[e]||{name:"Angle ".concat(e+1)};tP("angle_variant",i,{angle:t,angleIndex:e},e,l)}let r=Date.now();tS(a=>a.map(a=>{var s;return a.id===i.id?{...a,data:{...a.data,meta:{...(null===(s=a.data)||void 0===s?void 0:s.meta)||{},lastRun:{nodeType:"angles",startedAt:e,finishedAt:r,durationMs:r-e,model:"default (server)",promptUsed:eK,inputSnapshot:t,inputSources:el,outputSnapshot:{angles:n.slice(0,3)},logs:[]}}}}:a}))}catch(e){alert("Angles generation failed: "+String((null==e?void 0:e.message)||e))}finally{eT(!1)}}async function tD(e){let t=tA.find(t=>t.id===e);if(!t)return;let a=(t.data||{}).angle||{},n=t.id;tP("headlines",t,{angle:a,angleId:n,angleIndex:(t.data||{}).angleIndex},0,3),tP("copies",t,{angle:a,angleId:n,angleIndex:(t.data||{}).angleIndex},1,3),tP("gemini_images",t,{from:ea||es[0]||"",angle:a,angleId:n,angleIndex:(t.data||{}).angleIndex},2,3)}async function tZ(){try{var e,t,a,n;if(!ea){alert("Missing source image URL");return}eT(!0);let s=(Q||"").trim(),i=tJ(e5||"Create a high‑quality ad image from this product photo. No text, premium look."),l="".concat(i).concat(s?" Emphasize the offer/promotion: ".concat(s,"."):""),r=await (0,c.oB)({image_url:ea,prompt:l,num_images:4,neutral_background:!0}),o=[];try{let e=r||{};Array.isArray(e.images)?o=e.images:Array.isArray(e.urls)?o=e.urls:Array.isArray(e.items)&&(o=e.items.map(e=>(null==e?void 0:e.image)||(null==e?void 0:e.url)).filter(e=>"string"==typeof e&&e))}catch(e){}ev(o);let d=tA.find(e=>"landing"===e.type)||tA[0],p=(e="gemini_images",t=d,a=0,n=0,tA.find(t=>t.type===e)||tP(e,t,{},2,3)),u=tP("images_out",p,{images:o},0,1),m=tA.find(e=>"meta_ad"===e.type)||tO("meta_ad",p,{},{x:p.x+300,y:p.y+300});tR(u,m)}catch(e){alert("Image gen failed: "+String((null==e?void 0:e.message)||e))}finally{eT(!1)}}async function tB(){try{let e;if(!F||!ef||!ej){alert("Select headline, primary text, and landing URL.");return}try{let e=new URL(F);if(!("http:"===e.protocol||"https:"===e.protocol))throw Error("Invalid scheme")}catch(e){alert("Landing URL must be a valid http(s) URL.");return}let t=Array.from(new Set(ew.filter(e=>"string"==typeof e&&e)));if(t.length>=2)for(let e of t)try{let t=new URL(e);if(!("http:"===t.protocol||"https:"===t.protocol))throw Error("Invalid scheme")}catch(e){alert("All selected carousel image URLs must be valid http(s).");return}else{if(!eN){alert("Select an image or choose 2+ images for carousel.");return}try{let e=new URL(eN);if(!("http:"===e.protocol||"https:"===e.protocol))throw Error("Invalid scheme")}catch(e){alert("Image URL must be a valid public http(s) URL.");return}}eT(!0);let a={};if(!eO&&(eL?a.saved_audience_id=eL:eM&&(a.targeting={geo_locations:{countries:eM.split(",").map(e=>e.trim().toUpperCase()).filter(Boolean)}})),t.length>=2){let n=t.map(e=>({image_url:e,headline:ef,description:"",link:F,call_to_action:eS})),s={primary_text:ej,landing_url:F,cards:n,call_to_action:eS,adset_budget:eI,title:ef,...a.saved_audience_id?{saved_audience_id:a.saved_audience_id}:{},...a.targeting?{targeting:a.targeting}:{}};e=await (0,c.sj)(s)}else{let t={headline:ef,primary_text:ej,description:"",image_url:eN,landing_url:F,call_to_action:eS,adset_budget:eI,title:ef,...a.saved_audience_id?{saved_audience_id:a.saved_audience_id}:{},...a.targeting?{targeting:a.targeting}:{}};e=await (0,c.dP)(t)}if(null==e?void 0:e.error)throw Error(e.error);alert("Meta draft created successfully.")}catch(e){alert("Meta draft failed: "+String((null==e?void 0:e.message)||e))}finally{eT(!1)}}(0,s.useEffect)(()=>{tk.current=tA},[tA]),(0,s.useEffect)(()=>{tS(e=>e.map(e=>"landing"===e.type?{...e,data:{...e.data,url:F,image:F&&(es||[])[0]?(es||[])[0]:e.data.image,title:Y}}:e))},[F,es,Y]),(0,s.useEffect)(()=>{let e;if(B)return e&&clearTimeout(e),e=setTimeout(async()=>{try{let e={audience:G,benefits:V.split("\n").filter(Boolean),pain_points:q.split("\n").filter(Boolean),title:Y||void 0};await (0,c.XD)(B,{product:e,ads:{selectedHeadline:ef,selectedPrimary:ej,selectedImage:eN,cta:eS,budget:eI,advantagePlus:eO,countries:eM,savedAudienceId:eL,candidateImages:es,adImages:ex},prompts:{analyze_landing_prompt:e4,headlines_prompt:e$,copies_prompt:e1,gemini_ad_prompt:e5},ui:{zoom:tp,pan:tm,selected_node:tx,active_left_tab:td},flow:{nodes:tA,edges:tC}});try{localStorage.setItem("ptos_analyze_prompt_default",e4)}catch(e){}}catch(e){}},800),()=>{e&&clearTimeout(e)}},[B,ef,ej,eN,eS,eI,eO,eM,eL,es,ex,G,V,q,Y,e4,e$,e1,e5,tA,tC,tp,tm,tx,td,eE]);let tT=eu[eg]||null;(0,s.useMemo)(()=>{let e=null==tT?void 0:tT.headlines;return Array.isArray(e)?e:e&&"object"==typeof e&&Array.isArray(e.en)?e.en:[]},[tT]),(0,s.useMemo)(()=>{let e=null==tT?void 0:tT.primaries;if(Array.isArray(e))return e;if(e&&"object"==typeof e){if(Array.isArray(e.en))return e.en;let t=[e.short,e.medium,e.long].filter(e=>"string"==typeof e&&e);if(t.length)return t}return[]},[tT]);let tF=(0,s.useMemo)(()=>tA.find(e=>e.id===tx)||null,[tA,tx]);function tJ(e){let t=V.split("\n").map(e=>e.trim()).filter(Boolean),a=q.split("\n").map(e=>e.trim()).filter(Boolean);return String(e||"").replaceAll("{audience}",G||"").replaceAll("{benefits}",JSON.stringify(t)).replaceAll("{pain_points}",JSON.stringify(a)).replaceAll("{title}",Y||"").replaceAll("{offers}",Q||"").replaceAll("{emotions}",ee||"")}return(0,n.jsxs)("div",{className:"min-h-screen w-full bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-sky-50 via-white to-indigo-50 text-slate-800",children:[(0,n.jsxs)("header",{className:"h-16 px-4 md:px-6 flex items-center justify-between border-b bg-white/70 backdrop-blur sticky top-0 z-50",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)(r.Z,{className:"w-6 h-6 text-blue-600"}),(0,n.jsx)("h1",{className:"font-semibold text-lg",children:"Product Testing OS"}),(0,n.jsxs)("nav",{className:"ml-4 flex items-center gap-1 text-sm",children:[(0,n.jsx)(l.default,{href:"/studio/",className:"px-3 py-1.5 rounded hover:bg-slate-100",children:"Create Product"}),(0,n.jsx)("span",{className:"px-3 py-1.5 rounded bg-blue-600 text-white",children:"Create Ads"}),(0,n.jsx)(l.default,{href:"/promotion/",className:"px-3 py-1.5 rounded hover:bg-slate-100",children:"Create Promotion"})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,n.jsx)(l.default,{href:"/",className:"rounded-xl font-semibold inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white",children:"Home"}),(0,n.jsxs)("label",{className:"flex items-center gap-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:eF,onChange:async e=>{let t=e.target.checked;eJ(t),t&&await eW()}}),(0,n.jsx)("span",{children:"Auto-run"})]})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-12 gap-3 p-3 h-[calc(100vh-4rem)]",children:[(0,n.jsxs)("aside",{className:"col-span-12 md:col-span-3 space-y-3 overflow-y-auto pb-24",children:[(0,n.jsxs)(m,{children:[(0,n.jsx)(g,{className:"pb-2",children:(0,n.jsx)(h,{className:"text-base",children:"LLM model"})}),(0,n.jsx)(x,{children:(0,n.jsx)("div",{children:(0,n.jsxs)("select",{value:eE,onChange:e=>eP(e.target.value),className:"w-full rounded-xl border px-3 py-2 text-sm",children:[(0,n.jsx)("option",{value:"gpt-4o-mini",children:"gpt-4o-mini"}),(0,n.jsx)("option",{value:"gpt-4.1",children:"gpt-4.1"}),(0,n.jsx)("option",{value:"gpt-4a",children:"chatgpt-4a"}),(0,n.jsx)("option",{value:"gpt-5",children:"gpt-5"})]})})})]}),(0,n.jsx)(m,{children:(0,n.jsx)(g,{className:"pb-2",children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{className:"text-sm px-3 py-1.5 rounded ".concat("inputs"===td?"bg-blue-600 text-white":"border"),onClick:()=>tc("inputs"),children:"Inputs"}),(0,n.jsx)("button",{className:"text-sm px-3 py-1.5 rounded ".concat("prompts"===td?"bg-blue-600 text-white":"border"),onClick:()=>tc("prompts"),children:"Prompts"})]})})}),tF&&(0,n.jsxs)(m,{children:[(0,n.jsx)(g,{className:"pb-2",children:(0,n.jsx)(h,{className:"text-base",children:"Selected Card Details"})}),(0,n.jsxs)(x,{className:"space-y-2 text-xs",children:["angle_variant"===tF.type&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"text-slate-500",children:"Angle"}),(0,n.jsx)("div",{className:"font-medium",children:String((null===(t=tF.data)||void 0===t?void 0:null===(e=t.angle)||void 0===e?void 0:e.name)||"")}),(0,n.jsxs)("div",{children:["Big idea: ",String((null===(j=tF.data)||void 0===j?void 0:null===(a=j.angle)||void 0===a?void 0:a.big_idea)||"")]}),(0,n.jsxs)("div",{children:["Promise: ",String((null===(w=tF.data)||void 0===w?void 0:null===(b=w.angle)||void 0===b?void 0:b.promise)||"")]}),(()=>{var e,t;let a=null===(t=tF.data)||void 0===t?void 0:null===(e=t.angle)||void 0===e?void 0:e.headlines,n=Array.isArray(a)?a:a&&"object"==typeof a&&Array.isArray(a.en)?a.en:[];return Array.isArray(n)&&n.length>0})()&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-slate-500",children:"Headlines"}),(0,n.jsx)("ul",{className:"list-disc pl-4",children:(()=>{var e,t;let a=null===(t=tF.data)||void 0===t?void 0:null===(e=t.angle)||void 0===e?void 0:e.headlines;return(Array.isArray(a)?a:a&&"object"==typeof a&&Array.isArray(a.en)?a.en:[]).slice(0,8)})().map((e,t)=>(0,n.jsx)("li",{children:e},t))})]}),(()=>{var e;let t=tA.find(e=>"angles"===e.type),a=((null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.meta)||{}).lastRun;return a?(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("div",{className:"text-slate-500",children:"Generated by"}),(0,n.jsxs)("div",{children:["Model: ",a.model||"default"]}),(0,n.jsxs)("div",{children:["Duration: ",a.durationMs," ms"]}),(0,n.jsx)("div",{children:"Prompt used:"}),(0,n.jsx)("pre",{className:"bg-slate-50 border rounded p-2 whitespace-pre-wrap max-h-24 overflow-auto",children:a.promptUsed||""})]}):null})()]}),"headlines"===tF.type&&(()=>{var e,t,a;let s=((null===(e=tF.data)||void 0===e?void 0:e.meta)||{}).lastRun,i=V.split("\n").map(e=>e.trim()).filter(Boolean),l=q.split("\n").map(e=>e.trim()).filter(Boolean),r={audience:G,benefits:i,pain_points:l,title:Y},o=tJ(e$),d=null===(t=tF.data)||void 0===t?void 0:t.angle,c=d?"".concat(o,"\n\nPRODUCT_INFO: ").concat(JSON.stringify(r),"\nANGLE: ").concat(JSON.stringify(d)):"".concat(o,"\n\nPRODUCT_INFO: ").concat(JSON.stringify(r));return(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("div",{className:"text-slate-500",children:"Prompt"}),(0,n.jsx)("pre",{className:"bg-slate-50 border rounded p-2 whitespace-pre-wrap max-h-24 overflow-auto",children:e$}),(0,n.jsx)("div",{className:"text-slate-500",children:"Expanded preview"}),(0,n.jsx)("pre",{className:"bg-slate-50 border rounded p-2 whitespace-pre-wrap max-h-24 overflow-auto",children:o}),(0,n.jsx)("div",{className:"text-slate-500",children:"Variables used"}),(0,n.jsxs)("div",{className:"text-xs grid grid-cols-2 gap-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-slate-500",children:"Audience:"})," ",G||"-"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-slate-500",children:"Title:"})," ",Y||"-"]}),(0,n.jsxs)("div",{className:"col-span-2",children:[(0,n.jsx)("span",{className:"text-slate-500",children:"Benefits:"})," ",i.join(" | ")||"-"]}),(0,n.jsxs)("div",{className:"col-span-2",children:[(0,n.jsx)("span",{className:"text-slate-500",children:"Pain points:"})," ",l.join(" | ")||"-"]})]}),(0,n.jsx)("div",{className:"text-slate-500",children:"Exact prompt next run"}),(0,n.jsx)("pre",{className:"bg-slate-50 border rounded p-2 whitespace-pre-wrap max-h-24 overflow-auto",children:c}),s&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"text-slate-500",children:"Last output"}),(0,n.jsx)("ul",{className:"list-disc pl-4",children:((null===(a=s.outputSnapshot)||void 0===a?void 0:a.headlines_en)||[]).map((e,t)=>(0,n.jsx)("li",{children:e},t))})]})]})})(),"headlines_out"===tF.type&&(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("div",{className:"text-slate-500",children:"Headlines"}),(0,n.jsx)("ul",{className:"list-disc pl-4",children:(Array.isArray(null===(A=tF.data)||void 0===A?void 0:A.headlines_en)?tF.data.headlines_en:(null===(S=tF.data)||void 0===S?void 0:S.headlines)||[]).slice(0,12).map((e,t)=>(0,n.jsx)("li",{children:e},t))})]}),"copies"===tF.type&&(()=>{var e,t,a;let s=((null===(e=tF.data)||void 0===e?void 0:e.meta)||{}).lastRun,i=V.split("\n").map(e=>e.trim()).filter(Boolean),l=q.split("\n").map(e=>e.trim()).filter(Boolean),r={audience:G,benefits:i,pain_points:l,title:Y},o=tJ(e1),d=null===(t=tF.data)||void 0===t?void 0:t.angle,c=d?"".concat(o,"\n\nPRODUCT_INFO: ").concat(JSON.stringify(r),"\nANGLE: ").concat(JSON.stringify(d)):"".concat(o,"\n\nPRODUCT_INFO: ").concat(JSON.stringify(r));return(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("div",{className:"text-slate-500",children:"Prompt"}),(0,n.jsx)("pre",{className:"bg-slate-50 border rounded p-2 whitespace-pre-wrap max-h-24 overflow-auto",children:e1}),(0,n.jsx)("div",{className:"text-slate-500",children:"Expanded preview"}),(0,n.jsx)("pre",{className:"bg-slate-50 border rounded p-2 whitespace-pre-wrap max-h-24 overflow-auto",children:o}),(0,n.jsx)("div",{className:"text-slate-500",children:"Variables used"}),(0,n.jsxs)("div",{className:"text-xs grid grid-cols-2 gap-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-slate-500",children:"Audience:"})," ",G||"-"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-slate-500",children:"Title:"})," ",Y||"-"]}),(0,n.jsxs)("div",{className:"col-span-2",children:[(0,n.jsx)("span",{className:"text-slate-500",children:"Benefits:"})," ",i.join(" | ")||"-"]}),(0,n.jsxs)("div",{className:"col-span-2",children:[(0,n.jsx)("span",{className:"text-slate-500",children:"Pain points:"})," ",l.join(" | ")||"-"]})]}),(0,n.jsx)("div",{className:"text-slate-500",children:"Exact prompt next run"}),(0,n.jsx)("pre",{className:"bg-slate-50 border rounded p-2 whitespace-pre-wrap max-h-24 overflow-auto",children:c}),s&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"text-slate-500",children:"Last output"}),(0,n.jsx)("ul",{className:"list-disc pl-4",children:((null===(a=s.outputSnapshot)||void 0===a?void 0:a.primaries_en)||[]).map((e,t)=>(0,n.jsx)("li",{children:(0,n.jsx)("span",{className:"whitespace-pre-line",children:e})},t))})]})]})})(),"copies_out"===tF.type&&(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("div",{className:"text-slate-500",children:"Primary texts"}),(0,n.jsx)("ul",{className:"list-disc pl-4",children:(Array.isArray(null===(C=tF.data)||void 0===C?void 0:C.primaries_en)?tF.data.primaries_en:(null===(I=tF.data)||void 0===I?void 0:I.primaries)||[]).slice(0,12).map((e,t)=>(0,n.jsx)("li",{children:(0,n.jsx)("span",{className:"whitespace-pre-line",children:e})},t))})]}),"gemini_images"===tF.type&&(()=>{var e,t,a,s;let i=((null===(e=tF.data)||void 0===e?void 0:e.meta)||{}).lastRun;V.split("\n").map(e=>e.trim()).filter(Boolean),q.split("\n").map(e=>e.trim()).filter(Boolean);let l=tJ(e5),r=null===(t=tF.data)||void 0===t?void 0:t.angle,o=r&&r.name?" Angle: ".concat(String(r.name)):"",d="".concat(l).concat(Q?" Emphasize the offer/promotion: ".concat(Q,"."):"").concat(o);return(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("div",{className:"text-slate-500",children:"Prompt"}),(0,n.jsx)("pre",{className:"bg-slate-50 border rounded p-2 whitespace-pre-wrap max-h-24 overflow-auto",children:e5}),(0,n.jsx)("div",{className:"text-slate-500",children:"Expanded preview"}),(0,n.jsx)("pre",{className:"bg-slate-50 border rounded p-2 whitespace-pre-wrap max-h-24 overflow-auto",children:l}),(0,n.jsx)("div",{className:"text-slate-500",children:"Variables used"}),(0,n.jsxs)("div",{className:"text-xs grid grid-cols-2 gap-2",children:[(0,n.jsxs)("div",{className:"col-span-2",children:[(0,n.jsx)("span",{className:"text-slate-500",children:"Offers:"})," ",Q||"-"]}),(0,n.jsxs)("div",{className:"col-span-2",children:[(0,n.jsx)("span",{className:"text-slate-500",children:"Emotions:"})," ",ee||"-"]})]}),(0,n.jsx)("div",{className:"text-slate-500",children:"Exact prompt next run"}),(0,n.jsx)("pre",{className:"bg-slate-50 border rounded p-2 whitespace-pre-wrap max-h-24 overflow-auto",children:d}),i&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:["Source image: ",String((null===(a=i.inputSnapshot)||void 0===a?void 0:a.image_url)||"")]}),(0,n.jsx)("div",{className:"text-slate-500",children:"Last images"}),(0,n.jsx)("div",{className:"grid grid-cols-2 gap-2",children:((null===(s=i.outputSnapshot)||void 0===s?void 0:s.images)||[]).map((e,t)=>(0,n.jsx)("img",{src:ed(e),alt:"img-".concat(t),className:"w-full h-20 object-cover rounded border"},t))})]})]})})(),"images_out"===tF.type&&(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("div",{className:"text-slate-500",children:"Images"}),(0,n.jsx)("div",{className:"grid grid-cols-2 gap-2",children:((null===(k=tF.data)||void 0===k?void 0:k.images)||[]).slice(0,8).map((e,t)=>(0,n.jsx)("img",{src:ed(e),alt:"img-".concat(t),className:"w-full h-20 object-cover rounded border"},t))})]})]})]}),"inputs"===td&&(0,n.jsxs)(m,{children:[(0,n.jsx)(g,{className:"pb-2",children:(0,n.jsxs)(h,{className:"text-base flex items-center gap-2",children:[(0,n.jsx)(o,{className:"w-4 h-4"}),"Ad inputs"]})}),(0,n.jsxs)(x,{className:"space-y-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Landing page URL"}),(0,n.jsx)(v,{value:F,onChange:e=>J(e.target.value),placeholder:"https://yourstore.com/pages/offer"}),(0,n.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,n.jsx)(u,{size:"sm",variant:"outline",onClick:tN,children:"Analyze"}),(0,n.jsx)(u,{size:"sm",onClick:tE,children:"Create Ad"})]}),(0,n.jsxs)("div",{className:"mt-2",children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Analyze prompt"}),(0,n.jsx)(f,{rows:4,value:e4,onChange:e=>e6(e.target.value)}),e8&&(0,n.jsxs)("div",{className:"text-[11px] text-slate-500 mt-1",children:["Prompt used (last): ",e8.slice(0,160),e8.length>160?"…":""]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Audience"}),(0,n.jsx)(v,{value:G,onChange:e=>{H(e.target.value),er(e=>({...e,audience:"manual"}))},placeholder:"Shoppers likely to buy this product"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Product title"}),(0,n.jsx)(v,{value:Y,onChange:e=>{X(e.target.value),er(e=>({...e,title:"manual"}))},placeholder:"Product title"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Key benefits (one per line)"}),(0,n.jsx)(f,{rows:3,value:V,onChange:e=>{W(e.target.value),er(e=>({...e,benefits:"manual"}))}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Pain points (one per line)"}),(0,n.jsx)(f,{rows:3,value:q,onChange:e=>{K(e.target.value),er(e=>({...e,pains:"manual"}))}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Offers / Promotions"}),(0,n.jsx)(f,{rows:2,value:Q,onChange:e=>{$(e.target.value),er(e=>({...e,offers:"manual"}))},placeholder:"E.g., -20%, Free shipping, Bundle"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Emotional triggers"}),(0,n.jsx)(f,{rows:2,value:ee,onChange:e=>{et(e.target.value),er(e=>({...e,emotions:"manual"}))},placeholder:"Trust, novelty, safety, time-saving"})]}),(0,n.jsx)(y,{}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Source image for ad"}),(0,n.jsx)(v,{value:ea,onChange:e=>{en(e.target.value),er(e=>({...e,sourceImage:"manual"}))},placeholder:"https://cdn.shopify.com/...jpg"}),es.length>0&&(0,n.jsx)("div",{className:"mt-2 grid grid-cols-3 gap-2",children:es.slice(0,9).map((e,t)=>(0,n.jsxs)("div",{className:"relative border rounded overflow-hidden ".concat(e===ea?"ring-2 ring-blue-500":"ring-1 ring-slate-200"),children:[(0,n.jsx)("button",{className:"absolute top-1 right-1 z-10 bg-white/90 hover:bg-white text-slate-700 rounded px-1 text-xs",onClick:a=>{a.preventDefault(),a.stopPropagation(),ei(e=>e.filter((e,a)=>a!==t)),ea===e&&en("")},children:"Delete"}),(0,n.jsx)("button",{className:"block w-full",onClick:()=>{en(e),er(e=>({...e,sourceImage:"manual"}))},children:(0,n.jsx)("img",{src:ed(e),alt:"img-".concat(t),className:"w-full h-20 object-cover"})})]},t))}),(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsx)(u,{size:"sm",variant:"outline",onClick:async()=>{await tN()},children:"Analyze"})})]})]})]}),"prompts"===td&&(0,n.jsxs)(m,{children:[(0,n.jsx)(g,{className:"pb-2",children:(0,n.jsx)(h,{className:"text-base",children:"Prompts"})}),(0,n.jsxs)(x,{className:"space-y-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Angles prompt"}),(0,n.jsx)(f,{rows:4,value:eK,onChange:e=>eQ(e.target.value)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Headlines prompt"}),(0,n.jsx)(f,{rows:4,value:e$,onChange:e=>e0(e.target.value)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Ad copies prompt"}),(0,n.jsx)(f,{rows:4,value:e1,onChange:e=>e2(e.target.value)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Gemini ad image prompt"}),(0,n.jsx)(f,{rows:3,value:e5,onChange:e=>e3(e.target.value)})]})]})]})]}),(0,n.jsxs)("section",{className:"col-span-12 md:col-span-6 relative",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between px-2 py-1",children:[(0,n.jsx)("div",{className:"text-sm text-slate-500",children:"Flow canvas"}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"text-xs text-slate-500",children:"Zoom"}),(0,n.jsx)("input",{type:"range",min:50,max:140,step:10,value:100*tp,onChange:e=>tu(Number(e.target.value)/100),className:"w-40"}),(0,n.jsx)(u,{size:"sm",variant:"outline",onClick:tU,disabled:eB,children:"Generate angles"})]})]}),(0,n.jsx)(y,{className:"mb-2"}),(0,n.jsxs)("div",{ref:th,className:"relative h-[calc(100%-3rem)] bg-white rounded-2xl shadow-inner overflow-auto border",onWheel:e=>{e.ctrlKey&&e.preventDefault()},onMouseDown:e=>{e.target.closest(".node-card")||(ty.current={startX:e.clientX,startY:e.clientY,panStartX:tm.x,panStartY:tm.y})},onMouseUp:()=>{tf.current=null,ty.current=null},onMouseMove:e=>{if(tf.current){let{id:t,startX:a,startY:n,nodeStartX:s,nodeStartY:i}=tf.current,l=(e.clientX-a)/tp,r=(e.clientY-n)/tp;tS(e=>e.map(e=>e.id===t?{...e,x:Math.round(s+l),y:Math.round(i+r)}:e));return}if(ty.current){let{startX:t,startY:a,panStartX:n,panStartY:s}=ty.current;tg({x:n+(e.clientX-t),y:s+(e.clientY-a)})}},onContextMenu:e=>e.preventDefault(),children:[(0,n.jsx)(_,{}),(0,n.jsxs)("div",{className:"absolute left-0 top-0 origin-top-left",style:{transform:"translate(".concat(tm.x,"px, ").concat(tm.y,"px) scale(").concat(tp,")"),transformOrigin:"0 0",willChange:"transform"},children:[(0,n.jsx)("div",{className:"relative z-0",children:tC.map(e=>(0,n.jsx)(N,{edge:e,nodes:tA,active:function(e){if(!tj)return!1;let t=String(tj.step||"");if("generate_angles"===t){let t=tA.find(t=>t.id===e.from),a=tA.find(t=>t.id===e.to);return!!(t&&a&&"landing"===t.type&&"angles"===a.type)}let a=Number(tj.angle_index);if(Number.isNaN(a))return!1;let n=tA.find(t=>t.id===e.from),s=tA.find(t=>t.id===e.to);return!!n&&!!s&&"angle_variant"===n.type&&Number((n.data||{}).angleIndex)===a&&("generate_headlines"===t&&"headlines"===s.type||"generate_copies"===t&&"copies"===s.type||"generate_images"===t&&"gemini_images"===s.type)}(e)},e.id))}),(0,n.jsx)("div",{className:"relative z-10",children:tA.map(e=>{var t,a,s,i;return(0,n.jsxs)("div",{className:"node-card absolute select-none ".concat(tx===e.id?"ring-2 ring-blue-500":"ring-1 ring-slate-200"," rounded-2xl bg-white border shadow w-[220px]"),style:{left:e.x,top:e.y},onMouseDown:t=>{t.stopPropagation(),tv(e.id),tf.current={id:e.id,startX:t.clientX,startY:t.clientY,nodeStartX:e.x,nodeStartY:e.y}},children:[(0,n.jsxs)("div",{className:"px-3 py-2 flex items-center justify-between",children:[(0,n.jsx)("div",{className:"text-xs font-semibold text-slate-700",children:"landing"===e.type?"Landing Page":"angles"===e.type?"Generate Angles":"angle_variant"===e.type?"Angle: ".concat(String((null===(a=e.data)||void 0===a?void 0:null===(t=a.angle)||void 0===t?void 0:t.name)||"Variant")):"headlines"===e.type?"Generate Headlines":"copies"===e.type?"Generate Ad Copies":"gemini_images"===e.type?"Generate Ad Images":"headlines_out"===e.type?"Headlines Output":"copies_out"===e.type?"Ad Copies Output":"images_out"===e.type?"Images Output":"Review & Approve"}),(0,n.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-slate-100 text-slate-600",children:"idle"})]}),(0,n.jsx)(y,{}),(0,n.jsxs)("div",{className:"p-3 text-sm text-slate-700 min-h-[64px]",children:["landing"===e.type&&(0,n.jsxs)("div",{className:"text-xs text-slate-500 break-words truncate max-w-[220px]",children:[Y?(0,n.jsx)("div",{className:"font-medium text-slate-700 truncate",children:Y}):null,(0,n.jsx)("div",{className:"truncate",children:F||"No URL"})]}),"angles"===e.type&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"text-xs text-slate-600",children:"Prepare angles prompt and generate 3 angle cards"}),(0,n.jsx)(u,{size:"sm",variant:"outline",onClick:tU,disabled:eB,children:"Generate angles"})]}),"angle_variant"===e.type&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"text-xs text-slate-600",children:"Expand this angle into copies, headlines, and images"}),(0,n.jsx)(u,{size:"sm",variant:"outline",onClick:()=>tD(e.id),disabled:eB,children:"Expand angle"})]}),"headlines"===e.type&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"text-xs text-slate-600",children:"Prepare headlines prompt and generate outputs"}),(0,n.jsx)(u,{size:"sm",variant:"outline",onClick:()=>tM(e.id),disabled:eB,children:"Generate headlines"})]}),"copies"===e.type&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"text-xs text-slate-600",children:"Prepare ad copies prompt and generate outputs"}),(0,n.jsx)(u,{size:"sm",variant:"outline",onClick:()=>tz(e.id),disabled:eB,children:"Generate copies"})]}),"headlines_out"===e.type&&(0,n.jsxs)("div",{className:"text-xs text-slate-600",children:[Array.isArray(null===(s=e.data)||void 0===s?void 0:s.headlines)?e.data.headlines.length:0," headlines"]}),"copies_out"===e.type&&(0,n.jsxs)("div",{className:"text-xs text-slate-600",children:[Array.isArray(null===(i=e.data)||void 0===i?void 0:i.primaries)?e.data.primaries.length:0," copies"]}),"gemini_images"===e.type&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"text-xs text-slate-600",children:[ex.length||0," images"]}),(0,n.jsx)(u,{size:"sm",variant:"outline",onClick:()=>tL(e.id),disabled:eB,children:"Generate images"})]}),"images_out"===e.type&&(0,n.jsxs)("div",{className:"text-xs text-slate-600",children:[ex.length||0," images generated"]}),"meta_ad"===e.type&&(0,n.jsx)("div",{className:"text-xs text-slate-600",children:"Review and approve to create draft in Meta"}),"landing"===e.type&&es[0]&&(0,n.jsx)("img",{src:ed(es[0]),alt:"cover",className:"mt-2 w-[180px] h-24 object-cover rounded"})]}),(0,n.jsx)("div",{className:"absolute w-2 h-2 rounded-full bg-slate-300 border border-slate-400",style:{left:-8,top:96}}),(0,n.jsx)("div",{className:"absolute w-2 h-2 rounded-full bg-slate-300 border border-slate-400",style:{right:-8,top:96}})]},e.id)})})]})]})]}),(0,n.jsx)("aside",{className:"col-span-12 md:col-span-3 space-y-3 overflow-y-auto pb-24",children:(0,n.jsxs)(m,{children:[(0,n.jsxs)(g,{className:"pb-2 flex items-center justify-between",children:[(0,n.jsx)(h,{className:"text-base",children:"Inspector"}),tF&&(0,n.jsx)("button",{className:"p-1 rounded hover:bg-slate-50",onClick:()=>tS(e=>e.filter(e=>e.id!==tF.id)),children:(0,n.jsx)(d.Z,{className:"w-4 h-4 text-slate-500"})})]}),(0,n.jsxs)(x,{children:[!tF&&(0,n.jsx)("div",{className:"text-sm text-slate-500",children:"Select a node to see details."}),tF&&(0,n.jsxs)("div",{className:"space-y-3 text-sm",children:["landing"===tF.type&&(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Landing page URL"}),(0,n.jsx)(v,{value:F,onChange:e=>J(e.target.value),placeholder:"https://yourstore.com/pages/offer"}),(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsx)(u,{size:"sm",variant:"outline",onClick:tN,children:"Analyze"})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Title"}),(0,n.jsx)(v,{value:Y,onChange:e=>{X(e.target.value),er(e=>({...e,title:"manual"}))},placeholder:"Product title"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Images"}),es.length>0?(0,n.jsx)("div",{className:"grid grid-cols-3 gap-2",children:es.slice(0,9).map((e,t)=>(0,n.jsxs)("div",{className:"relative border rounded overflow-hidden ".concat(e===ea?"ring-2 ring-blue-500":"ring-1 ring-slate-200"),children:[(0,n.jsx)("button",{className:"absolute top-1 right-1 z-10 bg-white/90 hover:bg-white text-slate-700 rounded px-1 text-xs",onClick:a=>{a.preventDefault(),ei(e=>e.filter((e,a)=>a!==t)),ea===e&&en("")},children:"Delete"}),(0,n.jsx)("button",{className:"block w-full",onClick:()=>{en(e),er(e=>({...e,sourceImage:"manual"}))},children:(0,n.jsx)("img",{src:e,alt:"img-".concat(t),className:"w-full h-16 object-cover"})})]},t))}):(0,n.jsx)("div",{className:"text-xs text-slate-500",children:"No images parsed yet."})]})]}),"angles"===tF.type&&(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Angles prompt"}),(0,n.jsx)(f,{rows:4,value:eK,onChange:e=>eQ(e.target.value)}),(0,n.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[(0,n.jsxs)("select",{className:"text-xs border rounded px-2 py-1",onChange:e=>{let t=Number(e.target.value);Number.isNaN(t)||to("angles",t)},defaultValue:"",children:[(0,n.jsx)("option",{value:"",children:"Versions…"}),e9.map(e=>(0,n.jsx)("option",{value:e.version,children:"v".concat(e.version," – ").concat(new Date(e.savedAt).toLocaleString())},e.version))]}),(0,n.jsx)(u,{size:"sm",variant:"outline",onClick:()=>tr("angles"),children:"Save version"})]})]}),(0,n.jsx)("div",{className:"text-[11px] text-slate-500 mt-1",children:"Preview:"}),(0,n.jsx)("pre",{className:"text-[11px] bg-slate-50 border rounded p-2 whitespace-pre-wrap max-h-32 overflow-auto",children:eK}),(0,n.jsx)("div",{className:"text-[11px] text-slate-500",children:"Inputs:"}),(0,n.jsxs)("ul",{className:"list-disc pl-4 text-xs",children:[(0,n.jsxs)("li",{children:["audience (",el.audience,"): ",G]}),(0,n.jsxs)("li",{children:["benefits (",el.benefits,"): ",V.split("\n").filter(Boolean).slice(0,4).join(", ")]}),(0,n.jsxs)("li",{children:["pain_points (",el.pains,"): ",q.split("\n").filter(Boolean).slice(0,4).join(", ")]}),(0,n.jsxs)("li",{children:["title (",el.title,"): ",Y]})]}),(()=>{var e,t;let a=((null===(e=tF.data)||void 0===e?void 0:e.meta)||{}).lastRun;return a?(0,n.jsxs)("div",{className:"text-xs space-y-1",children:[(0,n.jsx)("div",{className:"text-slate-500",children:"Last run"}),(0,n.jsxs)("div",{children:["Model: ",a.model||"default"]}),(0,n.jsxs)("div",{children:["Duration: ",a.durationMs," ms"]}),(0,n.jsxs)("div",{children:["Started: ",new Date(a.startedAt).toLocaleString()]}),(0,n.jsx)("div",{className:"text-slate-500",children:"Output angles:"}),(0,n.jsx)("ul",{className:"list-disc pl-4",children:((null===(t=a.outputSnapshot)||void 0===t?void 0:t.angles)||[]).map((e,t)=>(0,n.jsx)("li",{children:String((null==e?void 0:e.name)||"Angle")},t))})]}):null})(),(0,n.jsx)("div",{children:(0,n.jsx)(u,{size:"sm",variant:"outline",onClick:tU,disabled:eB,children:"Generate angles"})})]}),("headlines"===tF.type||"headlines_out"===tF.type)&&(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Headlines prompt"}),(0,n.jsx)(f,{rows:4,value:e$,onChange:e=>e0(e.target.value)}),(0,n.jsxs)("div",{className:"text-[11px] text-slate-500 mt-1",children:["Uses variables: ",G?"{audience} ":"",V?"{benefits} ":"",q?"{pain_points} ":"",Y?"{title} ":""]}),(0,n.jsx)("div",{className:"text-[11px] text-slate-500 mt-1",children:"Preview:"}),(0,n.jsx)("pre",{className:"text-[11px] bg-slate-50 border rounded p-2 whitespace-pre-wrap max-h-32 overflow-auto",children:tJ(e$)}),(0,n.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[(0,n.jsxs)("select",{className:"text-xs border rounded px-2 py-1",onChange:e=>{let t=Number(e.target.value);Number.isNaN(t)||to("headlines",t)},defaultValue:"",children:[(0,n.jsx)("option",{value:"",children:"Versions…"}),tt.map(e=>(0,n.jsx)("option",{value:e.version,children:"v".concat(e.version," – ").concat(new Date(e.savedAt).toLocaleString())},e.version))]}),(0,n.jsx)(u,{size:"sm",variant:"outline",onClick:()=>tr("headlines"),children:"Save version"}),(0,n.jsx)(u,{size:"sm",variant:"outline",onClick:()=>{try{localStorage.setItem("ptos_ads_headlines_prompt",e$)}catch(e){}},children:"Make default"})]})]}),(()=>{var e,t,a,s;let i=((null===(e=tF.data)||void 0===e?void 0:e.meta)||{}).lastRun;return i?(0,n.jsxs)("div",{className:"text-xs space-y-1",children:[(0,n.jsx)("div",{className:"text-slate-500",children:"Last run"}),(0,n.jsxs)("div",{children:["Model: ",i.model||"default"]}),(0,n.jsxs)("div",{children:["Duration: ",i.durationMs," ms"]}),(0,n.jsxs)("div",{children:["Started: ",new Date(i.startedAt).toLocaleString()]}),(0,n.jsx)("div",{className:"text-slate-500",children:"Inputs:"}),(0,n.jsxs)("ul",{className:"list-disc pl-4",children:[(0,n.jsxs)("li",{children:["audience (",el.audience,"): ",G]}),(0,n.jsxs)("li",{children:["benefits (",el.benefits,"): ",((null===(t=i.inputSnapshot)||void 0===t?void 0:t.benefits)||[]).join(", ")]}),(0,n.jsxs)("li",{children:["pain_points (",el.pains,"): ",((null===(a=i.inputSnapshot)||void 0===a?void 0:a.pain_points)||[]).join(", ")]}),(0,n.jsxs)("li",{children:["title (",el.title,"): ",(null===(s=i.inputSnapshot)||void 0===s?void 0:s.title)||""]})]})]}):null})(),(0,n.jsx)("div",{children:(0,n.jsx)(u,{size:"sm",variant:"outline",onClick:()=>tM(tF.id),disabled:eB,children:"Generate headlines"})})]}),("copies"===tF.type||"copies_out"===tF.type)&&(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Ad copies prompt"}),(0,n.jsx)(f,{rows:4,value:e1,onChange:e=>e2(e.target.value)}),(0,n.jsxs)("div",{className:"text-[11px] text-slate-500 mt-1",children:["Uses variables: ",G?"{audience} ":"",V?"{benefits} ":"",q?"{pain_points} ":"",Y?"{title} ":""]}),(0,n.jsx)("div",{className:"text-[11px] text-slate-500 mt-1",children:"Preview:"}),(0,n.jsx)("pre",{className:"text-[11px] bg-slate-50 border rounded p-2 whitespace-pre-wrap max-h-32 overflow-auto",children:tJ(e1)}),(0,n.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[(0,n.jsxs)("select",{className:"text-xs border rounded px-2 py-1",onChange:e=>{let t=Number(e.target.value);Number.isNaN(t)||to("copies",t)},defaultValue:"",children:[(0,n.jsx)("option",{value:"",children:"Versions…"}),tn.map(e=>(0,n.jsx)("option",{value:e.version,children:"v".concat(e.version," – ").concat(new Date(e.savedAt).toLocaleString())},e.version))]}),(0,n.jsx)(u,{size:"sm",variant:"outline",onClick:()=>tr("copies"),children:"Save version"}),(0,n.jsx)(u,{size:"sm",variant:"outline",onClick:()=>{try{localStorage.setItem("ptos_ads_copies_prompt",e1)}catch(e){}},children:"Make default"})]})]}),(()=>{var e;let t=((null===(e=tF.data)||void 0===e?void 0:e.meta)||{}).lastRun;return t?(0,n.jsxs)("div",{className:"text-xs space-y-1",children:[(0,n.jsx)("div",{className:"text-slate-500",children:"Last run"}),(0,n.jsxs)("div",{children:["Model: ",t.model||"default"]}),(0,n.jsxs)("div",{children:["Duration: ",t.durationMs," ms"]}),(0,n.jsxs)("div",{children:["Started: ",new Date(t.startedAt).toLocaleString()]})]}):null})(),(0,n.jsx)("div",{children:(0,n.jsx)(u,{size:"sm",variant:"outline",onClick:()=>tz(tF.id),disabled:eB,children:"Generate copies"})})]}),"headlines_out"===tF.type&&(0,n.jsxs)("div",{className:"space-y-2 text-xs",children:[(0,n.jsx)("div",{className:"text-slate-500",children:"Headlines (EN)"}),(0,n.jsx)("div",{className:"grid grid-cols-1 gap-1",children:(Array.isArray(null===(O=tF.data)||void 0===O?void 0:O.headlines_en)?tF.data.headlines_en:Array.isArray(null===(R=tF.data)||void 0===R?void 0:R.headlines)?tF.data.headlines:[]).slice(0,12).map((e,t)=>(0,n.jsxs)("label",{className:"text-sm flex items-center gap-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:ef===e,onChange:()=>ey(e)}),(0,n.jsx)("span",{children:e})]},t))}),Array.isArray(null===(E=tF.data)||void 0===E?void 0:E.headlines_fr)&&tF.data.headlines_fr.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"text-slate-500 mt-2",children:"Titres (FR)"}),(0,n.jsx)("div",{className:"grid grid-cols-1 gap-1",children:tF.data.headlines_fr.slice(0,12).map((e,t)=>(0,n.jsxs)("label",{className:"text-sm flex items-center gap-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:ef===e,onChange:()=>ey(e)}),(0,n.jsx)("span",{children:e})]},t))})]}),Array.isArray(null===(P=tF.data)||void 0===P?void 0:P.headlines_ar)&&tF.data.headlines_ar.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"text-slate-500 mt-2",children:"العناوين (AR)"}),(0,n.jsx)("div",{className:"grid grid-cols-1 gap-1",children:tF.data.headlines_ar.slice(0,12).map((e,t)=>(0,n.jsxs)("label",{className:"text-sm flex items-center gap-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:ef===e,onChange:()=>ey(e)}),(0,n.jsx)("span",{children:e})]},t))})]})]}),"copies_out"===tF.type&&(0,n.jsxs)("div",{className:"space-y-2 text-xs",children:[(0,n.jsx)("div",{className:"text-slate-500",children:"Primary texts (EN)"}),(0,n.jsx)("div",{className:"grid grid-cols-1 gap-1",children:(Array.isArray(null===(M=tF.data)||void 0===M?void 0:M.primaries_en)?tF.data.primaries_en:Array.isArray(null===(z=tF.data)||void 0===z?void 0:z.primaries)?tF.data.primaries:[]).slice(0,12).map((e,t)=>(0,n.jsxs)("label",{className:"text-sm flex items-center gap-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:ej===e,onChange:()=>e_(e)}),(0,n.jsx)("span",{className:"whitespace-pre-line",children:e})]},t))}),Array.isArray(null===(L=tF.data)||void 0===L?void 0:L.primaries_fr)&&tF.data.primaries_fr.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"text-slate-500 mt-2",children:"Textes (FR)"}),(0,n.jsx)("div",{className:"grid grid-cols-1 gap-1",children:tF.data.primaries_fr.slice(0,12).map((e,t)=>(0,n.jsxs)("label",{className:"text-sm flex items-center gap-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:ej===e,onChange:()=>e_(e)}),(0,n.jsx)("span",{className:"whitespace-pre-line",children:e})]},t))})]}),Array.isArray(null===(U=tF.data)||void 0===U?void 0:U.primaries_ar)&&tF.data.primaries_ar.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"text-slate-500 mt-2",children:"النصوص (AR)"}),(0,n.jsx)("div",{className:"grid grid-cols-1 gap-1",children:tF.data.primaries_ar.slice(0,12).map((e,t)=>(0,n.jsxs)("label",{className:"text-sm flex items-center gap-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:ej===e,onChange:()=>e_(e)}),(0,n.jsx)("span",{className:"whitespace-pre-line",children:e})]},t))})]})]}),("gemini_images"===tF.type||"images_out"===tF.type)&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Ad image prompt"}),(0,n.jsx)(f,{rows:3,value:e5,onChange:e=>e3(e.target.value)}),(0,n.jsxs)("div",{className:"text-[11px] text-slate-500",children:["Uses variables: ",Q?"{offers} ":"","and selected image."]}),(0,n.jsx)("div",{className:"text-[11px] text-slate-500 mt-1",children:"Preview:"}),(0,n.jsx)("pre",{className:"text-[11px] bg-slate-50 border rounded p-2 whitespace-pre-wrap max-h-32 overflow-auto",children:tJ(e5)}),(0,n.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[(0,n.jsxs)("select",{className:"text-xs border rounded px-2 py-1",onChange:e=>{let t=Number(e.target.value);Number.isNaN(t)||to("gemini",t)},defaultValue:"",children:[(0,n.jsx)("option",{value:"",children:"Versions…"}),ti.map(e=>(0,n.jsx)("option",{value:e.version,children:"v".concat(e.version," – ").concat(new Date(e.savedAt).toLocaleString())},e.version))]}),(0,n.jsx)(u,{size:"sm",variant:"outline",onClick:()=>tr("gemini"),children:"Save version"}),(0,n.jsx)(u,{size:"sm",variant:"outline",onClick:()=>{try{localStorage.setItem("ptos_ads_gemini_prompt",e5)}catch(e){}},children:"Make default"})]}),(()=>{var e,t;let a=((null===(e=tF.data)||void 0===e?void 0:e.meta)||{}).lastRun;return a?(0,n.jsxs)("div",{className:"text-xs space-y-1 mt-2",children:[(0,n.jsx)("div",{className:"text-slate-500",children:"Last run"}),(0,n.jsxs)("div",{children:["Model: ",a.model||"default"]}),(0,n.jsxs)("div",{children:["Duration: ",a.durationMs," ms"]}),(0,n.jsxs)("div",{children:["Started: ",new Date(a.startedAt).toLocaleString()]}),(0,n.jsxs)("div",{children:["Source image (",el.sourceImage,"): ",String((null===(t=a.inputSnapshot)||void 0===t?void 0:t.image_url)||"")]})]}):null})(),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(u,{size:"sm",variant:"outline",onClick:()=>"gemini_images"===tF.type?tL(tF.id):tZ(),disabled:eB,children:"Generate images (4)"}),"images_out"===tF.type&&Array.isArray(null===(D=tF.data)||void 0===D?void 0:D.images)&&tF.data.images.length>0&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(u,{size:"sm",variant:"outline",onClick:()=>{try{var e;for(let t of(null===(e=tF.data)||void 0===e?void 0:e.images)||[]){let e=document.createElement("a");e.href=t,e.download="ad-image.jpg",document.body.appendChild(e),e.click(),e.remove()}}catch(e){}},children:"Download all"})})]}),ex.length>0&&(0,n.jsx)("div",{className:"grid grid-cols-2 gap-2",children:ex.map((e,t)=>(0,n.jsxs)("button",{className:"group border rounded overflow-hidden ".concat(e===eN?"ring-2 ring-blue-500":"ring-1 ring-slate-200"),onClick:()=>eb(e),children:[(0,n.jsx)("img",{src:ed(e),alt:"ad-".concat(t),className:"w-full h-28 object-cover"}),(0,n.jsx)("div",{className:"absolute bottom-1 right-1 opacity-0 group-hover:opacity-100 transition",children:(0,n.jsx)("button",{className:"text-[10px] px-1 py-0.5 rounded bg-white/90 border",onClick:t=>{t.preventDefault(),t.stopPropagation();try{let t=document.createElement("a");t.href=ed(e),t.download="ad-image.jpg",document.body.appendChild(t),t.click(),t.remove()}catch(e){}},children:"Download"})})]},t))})]}),"meta_ad"===tF.type&&(0,n.jsxs)("div",{className:"space-y-3",children:[(()=>{let e=tF.id,t=tC.filter(t=>t.to===e).map(e=>tA.find(t=>t.id===e.from)).filter(Boolean),a=t.filter(e=>"headlines_out"===e.type).flatMap(e=>{let t=e.data||{};return[...Array.isArray(t.headlines_en)?t.headlines_en:Array.isArray(t.headlines)?t.headlines:[],...Array.isArray(t.headlines_fr)?t.headlines_fr:[],...Array.isArray(t.headlines_ar)?t.headlines_ar:[]]}),s=t.filter(e=>"copies_out"===e.type).flatMap(e=>{let t=e.data||{};return[...Array.isArray(t.primaries_en)?t.primaries_en:Array.isArray(t.primaries)?t.primaries:[],...Array.isArray(t.primaries_fr)?t.primaries_fr:[],...Array.isArray(t.primaries_ar)?t.primaries_ar:[]]}),i=t.filter(e=>"images_out"===e.type).flatMap(e=>{var t;return Array.isArray(null===(t=e.data)||void 0===t?void 0:t.images)?e.data.images:[]});return(0,n.jsxs)("div",{className:"space-y-3 text-xs",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-slate-500 mb-1",children:"Select headline"}),(0,n.jsx)("div",{className:"grid grid-cols-1 gap-1 max-h-36 overflow-auto",children:a.slice(0,24).map((e,t)=>(0,n.jsxs)("label",{className:"text-sm flex items-center gap-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:ef===e,onChange:()=>ey(e)}),(0,n.jsx)("span",{children:e})]},t))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-slate-500 mb-1",children:"Select primary text"}),(0,n.jsx)("div",{className:"grid grid-cols-1 gap-1 max-h-36 overflow-auto",children:s.slice(0,24).map((e,t)=>(0,n.jsxs)("label",{className:"text-sm flex items-center gap-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:ej===e,onChange:()=>e_(e)}),(0,n.jsx)("span",{className:"whitespace-pre-line",children:e})]},t))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-slate-500 mb-1",children:"Select image"}),(0,n.jsx)("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-auto",children:Array.from(new Set([...i.slice(0,24),...es.slice(0,24)])).map((e,t)=>(0,n.jsx)("button",{className:"border rounded overflow-hidden ".concat(e===eN?"ring-2 ring-blue-500":"ring-1 ring-slate-200"),onClick:()=>eb(e),children:(0,n.jsx)("img",{src:ed(e),alt:"ad-".concat(t),className:"w-full h-20 object-cover"})},t))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-slate-500 mb-1",children:"Carousel images (select 2+)"}),(0,n.jsx)("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-auto",children:Array.from(new Set([...i.slice(0,24),...es.slice(0,24)])).map((e,t)=>{let a=ew.includes(e);return(0,n.jsxs)("label",{className:"relative border rounded overflow-hidden ".concat(a?"ring-2 ring-blue-500":"ring-1 ring-slate-200"),children:[(0,n.jsx)("img",{src:ed(e),alt:"ad-".concat(t),className:"w-full h-20 object-cover"}),(0,n.jsx)("input",{type:"checkbox",className:"absolute top-1 left-1 bg-white/80",checked:a,onChange:()=>{eA(t=>a?t.filter(t=>t!==e):Array.from(new Set([...t,e])))}})]},t)})}),(0,n.jsxs)("div",{className:"text-[11px] text-slate-500 mt-1",children:["Selected: ",ew.length]})]})]})})(),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"CTA"}),(0,n.jsx)("select",{value:eS,onChange:e=>eC(e.target.value),className:"w-full rounded-xl border px-3 py-2",children:["SHOP_NOW","LEARN_MORE","SIGN_UP","SUBSCRIBE","GET_OFFER","BUY_NOW","CONTACT_US"].map(e=>(0,n.jsx)("option",{value:e,children:e.replaceAll("_"," ")},e))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Daily budget (USD)"}),(0,n.jsx)(v,{type:"number",min:1,value:String(eI),onChange:e=>ek(""===e.target.value?9:Number(e.target.value))})]}),(0,n.jsx)("div",{children:(0,n.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,n.jsx)("input",{type:"checkbox",checked:eO,onChange:e=>eR(e.target.checked)}),(0,n.jsx)("span",{children:"Advantage+ audience"})]})}),!eO&&(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Saved audience"}),(0,n.jsxs)("select",{value:eL,onChange:e=>eU(e.target.value),className:"w-full rounded-xl border px-3 py-2",children:[(0,n.jsx)("option",{value:"",children:"None"}),eD.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name||e.id},e.id))]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Countries (comma-separated)"}),(0,n.jsx)(v,{value:eM,onChange:e=>ez(e.target.value),placeholder:"US, MA"})]})]}),(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)(u,{onClick:tB,disabled:eB,children:"Approve & Create Draft"})})]})]})]})]})]})})]})]})}function _(){return(0,n.jsxs)("div",{className:"absolute inset-0",children:[(0,n.jsx)("div",{className:"absolute inset-0 pointer-events-none bg-[linear-gradient(to_right,_#eef2ff_1px,transparent_1px),linear-gradient(to_bottom,_#eef2ff_1px,transparent_1px)] bg-[size:24px_24px]"}),(0,n.jsx)("div",{className:"absolute inset-0 pointer-events-none bg-[radial-gradient(circle_at_20%_20%,rgba(59,130,246,0.06),transparent_30%),radial-gradient(circle_at_80%_60%,rgba(14,165,233,0.06),transparent_35%)]"})]})}function N(e){let{edge:t,nodes:a,active:s}=e,i=a.find(e=>e.id===t.from),l=a.find(e=>e.id===t.to);if(!i||!l)return null;let r=i.x+200,o=function(e,t,a,n){let s=.4*Math.abs(a-e);return"M ".concat(e," ").concat(t," C ").concat(e+s," ").concat(t,", ").concat(a-s," ").concat(n,", ").concat(a," ").concat(n)}(r,i.y+100,l.x+20,l.y+100);return(0,n.jsxs)("svg",{className:"absolute overflow-visible pointer-events-none",style:{left:0,top:0},children:[(0,n.jsxs)("defs",{children:[(0,n.jsx)("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",markerUnits:"strokeWidth",children:(0,n.jsx)("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#94a3b8"})}),(0,n.jsx)("marker",{id:"arrowhead-active",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",markerUnits:"strokeWidth",children:(0,n.jsx)("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#3b82f6"})})]}),(0,n.jsx)("path",{d:o,className:"fill-none ".concat(s?"edge edge-active":"edge"),strokeWidth:s?3:2,strokeLinecap:"round",strokeLinejoin:"round",vectorEffect:"non-scaling-stroke",markerEnd:s?"url(#arrowhead-active)":"url(#arrowhead)"})]})}},6264:function(e,t,a){"use strict";a.d(t,{$8:function(){return W},DO:function(){return d},HW:function(){return Z},HX:function(){return y},JA:function(){return D},KQ:function(){return w},Ks:function(){return B},LJ:function(){return I},ME:function(){return p},Nm:function(){return z},PN:function(){return x},Q:function(){return T},Rd:function(){return u},Sv:function(){return S},V0:function(){return Y},VI:function(){return b},WM:function(){return f},XD:function(){return c},_R:function(){return V},_X:function(){return X},aW:function(){return H},dP:function(){return j},e1:function(){return U},eg:function(){return N},ew:function(){return q},fE:function(){return m},fh:function(){return k},hw:function(){return v},jZ:function(){return M},kY:function(){return F},l9:function(){return g},n4:function(){return o},oB:function(){return E},rU:function(){return G},sF:function(){return P},sP:function(){return L},sQ:function(){return R},sj:function(){return _},sm:function(){return A},th:function(){return C},vz:function(){return J},xY:function(){return l},yD:function(){return r},yp:function(){return h},zO:function(){return O}});var n=a(8472);let s=a(357).env.NEXT_PUBLIC_API_BASE_URL||"";function i(){try{return localStorage.getItem("ptos_store")||void 0}catch(e){return}}async function l(e){let t=new FormData;for(let a of(t.append("audience",e.audience),t.append("benefits",JSON.stringify(e.benefits)),t.append("pain_points",JSON.stringify(e.pain_points)),null!=e.base_price&&t.append("base_price",String(e.base_price)),e.title&&t.append("title",e.title),Array.isArray(e.sizes)&&t.append("sizes",JSON.stringify(e.sizes)),Array.isArray(e.colors)&&t.append("colors",JSON.stringify(e.colors)),e.targeting&&t.append("targeting","string"==typeof e.targeting?e.targeting:JSON.stringify(e.targeting)),"boolean"==typeof e.advantage_plus&&t.append("advantage_plus",String(e.advantage_plus)),"number"==typeof e.adset_budget&&t.append("adset_budget",String(e.adset_budget)),e.model&&t.append("model",e.model),e.angles_prompt&&t.append("angles_prompt",e.angles_prompt),e.title_desc_prompt&&t.append("title_desc_prompt",e.title_desc_prompt),e.landing_copy_prompt&&t.append("landing_copy_prompt",e.landing_copy_prompt),e.images||[]))t.append("images",a);let{data:a}=await n.Z.post("".concat(s,"/api/tests"),t,{headers:{"Content-Type":"multipart/form-data"}});return a}async function r(e){let{data:t}=await n.Z.get("".concat(s,"/api/tests/").concat(e));return t}async function o(e){let{data:t}=await n.Z.get("".concat(s,"/api/tests/").concat(e,"?slim=1"));return t}async function d(e){var t,a;let l={...e,settings:{...e.settings||{},store:null!==(a=null==e?void 0:null===(t=e.settings)||void 0===t?void 0:t.store)&&void 0!==a?a:i()}},{data:r}=await n.Z.post("".concat(s,"/api/flows/draft"),l);return r}async function c(e,t){var a,l;let r={...t,settings:{...t.settings||{},store:null!==(l=null==t?void 0:null===(a=t.settings)||void 0===a?void 0:a.store)&&void 0!==l?l:i()}},{data:o}=await n.Z.put("".concat(s,"/api/flows/draft/").concat(e),r);return o}async function p(e){let{data:t}=await n.Z.get("".concat(s,"/api/flows/").concat(e));return t}async function u(e,t){let a=[];"number"==typeof e&&a.push("limit=".concat(e));let l=t||i();l&&a.push("store=".concat(encodeURIComponent(l)));let r=a.length?"?".concat(a.join("&")):"",{data:o}=await n.Z.get("".concat(s,"/api/flows").concat(r));return o}async function m(e){let{data:t}=await n.Z.delete("".concat(s,"/api/flows/").concat(e));return t}async function g(){let{data:e}=await n.Z.get("".concat(s,"/api/meta/audiences"));return e}async function h(e){let{data:t}=await n.Z.post("".concat(s,"/api/flows/ads/launch"),e);return t}async function x(e){let{data:t}=await n.Z.post("".concat(s,"/api/llm/angles"),e);return t}async function v(e){let{data:t}=await n.Z.post("".concat(s,"/api/llm/title_desc"),e);return t}async function f(e){let{data:t}=await n.Z.post("".concat(s,"/api/llm/landing_copy"),e);return t}async function y(e){let{data:t}=await n.Z.post("".concat(s,"/api/llm/analyze_landing_page"),e);return t}async function j(e){let{data:t}=await n.Z.post("".concat(s,"/api/meta/draft_image_campaign"),e);return t}async function _(e){let{data:t}=await n.Z.post("".concat(s,"/api/meta/draft_carousel_campaign"),e);return t}async function N(e){let t=new FormData;for(let a of e||[])t.append("files",a);let{data:a}=await n.Z.post("".concat(s,"/api/uploads"),t,{headers:{"Content-Type":"multipart/form-data"}});return a}async function b(e){let{data:t}=await n.Z.post("".concat(s,"/api/shopify/upload_images"),{...e,store:i()});return t}async function w(e){let{data:t}=await n.Z.post("".concat(s,"/api/shopify/product_create_from_title_desc"),{...e,store:i()});return t}async function A(e){let{data:t}=await n.Z.post("".concat(s,"/api/shopify/update_title"),{...e,store:i()});return t}async function S(e){var t,a;let{data:l}=await n.Z.post("".concat(s,"/api/shopify/create_page_from_copy"),{...e,store:i()});return{page_url:null!==(a=null!==(t=null==l?void 0:l.page_url)&&void 0!==t?t:null==l?void 0:l.url)&&void 0!==a?a:void 0}}async function C(e){let{data:t}=await n.Z.post("".concat(s,"/api/shopify/configure_variants"),{...e,store:i()});return t}async function I(e){let t=new FormData;t.append("product_gid",e.product_gid),e.title&&t.append("title",e.title),e.description&&t.append("description",e.description),e.landing_copy&&t.append("landing_copy",JSON.stringify(e.landing_copy));let a=i();for(let n of(a&&t.append("store",a),e.files||[]))t.append("files",n);let{data:l}=await n.Z.post("".concat(s,"/api/shopify/upload_files"),t,{headers:{"Content-Type":"multipart/form-data"}});return l}async function k(e){var t;let a={...e,store:null!==(t=e.store)&&void 0!==t?t:i()},{data:l}=await n.Z.post("".concat(s,"/api/shopify/collection_products"),a);return l}async function O(e){let t=[],a=null!=e?e:i();a&&t.push("store=".concat(encodeURIComponent(a)));let l=t.length?"?".concat(t.join("&")):"",{data:r}=await n.Z.get("".concat(s,"/api/campaign_mappings").concat(l));return r}async function R(e){var t;let a={...e,store:null!==(t=e.store)&&void 0!==t?t:i()},{data:l}=await n.Z.post("".concat(s,"/api/campaign_mappings"),a);return l}async function E(e){let{data:t}=await n.Z.post("".concat(s,"/api/gemini/ad_image"),e);return t}async function P(e){let{data:t}=await n.Z.post("".concat(s,"/api/gemini/feature_benefit_set"),e);return t}async function M(e){let{data:t}=await n.Z.post("".concat(s,"/api/agent/execute"),e);return t}async function z(e){let{data:t}=await n.Z.post("".concat(s,"/api/translate"),e);return t}async function L(e){let{data:t}=await n.Z.get("".concat(s,"/api/agents").concat("number"==typeof e?"?limit=".concat(e):""));return t}async function U(e){let{data:t}=await n.Z.get("".concat(s,"/api/agents/").concat(e));return t}async function D(e,t){let{data:a}=await n.Z.put("".concat(s,"/api/agents/").concat(e),t);return a}async function Z(e,t){let{data:a}=await n.Z.get("".concat(s,"/api/agents/").concat(e,"/runs").concat("number"==typeof t?"?limit=".concat(t):""));return a}async function B(e,t){let{data:a}=await n.Z.post("".concat(s,"/api/agents/").concat(e,"/runs"),t);return a}async function T(e,t,a){let{data:i}=await n.Z.put("".concat(s,"/api/agents/").concat(e,"/runs/").concat(t),a);return i}async function F(e,t){let{data:a}=await n.Z.get("".concat(s,"/api/agents/").concat(e,"/runs/").concat(t));return a}async function J(e){let{data:t}=await n.Z.post("".concat(s,"/api/llm/product_from_image"),e);return t}async function G(e){let{data:t}=await n.Z.post("".concat(s,"/api/gemini/variant_set"),e);return t}async function H(){let{data:e}=await n.Z.get("".concat(s,"/api/prompts"));return e}async function Y(e){let{data:t}=await n.Z.post("".concat(s,"/api/prompts"),e);return t}async function X(e,t){let a=[];e&&a.push("date_preset=".concat(encodeURIComponent(e))),t&&a.push("ad_account=".concat(encodeURIComponent(t)));let i=a.length?"?".concat(a.join("&")):"",{data:l}=await n.Z.get("".concat(s,"/api/meta/campaigns").concat(i));return l}async function V(e){var t,a;let l={...e,store:null!==(t=e.store)&&void 0!==t?t:i(),include_closed:null===(a=e.include_closed)||void 0===a||a,date_field:e.date_field},{data:r}=await n.Z.post("".concat(s,"/api/shopify/orders_count_by_title"),l);return r}async function W(e){var t;let a={...e,store:null!==(t=e.store)&&void 0!==t?t:i()},{data:l}=await n.Z.post("".concat(s,"/api/shopify/products_brief"),a);return l}async function q(e){var t,a;let l={...e,store:null!==(t=e.store)&&void 0!==t?t:i(),include_closed:null===(a=e.include_closed)||void 0===a||a,aggregate:e.aggregate,date_field:e.date_field},{data:r}=await n.Z.post("".concat(s,"/api/shopify/orders_count_by_collection"),l);return r}},2757:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,a(8030).Z)("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]])},399:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,a(8030).Z)("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]])},7138:function(e,t,a){"use strict";a.d(t,{default:function(){return s.a}});var n=a(231),s=a.n(n)},6463:function(e,t,a){"use strict";var n=a(1169);a.o(n,"useRouter")&&a.d(t,{useRouter:function(){return n.useRouter}}),a.o(n,"useSearchParams")&&a.d(t,{useSearchParams:function(){return n.useSearchParams}})}},function(e){e.O(0,[472,231,971,23,744],function(){return e(e.s=4106)}),_N_E=e.O()}]);