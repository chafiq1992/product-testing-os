(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[566],{1401:function(e,t,s){Promise.resolve().then(s.bind(s,406))},406:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return b}});var a=s(7437),l=s(7138),i=s(2265),n=s(8030);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,n.Z)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);var d=s(6706),o=s(9896);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let c=(0,n.Z)("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),x=(0,n.Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);var m=s(2513);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let h=(0,n.Z)("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]),u=(0,n.Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var p=s(7776),f=s(6264);function g(e){let{children:t}=e;return(0,a.jsx)("div",{className:"bg-white border rounded-2xl shadow-sm",children:t})}function v(e){let{title:t,icon:s,right:l}=e;return(0,a.jsxs)("div",{className:"px-5 pt-5 flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[s,(0,a.jsx)("div",{className:"font-semibold",children:t})]}),l]})}function j(e){let{children:t}=e;return(0,a.jsx)("div",{className:"px-5 pb-5 pt-3",children:t})}function b(){var e,t;let[s,n]=(0,i.useState)("irrakids"),[b,y]=(0,i.useState)(""),[N,w]=(0,i.useState)(""),[k,S]=(0,i.useState)(!0),[C,A]=(0,i.useState)(!1),[M,_]=(0,i.useState)(!1),[L,Z]=(0,i.useState)(30),[P,R]=(0,i.useState)([]),[z,I]=(0,i.useState)(null),[V,E]=(0,i.useState)(""),[H,O]=(0,i.useState)(""),[T,W]=(0,i.useState)(""),[q,D]=(0,i.useState)(null);async function J(){try{_(!0);let[e,t]=await Promise.all([(0,f.vL)({store:s}),(0,f.Jd)({store:s,days:L})]);if(null==e?void 0:e.error){if((null==e?void 0:e.error)==="unauthorized"){p.Am.error("Admin session expired. Please sign in again."),U();return}p.Am.error(String(null==e?void 0:e.error))}else R((null==e?void 0:e.data)||[]);(null==t?void 0:t.error)?p.Am.error(String(null==t?void 0:t.error)):I((null==t?void 0:t.data)||null)}finally{_(!1)}}function U(){try{localStorage.removeItem("ptos_confirmation_admin_token")}catch(e){}A(!1),R([]),I(null)}async function G(e){e.preventDefault();try{var t;_(!0);let e=await (0,f.Jl)({email:b,password:N,remember:k});if(null==e?void 0:e.error){p.Am.error(String(null==e?void 0:e.error));return}let s=null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.token;if(!s){p.Am.error("Login failed");return}try{localStorage.setItem("ptos_confirmation_admin_token",s)}catch(e){}A(!0),p.Am.success("Admin signed in")}catch(e){p.Am.error((null==e?void 0:e.message)||"Login failed")}finally{_(!1)}}(0,i.useEffect)(()=>{try{let e=localStorage.getItem("ptos_store")||"irrakids";n(e),localStorage.getItem("ptos_confirmation_admin_token")&&A(!0)}catch(e){}},[]),(0,i.useEffect)(()=>{C&&J()},[C,s,L]);let K=(0,i.useMemo)(()=>{let e=new Map;for(let t of P||[])(null==t?void 0:t.email)&&e.set(String(t.email).toLowerCase(),t);for(let t of Object.keys((null==z?void 0:z.agents)||{}))e.has(t)||e.set(t,{email:t,name:null});let t=Array.from(e.values());return t.sort((e,t)=>(e.email||"").localeCompare(t.email||"")),t},[P,z]),B=(null==z?void 0:z.totals)||{confirm:0,phone:0,whatsapp:0},F=(0,i.useMemo)(()=>((null==z?void 0:z.daily)||[]).slice(-14),[z]),Q=(0,i.useMemo)(()=>(function(e){let t=Math.max(1,...e);return e.map(e=>Math.round(e/t*100))})(F.map(e=>e.confirm||0)),[F]);async function X(){try{var e,t;_(!0);let a=await (0,f.ih)({store:s,email:V,name:H||void 0,password:T||void 0});if(null==a?void 0:a.error){p.Am.error(String(null==a?void 0:a.error));return}let l=null==a?void 0:null===(e=a.data)||void 0===e?void 0:e.generated_password;p.Am.success("Agent saved"),W(""),await J(),l&&D({email:null==a?void 0:null===(t=a.data)||void 0===t?void 0:t.email,generated:l})}finally{_(!1)}}async function Y(e){try{var t;if(!window.confirm("Reset password for ".concat(e,"?")))return;_(!0);let a=await (0,f.ui)({store:s,email:e});if(null==a?void 0:a.error){p.Am.error(String(null==a?void 0:a.error));return}p.Am.success("Password reset");let l=null==a?void 0:null===(t=a.data)||void 0===t?void 0:t.generated_password;D({email:e,generated:l||null}),await J()}finally{_(!1)}}async function $(e){try{if(!window.confirm("Remove agent ".concat(e,"?")))return;_(!0);let t=await (0,f.W)({store:s,email:e});if(null==t?void 0:t.error){p.Am.error(String(null==t?void 0:t.error));return}p.Am.success("Agent removed"),await J()}finally{_(!1)}}return C?(0,a.jsxs)("div",{className:"min-h-screen w-full bg-slate-50 text-slate-800",children:[(0,a.jsxs)("header",{className:"h-16 px-4 md:px-6 flex items-center justify-between border-b bg-white/80 backdrop-blur sticky top-0 z-50",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(r,{className:"w-5 h-5 text-indigo-600"}),(0,a.jsx)("div",{className:"font-semibold text-lg",children:"Confirmation Admin"}),(0,a.jsx)("div",{className:"hidden md:block text-xs text-slate-500",children:"Agent management & analytics"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("select",{value:s,onChange:e=>{let t=e.target.value;n(t);try{localStorage.setItem("ptos_store",t)}catch(e){}},className:"rounded-xl border px-2 py-1 text-sm",children:[(0,a.jsx)("option",{value:"irrakids",children:"irrakids"}),(0,a.jsx)("option",{value:"irranova",children:"irranova"})]}),(0,a.jsxs)("select",{value:L,onChange:e=>Z(parseInt(e.target.value,10)),className:"rounded-xl border px-2 py-1 text-sm",children:[(0,a.jsx)("option",{value:7,children:"Last 7 days"}),(0,a.jsx)("option",{value:14,children:"Last 14 days"}),(0,a.jsx)("option",{value:30,children:"Last 30 days"}),(0,a.jsx)("option",{value:90,children:"Last 90 days"})]}),(0,a.jsx)(l.default,{href:"/",className:"rounded-xl font-semibold inline-flex items-center gap-2 px-4 py-2 bg-slate-900 hover:bg-slate-950 text-white",children:"Home"}),(0,a.jsx)(l.default,{href:"/confirmation",className:"rounded-xl font-semibold inline-flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white",children:"Confirmation"}),(0,a.jsxs)("button",{onClick:J,className:"rounded-xl font-semibold inline-flex items-center gap-2 px-3 py-2 border bg-white hover:bg-slate-50",children:[(0,a.jsx)(d.Z,{className:"w-4 h-4 ".concat(M?"animate-spin":"")})," Refresh"]}),(0,a.jsxs)("button",{onClick:U,className:"rounded-xl font-semibold inline-flex items-center gap-2 px-3 py-2 border bg-white hover:bg-slate-50",children:[(0,a.jsx)(o.Z,{className:"w-4 h-4"})," Logout"]})]})]}),(0,a.jsxs)("div",{className:"p-4 md:p-6 space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3",children:[(0,a.jsxs)(g,{children:[(0,a.jsx)(v,{title:"Confirmed",icon:(0,a.jsx)(c,{className:"w-4 h-4 text-emerald-600"})}),(0,a.jsxs)(j,{children:[(0,a.jsx)("div",{className:"text-3xl font-semibold",children:B.confirm}),(0,a.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:"Total confirmed in selected window"}),(0,a.jsx)("div",{className:"mt-3 flex items-end gap-1 h-12",children:Q.map((e,t)=>(0,a.jsx)("div",{className:"w-full rounded-sm bg-emerald-200",style:{height:"".concat(Math.max(6,e),"%")}},t))}),(0,a.jsxs)("div",{className:"mt-2 flex items-center justify-between text-[11px] text-slate-500",children:[(0,a.jsx)("span",{children:(null===(e=F[0])||void 0===e?void 0:e.date)||""}),(0,a.jsx)("span",{children:(null===(t=F[F.length-1])||void 0===t?void 0:t.date)||""})]})]})]}),(0,a.jsxs)(g,{children:[(0,a.jsx)(v,{title:"Touchpoints",icon:(0,a.jsx)(x,{className:"w-4 h-4 text-blue-600"})}),(0,a.jsxs)(j,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"rounded-xl border bg-slate-50 p-3",children:[(0,a.jsx)("div",{className:"text-xs text-slate-500",children:"Phone clicks"}),(0,a.jsx)("div",{className:"text-2xl font-semibold",children:B.phone})]}),(0,a.jsxs)("div",{className:"rounded-xl border bg-slate-50 p-3",children:[(0,a.jsx)("div",{className:"text-xs text-slate-500",children:"WhatsApp clicks"}),(0,a.jsx)("div",{className:"text-2xl font-semibold",children:B.whatsapp})]})]}),(0,a.jsx)("div",{className:"text-xs text-slate-500 mt-3",children:"Counts are based on button clicks logged by the app."})]})]}),(0,a.jsxs)(g,{children:[(0,a.jsx)(v,{title:"Add / Update agent",icon:(0,a.jsx)(m.Z,{className:"w-4 h-4 text-indigo-600"})}),(0,a.jsx)(j,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-2",children:[(0,a.jsx)("input",{value:V,onChange:e=>E(e.target.value),placeholder:"agent@email.com",className:"rounded-lg border px-3 py-2 text-sm"}),(0,a.jsx)("input",{value:H,onChange:e=>O(e.target.value),placeholder:"Name (optional)",className:"rounded-lg border px-3 py-2 text-sm"}),(0,a.jsx)("input",{value:T,onChange:e=>W(e.target.value),placeholder:"Password (optional, auto-generate if empty)",className:"rounded-lg border px-3 py-2 text-sm"}),(0,a.jsx)("button",{disabled:M,onClick:X,className:"rounded-lg px-3 py-2 text-sm font-semibold bg-indigo-600 hover:bg-indigo-700 text-white disabled:opacity-60",children:"Save agent"}),(0,a.jsx)("div",{className:"text-[11px] text-slate-500",children:"If you leave password empty, the server generates one and shows it once."})]})})]})]}),(0,a.jsxs)(g,{children:[(0,a.jsx)(v,{title:"Agents",icon:(0,a.jsx)(x,{className:"w-4 h-4 text-slate-700"}),right:(0,a.jsxs)("span",{className:"text-xs text-slate-500",children:[K.length," agents"]})}),(0,a.jsx)(j,{children:(0,a.jsx)("div",{className:"overflow-auto",children:(0,a.jsxs)("table",{className:"min-w-[920px] w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-slate-50 text-xs text-slate-600",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left font-medium px-3 py-2",children:"Agent"}),(0,a.jsx)("th",{className:"text-left font-medium px-3 py-2",children:"Name"}),(0,a.jsx)("th",{className:"text-left font-medium px-3 py-2",children:"Confirmed"}),(0,a.jsx)("th",{className:"text-left font-medium px-3 py-2",children:"Phone"}),(0,a.jsx)("th",{className:"text-left font-medium px-3 py-2",children:"WhatsApp"}),(0,a.jsx)("th",{className:"text-left font-medium px-3 py-2",children:"Last activity"}),(0,a.jsx)("th",{className:"text-right font-medium px-3 py-2",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:K.map(e=>{let t=((null==z?void 0:z.agents)||{})[String(e.email||"").toLowerCase()]||{confirm:0,phone:0,whatsapp:0,last_at:null};return(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"px-3 py-2 font-medium",children:e.email}),(0,a.jsx)("td",{className:"px-3 py-2 text-slate-600",children:e.name||"—"}),(0,a.jsx)("td",{className:"px-3 py-2",children:(0,a.jsx)("span",{className:"inline-flex items-center rounded-full bg-emerald-50 border border-emerald-200 px-2 py-0.5 text-xs font-semibold text-emerald-800",children:t.confirm})}),(0,a.jsx)("td",{className:"px-3 py-2",children:(0,a.jsx)("span",{className:"inline-flex items-center rounded-full bg-blue-50 border border-blue-200 px-2 py-0.5 text-xs font-semibold text-blue-800",children:t.phone})}),(0,a.jsx)("td",{className:"px-3 py-2",children:(0,a.jsx)("span",{className:"inline-flex items-center rounded-full bg-fuchsia-50 border border-fuchsia-200 px-2 py-0.5 text-xs font-semibold text-fuchsia-800",children:t.whatsapp})}),(0,a.jsx)("td",{className:"px-3 py-2 text-slate-600",children:function(e){try{if(!e)return"—";let t=new Date(e);if(Number.isNaN(t.getTime()))return String(e);return t.toLocaleString(void 0,{year:"2-digit",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(e){return"—"}}(t.last_at)}),(0,a.jsx)("td",{className:"px-3 py-2",children:(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,a.jsxs)("button",{disabled:M,onClick:()=>Y(e.email),className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg border bg-white hover:bg-slate-50 text-sm font-semibold disabled:opacity-60",children:[(0,a.jsx)(h,{className:"w-4 h-4"})," Reset password"]}),(0,a.jsxs)("button",{disabled:M,onClick:()=>$(e.email),className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg border bg-white hover:bg-red-50 text-sm font-semibold text-red-700 border-red-200 disabled:opacity-60",children:[(0,a.jsx)(u,{className:"w-4 h-4"})," Remove"]})]})})]},e.email)})})]})})})]})]}),q&&(0,a.jsx)("div",{className:"fixed inset-0 z-[80] flex items-center justify-center bg-black/30 px-4",children:(0,a.jsxs)("div",{className:"w-full max-w-md bg-white border rounded-2xl shadow-xl p-5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h,{className:"w-4 h-4 text-indigo-600"}),(0,a.jsx)("div",{className:"font-semibold",children:"Password reset"})]}),(0,a.jsxs)("div",{className:"text-sm text-slate-600 mt-2",children:["Agent: ",(0,a.jsx)("span",{className:"font-medium",children:q.email})]}),(0,a.jsxs)("div",{className:"mt-3 rounded-xl border bg-slate-50 p-3",children:[(0,a.jsx)("div",{className:"text-xs text-slate-500",children:"Generated password (shown once)"}),(0,a.jsx)("div",{className:"mt-1 font-mono text-sm break-all",children:q.generated||"—"})]}),(0,a.jsx)("div",{className:"mt-4 flex justify-end gap-2",children:(0,a.jsx)("button",{onClick:()=>D(null),className:"px-3 py-1.5 rounded-lg border bg-white hover:bg-slate-50 text-sm font-semibold",children:"Close"})})]})})]}):(0,a.jsx)("div",{className:"min-h-screen w-full bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-slate-50 via-white to-indigo-50 text-slate-800 flex items-center justify-center px-4",children:(0,a.jsxs)("div",{className:"w-full max-w-md border rounded-2xl shadow-sm bg-white p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(r,{className:"w-5 h-5 text-indigo-600"}),(0,a.jsx)("div",{className:"text-xl font-semibold",children:"Confirmation Admin"})]}),(0,a.jsx)("div",{className:"text-sm text-slate-500 mt-1",children:"Manage agents and view analytics."}),(0,a.jsxs)("form",{onSubmit:G,className:"mt-4 space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-slate-700 mb-1",children:"Email"}),(0,a.jsx)("input",{value:b,onChange:e=>y(e.target.value),placeholder:"admin@example.com",className:"w-full rounded-lg border px-3 py-2 text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-slate-700 mb-1",children:"Password"}),(0,a.jsx)("input",{type:"password",value:N,onChange:e=>w(e.target.value),placeholder:"••••••••",className:"w-full rounded-lg border px-3 py-2 text-sm"})]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 text-xs text-slate-600 select-none",children:[(0,a.jsx)("input",{type:"checkbox",checked:k,onChange:e=>S(e.target.checked)}),"Remember me (stay signed in on this device)"]}),(0,a.jsx)("button",{disabled:M,className:"w-full rounded-lg px-3 py-2 text-sm font-semibold bg-indigo-600 hover:bg-indigo-700 text-white disabled:opacity-60",children:M?"Signing in…":"Sign in"})]})]})})}},9896:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(8030).Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]])},2513:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(8030).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},6706:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(8030).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},7138:function(e,t,s){"use strict";s.d(t,{default:function(){return l.a}});var a=s(231),l=s.n(a)}},function(e){e.O(0,[472,231,776,264,971,23,744],function(){return e(e.s=1401)}),_N_E=e.O()}]);