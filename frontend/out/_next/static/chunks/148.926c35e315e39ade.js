"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[148],{8148:function(e,s,t){t.r(s),t.d(s,{default:function(){return n}});var a=t(7437),i=t(2265),r=t(6264);function n(e){let{instructionKey:s="promotion_agent_instruction",initialInstruction:t,agentId:n}=e,[l,o]=(0,i.useState)(""),[d,c]=(0,i.useState)("gpt-5"),[m,u]=(0,i.useState)(!1),[p,h]=(0,i.useState)(""),[g,v]=(0,i.useState)([]),[x,b]=(0,i.useState)(""),[f,y]=(0,i.useState)(null),N=(0,i.useMemo)(()=>'You are Promotion Agent: a senior CRO & pricing strategist specialized in multi-offer promotions. Your mission: design high-converting promotions (bundles, tiered discounts, BOGO, gifts-with-purchase, threshold offers), write headlines and ad copies, and return all outputs as ONE strict JSON object.\n\nOPERATING PRINCIPLES\n- Always prefer tools for facts (catalog, pricing, inventory, margins, policies). Never invent data.\n- Output EXACTLY ONE valid JSON object. No prose, no markdown.\n- Promotions must obey constraints: min margin %, exclusions, max discount, stackability rules.\n- Use ethical FOMO: real deadlines, limited stock windows, seasonal peaks, genuine scarcity.\n- If region == \'MA\': include Cash on Delivery, 24–48h city delivery, easy returns, WhatsApp support.\n- Match requested language(s): en, ar (Fus\'ha), fr, optionally darija (Latin letters).\n- Add emotional triggers (relief, pride, smart-saver, gift-giver joy), but keep claims concrete and compliant.\n\nDEFAULT TOOL FLOW\n1) Fetch catalog/pricing/inventory → product_feed_tool, price_stock_tool.\n2) Read guardrails/policies → business_rules_tool (min_margin, max_discount, exclusions, stackability, gwp rules).\n3) Generate promotion mechanics candidates (bundles/tiers/BOGO/GWP/thresholds/free shipping).\n4) Score each candidate on profit impact, conversion lift, simplicity, inventory burn-down, and urgency potential.\n5) Produce creatives: headlines (5–8/offer), primary texts (short/medium/long), and image prompts per offer.\n6) Output a test plan with priorities, countdowns, and tracking hooks.\n\nPROMOTION MECHANICS (use as appropriate)\n- Tiered cart discounts: e.g., 299 MAD → -10%, 499 MAD → -15%, 799 MAD → -20%.\n- BOGO/BOGOX: Buy 1 get 1 -50%, Buy 2 get 1 free (cheapest).\n- Bundles: curated sets (same category or mixed), auto-applied price; enforce min margin.\n- GWP: gift-with-purchase above threshold or with specific SKUs; gift’s cost within margin guardrail.\n- Threshold shipping: free shipping at X MAD; combine with minor bonus (gift bag) at higher tier.\n- Limited quantity/limited time windows with countdowns and back-in-stock nudges.\n\nOUTPUT CONTRACT (SIMPLIFIED FOR EN ONLY)\n{\n  "promotions": [\n    { "name": str, "type": "tier|bundle|bogo|gwp|threshold|free_shipping", "mechanic": str,\n      "assets": { "headlines": { "en": [str...] }, "primaries": { "en": { "short": str, "medium": str, "long": str } }, "image_prompts": [str...] }\n    }\n  ]\n}\n\nCOPY RULES\n- Headlines: 6 per promotion; short, specific, value-forward; no clickbait.\n- Primary texts: include the deal math and legit urgency; end with CTA.\n- Region == \'MA\': weave COD, 24–48h city delivery, easy returns, WhatsApp support.\n',[]),[j,w]=(0,i.useState)(null!=t?t:N);(0,i.useEffect)(()=>{try{let e=localStorage.getItem(s);e&&e.trim()&&w(e)}catch(e){}},[s]);let C=(0,i.useCallback)(async()=>{u(!0),h(""),v([]);try{var e,s,t,a,i,o,c,m;let u={url:l,model:d,systemInstruction:j};if(n&&!f)try{let e=await (0,r.Ks)(n,{title:"Run ".concat(new Date().toLocaleString()),status:"running",input:u});(null==e?void 0:e.id)&&y(e.id)}catch(e){}else if(n&&f)try{await (0,r.Q)(n,f,{status:"running",input:u})}catch(e){}let p={role:"user",content:[l?"LANDING_URL: ".concat(l.trim()):"","REGION: MA","LANGUAGE: en only","CURRENCY: MAD","TASK: Generate EXACTLY 3 promotions. For each promotion include exactly 6 English headlines and 3 English primary texts (short/medium/long). Include at least 1 image_prompts entry that fits the offer. Output ONE valid JSON object per the simplified contract."].filter(Boolean).join("\n")},h="";try{if(l&&l.trim()){let e=await (0,r.HX)({url:l.trim(),model:d||void 0}),s=Array.isArray(null==e?void 0:e.images)?e.images:[];h=s&&s.length?s[0]:""}}catch(e){}b(h);let g=await (0,r.jZ)({messages:[{role:"system",content:j},p],model:d||void 0}),N=(null==g?void 0:g.text)||"",w={};try{w=JSON.parse(N)}catch(e){w={}}let C=Array.isArray(null==w?void 0:w.promotions)?w.promotions:[];for(let i of C)try{let r=((null===(s=i.assets)||void 0===s?void 0:null===(e=s.headlines)||void 0===e?void 0:e.en)||[]).filter(e=>"string"==typeof e&&e.trim());for(;r.length<6;)r.push(r[r.length-1]||"");i.assets=i.assets||{},i.assets.headlines=i.assets.headlines||{},i.assets.headlines.en=r.slice(0,6);let n=(null===(a=i.assets)||void 0===a?void 0:null===(t=a.primaries)||void 0===t?void 0:t.en)||{};if(i.assets.primaries=i.assets.primaries||{en:{}},i.assets.primaries.en={short:String(n.short||"").trim()||r[0]||"",medium:String(n.medium||"").trim()||r[1]||"",long:String(n.long||"").trim()||r[2]||""},i.assets.image_prompts=Array.isArray(i.assets.image_prompts)?i.assets.image_prompts:[],0===i.assets.image_prompts.length){let e=i.name||"Offer";i.assets.image_prompts.push("High-converting ecommerce offer image for ".concat(e,". Clean studio background, premium lighting, product-first, bold readable banner with offer math."))}}catch(e){}let A=C.slice(0,3),S=[];A.forEach(e=>{var s,t,a,i;let r=(null===(t=e.assets)||void 0===t?void 0:null===(s=t.headlines)||void 0===s?void 0:s.en)||[];S.push(...r);let n=(null===(i=e.assets)||void 0===i?void 0:null===(a=i.primaries)||void 0===a?void 0:a.en)||{};["short","medium","long"].forEach(e=>{let s=n[e];"string"==typeof s&&s.trim()&&S.push(s)})});let O=Array.from(new Set(S.filter(e=>e&&e.trim()))),_={},k={};if(O.length)try{let[e,s]=await Promise.all([(0,r.Nm)({texts:O,target:"fr",locale:"MA",domain:"ads"}),(0,r.Nm)({texts:O,target:"ar",locale:"MA",domain:"ads"})]),t=(null==e?void 0:e.translations)||[],a=(null==s?void 0:s.translations)||[];O.forEach((e,s)=>{_[e]=t[s]||"",k[e]=a[s]||""})}catch(e){}for(let e of A){try{let s=(null===(o=e.assets)||void 0===o?void 0:null===(i=o.headlines)||void 0===i?void 0:i.en)||[],t=s.map(e=>_[e]||""),a=s.map(e=>k[e]||"");e.assets=e.assets||{},e.assets.headlines=e.assets.headlines||{},e.assets.headlines.fr=t,e.assets.headlines.ar=a;let r=(null===(c=e.assets.primaries)||void 0===c?void 0:c.en)||{},n=String(r.short||""),l=String(r.medium||""),d=String(r.long||"");e.assets.primaries=e.assets.primaries||{},e.assets.primaries.fr={short:_[n]||"",medium:_[l]||"",long:_[d]||""},e.assets.primaries.ar={short:k[n]||"",medium:k[l]||"",long:k[d]||""}}catch(e){}try{let s=((null===(m=e.assets)||void 0===m?void 0:m.image_prompts)||[])[0]||"";if(s&&(h||x)){let t=h||x,a=await (0,r.oB)({image_url:t,prompt:s,num_images:1,neutral_background:!1}),i=(null==a?void 0:a.images)||[];e.generated_image=Array.isArray(i)&&i[0]?i[0]:""}}catch(e){}}if(v(A),n)try{let e=f||"";e&&await (0,r.Q)(n,e,{status:"completed",output:{promotions:A}})}catch(e){}}catch(e){h(String((null==e?void 0:e.message)||e))}finally{u(!1)}},[l,d,j,n,f]);return(0,a.jsxs)("div",{className:"flex gap-6",children:[(0,a.jsxs)("div",{className:"w-[360px] shrink-0 space-y-4",children:[(0,a.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-white shadow-sm p-4",children:[(0,a.jsx)("div",{className:"text-base font-semibold mb-3",children:"Promotion Agent"}),(0,a.jsxs)("div",{className:"flex flex-col gap-3 text-base",children:[(0,a.jsx)("input",{className:"border rounded-lg px-3 py-2 bg-white border-slate-200",placeholder:"Product or Landing URL",value:l,onChange:e=>o(e.target.value)}),(0,a.jsx)("input",{className:"border rounded-lg px-3 py-2 bg-white border-slate-200",placeholder:"Model (optional)",value:d,onChange:e=>c(e.target.value)}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg disabled:opacity-50",disabled:m,onClick:C,children:m?"Running…":"Generate Promotions"}),(0,a.jsx)("button",{className:"px-3 py-2 text-sm border border-slate-200 rounded-lg",onClick:()=>{try{localStorage.setItem(s,j||"")}catch(e){}if(n)try{(0,r.JA)(n,{instruction:j||""})}catch(e){}},children:"Save Instruction"})]}),p?(0,a.jsx)("div",{className:"text-sm text-red-600 whitespace-pre-wrap",children:p}):null]})]}),(0,a.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-white shadow-sm p-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium mb-1",children:"System Instruction"}),(0,a.jsx)("textarea",{className:"w-full min-h-[220px] border border-slate-200 rounded-lg px-3 py-2",value:j,onChange:e=>w(e.target.value)})]})]}),(0,a.jsx)("div",{className:"flex-1 space-y-6",children:g.length?g.map((e,s)=>{var t,i,r,n,l,o,d,c,m,u,p,h,g,x;let b=(null===(i=e.assets)||void 0===i?void 0:null===(t=i.headlines)||void 0===t?void 0:t.en)||[],f=(null===(n=e.assets)||void 0===n?void 0:null===(r=n.headlines)||void 0===r?void 0:r.fr)||Array(b.length).fill(""),y=(null===(o=e.assets)||void 0===o?void 0:null===(l=o.headlines)||void 0===l?void 0:l.ar)||Array(b.length).fill(""),N=(null===(c=e.assets)||void 0===c?void 0:null===(d=c.primaries)||void 0===d?void 0:d.en)||{},j=[N.short||"",N.medium||"",N.long||""].filter(Boolean),w=(null===(u=e.assets)||void 0===u?void 0:null===(m=u.primaries)||void 0===m?void 0:m.fr)||{},C=[w.short||"",w.medium||"",w.long||""].filter(Boolean),A=(null===(h=e.assets)||void 0===h?void 0:null===(p=h.primaries)||void 0===p?void 0:p.ar)||{},S=[A.short||"",A.medium||"",A.long||""].filter(Boolean);return(0,a.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-white shadow-sm p-5",children:[(0,a.jsx)("div",{className:"text-lg font-semibold mb-1",children:e.name||"Promotion"}),(0,a.jsxs)("div",{className:"text-xs text-slate-500 mb-3",children:[e.type||"",e.mechanic?" — ".concat(e.mechanic):""]}),b.length?(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("div",{className:"text-base font-medium mb-2",children:"Headlines (EN / FR / AR)"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[(0,a.jsx)("div",{className:"space-y-2",children:b.map((e,t)=>(0,a.jsxs)("div",{className:"border border-slate-200 rounded-lg p-2 bg-white",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,a.jsx)("button",{className:"text-xs px-2 py-1 border rounded",onClick:()=>{try{navigator.clipboard.writeText(b[t]||"")}catch(e){}},children:"Copy"})}),(0,a.jsx)("input",{className:"w-full text-sm outline-none",value:b[t],onChange:e=>{let a=e.target.value;v(e=>{let i=[...e],r={...i[s]||{}};r.assets=r.assets||{},r.assets.headlines=r.assets.headlines||{};let n=[...r.assets.headlines.en||[]];return n[t]=a,r.assets.headlines.en=n,i[s]=r,i})}})]},t))}),(0,a.jsx)("div",{className:"space-y-2",children:f.map((e,t)=>(0,a.jsxs)("div",{className:"border border-slate-200 rounded-lg p-2 bg-white",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,a.jsx)("button",{className:"text-xs px-2 py-1 border rounded",onClick:()=>{try{navigator.clipboard.writeText(f[t]||"")}catch(e){}},children:"Copy"})}),(0,a.jsx)("input",{className:"w-full text-sm outline-none",value:f[t],onChange:e=>{let a=e.target.value;v(e=>{let i=[...e],r={...i[s]||{}};r.assets=r.assets||{},r.assets.headlines=r.assets.headlines||{};let n=[...r.assets.headlines.fr||Array(b.length).fill("")];return n[t]=a,r.assets.headlines.fr=n,i[s]=r,i})}})]},t))}),(0,a.jsx)("div",{className:"space-y-2",children:y.map((e,t)=>(0,a.jsxs)("div",{className:"border border-slate-200 rounded-lg p-2 bg-white",dir:"rtl",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 mb-2 justify-end",children:(0,a.jsx)("button",{className:"text-xs px-2 py-1 border rounded",onClick:()=>{try{navigator.clipboard.writeText(y[t]||"")}catch(e){}},children:"Copy"})}),(0,a.jsx)("input",{className:"w-full text-sm outline-none text-right",dir:"rtl",value:y[t],onChange:e=>{let a=e.target.value;v(e=>{let i=[...e],r={...i[s]||{}};r.assets=r.assets||{},r.assets.headlines=r.assets.headlines||{};let n=[...r.assets.headlines.ar||Array(b.length).fill("")];return n[t]=a,r.assets.headlines.ar=n,i[s]=r,i})}})]},t))})]})]}):null,j.length?(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("div",{className:"text-base font-medium mb-2",children:"Ad Copies (EN / FR / AR)"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[(0,a.jsx)("div",{className:"space-y-2",children:j.map((e,t)=>(0,a.jsxs)("div",{className:"border border-slate-200 rounded-lg p-2 bg-white",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,a.jsx)("button",{className:"text-xs px-2 py-1 border rounded",onClick:()=>{try{navigator.clipboard.writeText(j[t]||"")}catch(e){}},children:"Copy"})}),(0,a.jsx)("textarea",{className:"w-full text-sm outline-none min-h-[60px]",value:j[t],onChange:e=>{let a=e.target.value;v(e=>{var i,r;let n=[...e],l={...n[s]||{}},o=(null===(r=l.assets)||void 0===r?void 0:null===(i=r.primaries)||void 0===i?void 0:i.en)||{},d=[String(o.short||""),String(o.medium||""),String(o.long||"")];return d[t]=a,l.assets=l.assets||{},l.assets.primaries=l.assets.primaries||{},l.assets.primaries.en={short:d[0]||"",medium:d[1]||"",long:d[2]||""},n[s]=l,n})}})]},t))}),(0,a.jsx)("div",{className:"space-y-2",children:C.map((e,t)=>(0,a.jsxs)("div",{className:"border border-slate-200 rounded-lg p-2 bg-white",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,a.jsx)("button",{className:"text-xs px-2 py-1 border rounded",onClick:()=>{try{navigator.clipboard.writeText(C[t]||"")}catch(e){}},children:"Copy"})}),(0,a.jsx)("textarea",{className:"w-full text-sm outline-none min-h-[60px]",value:C[t],onChange:e=>{let a=e.target.value;v(e=>{let i=[...e],r={...i[s]||{}};r.assets=r.assets||{},r.assets.primaries=r.assets.primaries||{};let n=r.assets.primaries.fr||{short:"",medium:"",long:""},l=[String(n.short||""),String(n.medium||""),String(n.long||"")];return l[t]=a,r.assets.primaries.fr={short:l[0]||"",medium:l[1]||"",long:l[2]||""},i[s]=r,i})}})]},t))}),(0,a.jsx)("div",{className:"space-y-2",children:S.map((e,t)=>(0,a.jsxs)("div",{className:"border border-slate-200 rounded-lg p-2 bg-white",dir:"rtl",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 mb-2 justify-end",children:(0,a.jsx)("button",{className:"text-xs px-2 py-1 border rounded",onClick:()=>{try{navigator.clipboard.writeText(S[t]||"")}catch(e){}},children:"Copy"})}),(0,a.jsx)("textarea",{className:"w-full text-sm outline-none min-h-[60px] text-right",dir:"rtl",value:S[t],onChange:e=>{let a=e.target.value;v(e=>{let i=[...e],r={...i[s]||{}};r.assets=r.assets||{},r.assets.primaries=r.assets.primaries||{};let n=r.assets.primaries.ar||{short:"",medium:"",long:""},l=[String(n.short||""),String(n.medium||""),String(n.long||"")];return l[t]=a,r.assets.primaries.ar={short:l[0]||"",medium:l[1]||"",long:l[2]||""},i[s]=r,i})}})]},t))})]})]}):null,(0,a.jsxs)("div",{className:"mt-3 text-sm",children:[(0,a.jsx)("div",{className:"text-slate-600 mb-1",children:"Image Prompt"}),(0,a.jsxs)("div",{className:"border border-slate-200 rounded-lg p-2 bg-white",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,a.jsx)("button",{className:"text-xs px-2 py-1 border rounded",onClick:()=>{try{var s,t;navigator.clipboard.writeText((null===(t=e.assets)||void 0===t?void 0:null===(s=t.image_prompts)||void 0===s?void 0:s[0])||"")}catch(e){}},children:"Copy"})}),(0,a.jsx)("textarea",{className:"w-full text-sm outline-none min-h-[60px]",value:(null===(x=e.assets)||void 0===x?void 0:null===(g=x.image_prompts)||void 0===g?void 0:g[0])||"",onChange:e=>{let t=e.target.value;v(e=>{let a=[...e],i={...a[s]||{}};i.assets=i.assets||{};let r=[...i.assets.image_prompts||[""]];return r[0]=t,i.assets.image_prompts=r,a[s]=i,a})}})]}),e.generated_image?(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsx)("img",{src:e.generated_image,alt:"promo",className:"w-full max-w-md rounded border"})}):null]})]},s)}):(0,a.jsx)("div",{className:"rounded-xl border border-slate-200 bg-white shadow-sm p-5 text-sm text-slate-600",children:"No promotions yet. Enter a URL and click Generate."})})]})}}}]);